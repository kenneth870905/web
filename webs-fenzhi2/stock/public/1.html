
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>操盘交易委托</title>
    <link rel="shortcut icon" href="../asset/ico/favicon.png">
    <link href="http://10.10.27.17:8012/css/bootstrap.css" rel="stylesheet">
    <link href="http://10.10.27.17:8012/css/echartsHome.css" rel="stylesheet">
    <link href="http://10.10.27.17:8012/css/custom.css" rel="stylesheet">
    <link href="http://10.10.27.17:8012/layui/css/layui.css" rel="stylesheet" />
    <link href="http://10.10.27.17:8012/css/public.css" rel="stylesheet" />
    <style>
        .userMoney {
            color: #656e79;
        }

            .userMoney p {
                font-size: 20px
            }

        .money-value {
            font-size: 20px;
            font-weight: bold;
            margin-top: 10px;
        }

        .c-red {
            color: #e60012;
        }

        .c-green {
            color: green;
        }

        .history_contract {
            background: #FAF3EA;
            font-size: 16px;
            color: #333;
            font-weight: 700;
            padding: 30px;
            border-bottom: 1px solid #FFF;
        }


        .Kline-div {
            /*position: fixed;*/
            width: 100%;
            /*bottom: 0rem;
            top: 0;*/
            height: 650px;
            margin-left: 55px;
            margin-top: 30px;
        }

            .Kline-div .m-line {
                height: 49%;
                width: 100%;
                margin-bottom: 1%;
            }

            .Kline-div .K-line {
                height: 50%;
                width: 100%;
            }

        .op-stockdynamic-moretab-cur-num {
            font-size: 30px;
            color: #0f990f;
        }

        .c-gap-right-small {
            margin-right: 6px;
        }

        op-stockdynamic-moretab-cur-num {
            color: #0f990f;
        }

        .op-stockdynamic-moretab-cur-unit {
            height: 24px;
            display: inline-block;
            position: relative;
            bottom: 1px;
            color: #555;
            font-size: 14px;
            margin-right: 15px;
        }

        .op-stockdynamic-moretab-cur-status-icon {
            position: relative;
            top: -2px;
            *top: -5px;
            display: inline-block;
            width: 17px;
            height: 16px;
            background: url(//www.baidu.com/aladdin/img/stockdynamic/arrow.png) no-repeat;
        }

        .op-stockdynamic-moretab-cur-info {
            font-size: 22px;
            position: relative;
            top: -2px;
        }

        .c-gap-right-small {
            margin-right: 6px;
        }

        .table > tbody > tr > td {
            border: 0px;
        }


        .bs-example {
            margin-top: 5px;
            margin-right: 0;
            margin-left: 0;
            background-color: #fff;
            border-color: #ddd;
            border-width: 1px;
            border-radius: 4px 4px 0 0;
            -webkit-box-shadow: none;
            box-shadow: none;
        }

        .site-block {
            padding: 20px;
            border: 1px solid #eee;
        }

        .site-text {
            position: relative;
        }

        .site-title {
            margin: 30px 0 20px;
        }

        .border .layui-form-label {
            width: 80px;
        }

        .red {
            color: red;
        }

        .green {
            color: green;
        }

        .site-block {
            border: 1px solid #eee;
            margin-bottom: 0px;
        }

        .site-text {
            position: relative;
        }

        .table td {
            font-size: 20px;
        }

        #buy_set_List {
            height: 25px;
            clear: both;
            margin-bottom: 30px;
        }

            #buy_set_List dd {
                width: 20%;
                float: left;
                line-height: 20px;
                height: 40px;
                text-align: center;
            }

                #buy_set_List dd a {
                    color: blue
                }

        .layui-table th {
            text-align: center
        }

        .layui-table td {
            text-align: center
        }

        [v-cloak] {
            display: none;
        }
    </style>
</head>

<body>
    <div class="container-fluid" id="app" v-cloak>
        <input type="hidden" id="ContractCode" />
        <div class="row-fluid example">
            <div class="col-md-12">
                <table class="table active" style="margin-top: -23px;">
                    <tr>
                        <td>起始资金</td>
                        <td>合约资产</td>
                        <td>冻结金额</td>
                        <td>可用余额</td>
                        <td>证券市值</td>
                        <td>合约盈亏</td>
                    </tr>
                    <tr>
                        <td><span style="color:red;font-weight: bold">{{contractDetails.startAmount}}</span></td>
                        <td><span style="color:red;font-weight: bold">{{contractDetails.contractAmount}}</span></td>
                        <td><span style="color:red;font-weight: bold">{{contractDetails.blockedAmount}}</span></td>
                        <td><span style="color:red;font-weight: bold">{{Number(contractDetails.available).toFixed(2)}}</span></td>
                        <td><span style="color:red;font-weight: bold">{{contractDetails.marketValue}}</span></td>
                        <td><span v-bind:class="[contractDetails.contractloss>0?'red':'green']" style="font-weight: bold">{{contractDetails.contractloss}}</span></td>
                    </tr>
                </table>
            </div>
        </div>
        <div class="row-fluid example">
            <div class="col-md-12" style="margin-bottom: 10px;">
                <button class="layui-btn layui-btn-primary" v-on:click="toggle('3', $event)">撤单</button>
                <button class="layui-btn layui-btn-primary" v-on:click="toggle('2',$event)">卖出</button>
                <button class="layui-btn" v-on:click="toggle('1',$event)">买入</button>
            </div>

        </div>
        <div class="row-fluid example">
            <div id="graphic" class="col-md-6">
                <div id="pricegraph" class="main"></div>
                <div id="volumegraph" style="height:200px;"></div>
            </div>
            <div class="col-md-6">

                <table style="margin-top: 0px;" lay-size="sm" lay-skin="line" class="layui-table">
                    <thead>
                        <tr>
                            <td style="background-color:#cd3733;color:#FFF" v-if="type==1">自选股池</td>
                            <td style="background-color:#cd3733;color:#FFF" v-else-if="type==2" colspan="1">合约持仓</td>
                            <td style="background-color:#cd3733;color:#FFF" v-else>委托订单</td>
                            <td style="background-color:#cd3733;color:#FFF" v-show="type==1">证券代码：</td>
                            <td style="background-color:#cd3733;color:#FFF" v-show="type==1" colspan="3"><input type="text" id="stockCode" name="release" lay-skin="primary" v-model="stockcode" class="layui-input" style="height:32px;color:black"></td>
                            <td style="background-color:#cd3733;color:#FFF" v-show="type==1"> <button style="background-color:#cd3733;color:#FFF" v-on:click="addStock()" class="layui-btn layui-btn-normal  layui-btn-sm ">添加</button></td>
                            <td style="background-color:#cd3733;color:#FFF" v-show="type==2||type==3" colspan="5">
                                <button v-on:click="refresh()"style="background-color:#cd3733;color:#FFF" class="layui-btn layui-btn-normal layui-btn-sm ">刷新</button>
                            </td>
                        </tr>
                    </thead>
                </table>
                <table v-show="type=='1'" lay-size="sm" class="layui-table" style="table-layout:fixed">
                    <colgroup>
                        <col width="120">
                        <col width="150">
                        <col width="100">
                        <col width="160">
                        <col width="160">
                    </colgroup>
                    <thead>
                        <tr>
                            <th>操作</th>
                            <th>股票代码/股票名称</th>
                            <th style="width:80px">股票现价</th>
                            <th>涨跌幅度</th>
                            <th>删除自选</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr v-for="(item,index) in memberStocks">
                            <td><a style="color:blue;cursor: pointer;" v-on:click="viewStock(item)">查看</a></td>
                            <td>{{item.stockCode}}/{{item.stockName}}</td>
                            <td>
                                <span v-bind:class="[item.upDown>0?'red':'green']">{{item.stockPrice}}</span>
                            </td>
                            <td>
                                <span v-bind:class="[item.upDown>0?'red':'green']">{{item.upDownText}}({{item.upDown}}%)</span>
                            </td>
                            <td>
                                <a href="javascript:void(0)" class="del" v-on:click="delStock(item)">
                                    <i class="layui-icon" style="font-size:20px">&#xe640;</i>

                                </a>
                            </td>
                        </tr>

                    </tbody>
                </table>
                <table class="layui-table" lay-size="sm" v-show="type=='2'">
                    <thead>
                        <tr>
                            <th>操作</th>
                            <th>持仓股票</th>
                            <th>持仓成本</th>
                            <th>股票现价</th>
                            <th>持仓数量</th>
                            <th>可用数量</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr v-for="(item,index) in memberPositions">
                            <td><a style="color:blue;cursor: pointer;" v-on:click="viewStock(item)">查看</a></td>
                            <td>{{item.stockCode}}/{{item.stockName}}</td>
                            <td>{{item.costPrice}}</td>
                            <td>
                                <span v-bind:class="[item.upDown>0?'red':'green']">{{item.currentPrice}}</span>
                            </td>
                            <td>{{item.count}}</td>
                            <td>{{item.tranCount}}</td>
                        </tr>
                    </tbody>
                </table>

                <table class="layui-table" lay-size="sm" v-show="type=='3'">
                    <thead>
                        <tr>
                            <th>操作</th>
                            <th>委托股票</th>
                            <th>委托类型</th>
                            <th>委托单价</th>
                            <th>委托数量</th>
                            <th>状态</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr v-for="(item,index) in delegateList">
                            <td v-if="item.status==0">
                                <a style="color:blue;cursor:pointer" @click="manuallyCancel(item.delegateCode)">撤单</a>
                            </td>
                            <td v-else-if="item.status==1">
                                手动撤单
                            </td>
                            <td v-else-if="item.status==2">
                                系统撤单
                            </td>
                            <td v-else>
                                已成交
                            </td>
                            <td style="color:blue">{{item.stockName}}/{{item.stockCode}}</td>
                            <td>{{item.type}}</td>
                            <td>{{item.price}}</td>
                            <td>{{item.count}}</td>
                            <td>---</td>
                        </tr>
                    </tbody>
                </table>
                <navigation style="margin-top:-20px" :pages="pages" :current.sync="pageNo" @navpage="msgListView"></navigation>
            </div>

        </div>
        <div class="row-fluid example">
            <div class="col-md-6">
                <form class="layui-form layui-row layui-col-space10">
                    <blockquote class="layui-elem-quote title magt10" id="delegateText"><i class="layui-icon">&#xe609;</i> {{delegateText}}</blockquote>
                    <div class="border">
                        <div class="layui-form-item">
                            <label class="layui-form-label"><i class="layui-icon">&#xe65e;</i>价 格</label>
                            <div class="layui-input-block" style="width: 150px;">
                                <input type="text" id="delPrice" v-model="currentPrice" name="release" class="layui-input" lay-skin="primary" lay-filter="release" />
                            </div>
                        </div>
                        <div class="layui-form-item openness">
                            <label class="layui-form-label"><i class="layui-icon">&#xe657;</i> 数量</label>
                            <div class="layui-input-block" style="width: 150px;">
                                <input type="text" id="delCount" name="release" v-model="currentCount" class="layui-input" title="立即发布" lay-skin="primary" lay-filter="release" />
                            </div>
                        </div>
                        <div class="layui-form-item openness">
                            <div class="layui-input-block">
                                <dl id="buy_set_List">

                                    <dd v-for="(item,index) in priceRange"><a @click="currentCount=item.num" href="javascript:">{{item.text}}<br>（{{item.num}}股）</a></dd>

                                </dl>
                                <a id="btnOpertion" v-on:click="createDelegate()" class="layui-btn layui-btn-normal layui-btn-sm" lay-submit><i class="layui-icon">&#xe609;</i>{{text}}</a>
                            </div>
                        </div>
                        <div class="layui-left">

                            <input type="hidden" id="StockCode" />
                            <input type="hidden" id="ContractCode" />
                            <input type="hidden" id="StockName" />
                        </div>
                    </div>
                </form>
            </div>

        </div>
    </div>
    <script src="http://10.10.27.17:8012/js/jquery.min.js"></script>
    <script src="http://10.10.27.17:8012/jquery.utils.js"></script>
    <script src="http://10.10.27.17:8012/global.js"></script>
    <script src="http://10.10.27.17:8012/js/.js"></script>
    <script src="http://10.10.27.17:8012/js/sina.js"></script>
    <script src="http://10.10.27.17:8012/layui/layui.js"></script>
    <script src="http://10.10.27.17:8012/signalr.min.js"></script>
    <script src="http://10.10.27.17:8012/js/vue.min.js"></script>
    <script src="http://10.10.27.17:8012/js/pagination.js"></script>
    <script type="text/html" id="toolbarDemo">
        <div class="">
            <div class="layui-row">
                <div class="layui-col-sm2">
                    <label>证券代码：</label>
                </div>
                <div class="layui-col-sm4">
                    <input style="width:150px;height:32px" type="text" id="stockCode" />
                </div>
                <div class="layui-col-sm4">
                    <button class="layui-btn layui-btn-sm" lay-event="AddStock" style="cursor:pointer">添加自选股</button>
                </div>
            </div>
        </div>
    </script>
    <script type="text/javascript">
        var stockInfo;
        var lay_load;
        var stockHistory;
        var timeData;
        var stock;
        var table;
        var baseUrl = "https://hq.sinajs.cn/?_=1556783709049&list=";
        var historyArray = [];
        var vm = new Vue({
            el: '#app',
            data: {
                tableList: [],
                memberStocks: [],
                memberPositions: [],
                delegateList:[],
                pageNo: 1,
                pages: 15,
                stockcode: "",
                type: '1',
                currentPrice: 0,
                priceRange: [],
                currentCount: 0,
                text: '买入股票',
                currentStockCode: '',
                currentStockName: '',
                delegateText:'委托买入',
                contractDetails: {
                    contractloss: 0.00,
                    contractAmount: 0.00,
                    blockedAmount: 0.00,
                    available: 0.00,
                    marketValue: 0.00,
                    startAmount: 0.00,
                    currentContractCode: '67605241254e4cd29b2ece3065dcefcb',
                    availableBalance: 0.00,
                    contractProfitLoss:0.00
                },
            },
            methods: {
                msgListView(curPage) {
                    this.pageNo = curPage;
                    this.GetMemberStocks(curPage)
                },
                GetMemberStocks: function (curPage) {
                    if (curPage != null || curPage != undefined) {
                        this.pageNo = curPage;
                    }
                    var self = this;
                    var param = {};
                    param.pageIndex = self.pageNo;
                    param.pageSize = 10;
                    $.RAjax({
                        url: '/MyStock/GetMemberStocks',
                        data: param,
                        type: 'POST',
                        success: function (res) {
                            self.memberStocks = res.data;
                            self.pages = res.count;
                            // initStockinfo(self.memberStocks[0].stockCode)
                            self.viewStock(self.memberStocks[0])
                        }
                    })
                },
                GetDelegates: function (curPage) {//委托订单
                    if (curPage != null || curPage != undefined) {
                        this.pageNo = curPage;
                    }
                    var self = this;
                    var param = {};
                    param.pageIndex = self.pageNo;
                    param.pageSize = 10;
                    param.ContractCode = '67605241254e4cd29b2ece3065dcefcb';
                    param.Status = 0;
                    $.RAjax({
                        url: "/Delegate/GetDelegateList",
                        data: param,
                        type: 'POST',
                        success: function (res) {
                            self.delegateList = res.data;
                        }
                    })
                },
                GetContractDetails: function () {
                    var self = this;
                        $.RAjax({
                            url: '/Contract/GetContractDetails',
                            data: { guid: self.contractDetails.currentContractCode },
                            type: 'GET',
                            success: function (res) {
                                if (res.code == 0) {
                                    self.contractDetails.contractAmount = Number(res.data.contractAmount).toFixed(2);
                                    self.contractDetails.contractloss = Number(res.data.contractProfitLoss).toFixed(2);
                                    self.contractDetails.startAmount = Number(res.data.startingAmount).toFixed(2);
                                    self.contractDetails.available = Number(res.data.availableBalance).toFixed(2);
                                    self.contractDetails.blockedAmount = Number(res.data.blockedAmount).toFixed(2);
                                    self.contractDetails.marketValue = Number(res.data.marketValue).toFixed(2);
                                }
                            }
                        })
                },
                refresh: function () {
                    this.GetWarehouses(1);
                    this.GetDelegates(1);
                },//刷新持仓
                createDelegate: function () {
                    var self = this;
                    var showhtml = "确认以【￥<span class=red>" + self.currentPrice + "</span>】<br>" + (vm.type==1?"买入":"卖出") + "【<span class=red>" + self.currentCount + "</span>股】<br>股票代码[<span class=red>" + self.currentStockCode + "/" + self.currentStockName + "</span>]？<br>(注意：收盘15点以后下的委托单第二个交易日开盘进入队列委托)";
                    layer.confirm(showhtml, {
                        btn: ['确定', '取消'], btn1: function (index, layero) {
                            $.RAjax({
                                url: '/Delegate/CreateDelegate',
                                type: 'POST',
                                showLoading: true,
                                data: {
                                    StockCode: vm.currentStockCode,
                                    ContractCode: self.contractDetails.currentContractCode,
                                    StockName: vm.currentStockName,
                                    Price: vm.currentPrice,
                                    Count: vm.currentCount,
                                    DelegateType: vm.type
                                },
                                success: function (res) {
                                    if (res.code == 0) {
                                        vm.contractDetails.available = Number(vm.contractDetails.available - (vm.currentPrice * vm.currentCount)).toFixed(2)
                                        vm.contractDetails.blockedAmount = parseFloat(Number(vm.contractDetails.blockedAmount) + (vm.currentPrice * vm.currentCount)).toFixed(2)
                                        alert(res.msg);
                                        self.GetContractDetails();
                                    }
                                    parent.app.GetContractList(1);
                                    alert(res.msg);
                                }
                            });
                        }, btn2: function (index, layero) {

                            layer.close(index);
                        }
                    })
                },
                changeStock: function () {//实时更新股票价格
                    var self = this;
                    var _hubConnection = new signalR.HubConnectionBuilder();
                    _hubConnection = _hubConnection.withUrl("/chatHub")
                        .build();
                    _hubConnection.on("ReceiveMessage", function (stocks) {
                        if (stocks != null && stocks.length > 0) {
                            if (self.type == '1') {
                                for (var i = 0; i < self.memberStocks.length; i++) {
                                    var model = self.memberStocks[i];
                                    stocks.some(function (item, index) {
                                        if (item.stockCode == model.stockCode) {
                                            model.stockPrice = Number(item.stockPrice).toFixed(2);
                                            model.upDown = Number(item.upDown).toFixed(2);
                                            model.stockName = item.stockName;
                                            model.upDownText = (model.upDown > 0 ? '+' : '') + Number(item.stockPrice - item.yesterdayClose).toFixed(2);
                                            vm.$set(self.memberStocks, i, {
                                                stockCode: model.stockCode,
                                                stockPrice: model.stockPrice,
                                                upDown: model.upDown,
                                                stockName: model.stockName,
                                                upDownText: model.upDownText
                                            })
                                        }
                                    });
                                }
                            } else {
                                for (var i = 0; i < self.memberPositions.length; i++) {
                                    var model = self.memberPositions[i];
                                    stocks.some(function (item, index) {
                                        if (item.stockCode == model.stockCode) {
                                            model.currentPrice = Number(item.stockPrice).toFixed(2);
                                            model.upDown = Number(item.upDown).toFixed(2);
                                            model.stockName = item.stockName;
                                        }
                                        vm.$set(self.memberPositions, i, {
                                            stockCode: model.stockCode,
                                            currentPrice: model.currentPrice,
                                            count: model.count,
                                            tranCount: model.tranCount,
                                            upDown: model.upDown,
                                            stockName: model.stockName,
                                            costPrice: model.costPrice
                                        })
                                    });
                                }
                            }
                        }
                    });

                    _hubConnection.on("SendProfitLoss", function (data) {//实时推送浮动盈亏
                        vm.currentContractCode = vm.contractDetails.currentContractCode;
                        data.some(function (item, index) {
                            if (item.contractCode == vm.currentContractCode.toLowerCase()) {
                                self.contractDetails.startAmount = Number(item.startingAmount).toFixed(2);
                                self.contractDetails.contractAmount = Number(item.contractAmount).toFixed(2);
                                self.contractDetails.available = Number(item.availableBalance);
                                self.contractDetails.marketValue = Number(item.marketValue).toFixed(2);
                                self.contractDetails.contractloss = Number(item.contractProfitLoss).toFixed(2);
                                self.contractDetails.blockedAmount = Number(item.blockedAmount).toFixed(2);
                            }
                        })
                    })
                    _hubConnection.on("SendStockHistory", function (data) {//实时推送浮动盈亏
                        console.log(data)
                        historyArray = [];
                        historyArray = data;
                        initStockinfo(self.memberStocks[0].stockCode)
                    })
                    _hubConnection.start().then(function () {

                    }).catch(function (err) {
                        return console.error(err.toString());
                    });
                },
                viewStock: function (item) {

                    this.currentPrice = (item.stockPrice == undefined ? item.currentPrice : item.stockPrice);
                    this.currentStockCode = item.stockCode;
                    this.currentStockName = item.stockName;

                    var num1 = Math.floor(Number(vm.contractDetails.available) / vm.currentPrice)
                    var num2 = vm.type == '1' ? Math.floor(num1 / 100) * 100 : item.count;//全仓数量
                    var num3 = Math.floor(num2 / 100);//数量
                    var tempRange = [];
                    this.priceRange.splice(0, this.priceRange.length);
                    var len = (num3 > 4 ? 4 : num3);
                    if (len == 0) {
                        tempRange.push({ num: 0, text: '全仓' });
                    }
                    for (var i = 0; i < len; i++) {

                        var model = {};
                        if (i == 0) {
                            model.num = num2;
                            model.text = '全仓';
                        } else if (i == 1) {
                            model.num = Remainder(Math.floor(num2 / 2));
                            model.text = '半仓';
                        }
                        else if (i == 2) {
                            model.num = Remainder(Math.floor(num2 / 3));
                            model.text = '1/3仓';
                        } else if (i == 3) {
                            var tempNum = Remainder(Math.floor(num2 / 5)%100);
                            model.num = Remainder(Math.floor(num2 / 5));
                            model.text = '1/5仓';
                        }
                        tempRange.push(model);
                    }

                    for (var i = 0; i < tempRange.length; i++) {
                        if (tempRange[i].num == 0 && tempRange[i].text!='全仓') {
                            tempRange.splice(i, 1);
                        }
                    }
                    this.priceRange = tempRange;

                   initStockinfo(item.stockCode)
                },
                delStock: function (item) {
                    var self = this;
                    if (confirm('是否要删除自选股', function () {
                        $.RAjax({
                            url: '/MyStock/DeleteStock',
                            type:'POST',
                            data: { StockCode: item.stockCode },
                                 success: function (res) {
                                     if (res.code == 0) {
                                         layer.msg('删除成功');
                                         self.GetMemberStocks(1);
                                     }
                            }
                        })
                    })) {

                    }
                },
                addStock: function () {
                    var self = this;
                     $.RAjax({
                        url: '/MyStock/AddMemberStock',
                            type:'POST',
                         data: { StockCode: this.stockcode },
                         success: function (res) {
                             if (res.code == 0) {
                                 alert("添加成功");
                                 self.GetMemberStocks(1);
                                }
                            }
                        })
                },
                GetWarehouses: function (curPage) {
                    var self = this;
                    if (curPage != null || curPage != undefined) {
                        this.pageNo = curPage;
                    }
                    var self = this;
                    var param = {};
                    param.pageIndex = self.pageNo;
                    param.pageSize = 10;
                    $.RAjax({
                        url: '/Warehouse/GetWarehouses',
                        type: 'GET',
                        data: { ContractCode: vm.contractDetails.currentContractCode},
                        success: function (res) {
                            if (res.code == 0) {
                                self.pages = res.count;
                                self.memberPositions = res.data;
                            }
                        }
                    })
                },
                manuallyCancel: function (guid) {//撤单
                    if (confirm('确定要撤销吗?', function (ok) {
                        if (ok) {
                            $.RAjax({
                                url: '/Delegate/ManuallyCancel',
                                data: { guid: guid },
                                type: 'POST',
                                success: function (res) {
                                    if (res.code == 0) {
                                        setTimeout(function () {
                                            vm.GetContractDetails();
                                        }, 2000)
                                        vm.GetDelegates();
                                       alert(res.msg);
                                    }
                                }
                            })
                        }

                    })) {

                    }

                },
                toggle: function (type,elem) {
                    this.type = type;
                    if ($(elem.srcElement).hasClass('layui-btn-primary')) {
                        $(event.srcElement).removeClass('layui-btn-primary')
                        $(event.srcElement).siblings().addClass('layui-btn-primary')
                    }
                    if (this.type == '1') {
                        this.GetMemberStocks();
                        this.text = '买入股票';
                        this.delegateText = '委托买入';
                    } else if (this.type == '2') {
                        this.GetWarehouses();
                        this.text = '卖出持仓';
                        this.delegateText = '委托卖出';
                    } else {
                        this.GetDelegates(1);
                    }
                }
            },
            created() {
                this.changeStock();
                // if (this.type == '1') {
                //     this.GetMemberStocks();
                // } else if (this.type == '2') {
                //     this.GetWarehouses();
                // } else {
                //     this.GetDelegates();
                // }
              
                // this.GetContractDetails();
                // this.GetDelegates();

            }, 
            computed: {

            },
            mounted: function () {
                var self = this;
                //加载layui
                layui.use(['form','layer'], function () {

                });
            }
        })
        var tableList = [];
        var form;
        //初始化股票
        function initStockinfo(stockcode) {
            

            //alert(stockcode);

            if (this.historyArray.length>0) {
                for (var i = 0; i < this.historyArray.length; i++) {
                    var model = this.historyArray[i];
                }
            }
            debugger;


            var data = getSinaPrefix(stockcode);
            var urlHistory = baseUrl + data.link_history;
            var urlInfo = baseUrl + data.link_info;
            //获取历史数据
            $.getScript(urlHistory, function () {
                stockHistory = db(eval(data.var_history));
                //获取相关数据
                $.getScript(urlInfo, function () {
                    stockInfo = extractStockInfo(eval(data.var_info));
                    // refreshStockDetail();
                    refreshAllChart();
                });
                //  refreshAllChart();
            });
        }
        function Remainder(num) {
            if (Number(num) % 100 != 0) {
                return Number(num) - (Number(num) % 100)
            }
            return num;
        }
    </script>
    <script type="text/html" id="stockListBar">
        <a class="layui-btn layui-btn-xs" lay-event="view">查看</a>
    </script>
    <script type="text/html" id="stocklistDelBar">
        <a class="layui-btn layui-btn-xs layui-btn-danger" lay-event="del">删除</a>
    </script>
</body>
</html>


