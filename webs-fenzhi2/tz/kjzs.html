
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>走势图</title>
  <link href="./css/zoushi.css" rel="stylesheet">
</head>

<body class="trend-body">
  <div id="Vue" style="position:absolute;width:100%;height:100%;">
    <div id="OpenLottery_history" style="height: 100%; position: relative;">
      <div class="common_form">
        <div class="lottery_top">
          <div class="order_left">
            彩 类 :
            <!-- <select name="GameID" style="width:auto;padding-right: 20px;">
              <option value="23" data-game_type="8">蜗牛赛跑</option>
            </select> -->
            <span>梯子游戏</span>
          </div>
          <div class="order_left" id="trend_type_div">
            走势类别 :
            <!-- <select name="trend_type" style="width:auto;padding-right: 20px;">
              <option value="basic">基本走势图</option>
            </select> -->
            <span>基本走势图</span>
          </div>
          <div class="order_left" id="trend_periods">
            选择期数：
            <select name="periods_number" style="width:auto;padding-right: 20px;">

              <option value="30">30 期</option>
              <option value="50">50 期</option>
              <option value="100">100 期</option>
            </select>
          </div>
          <div class="order_left" id="other_select"></div>
          <div class="record_right">
            <div class="order_search" id="GoSelect" @click="GoSelect">走势图查询</div>
          </div>
        </div>
        <div class="lottery_dep">
          <span id="game_name">梯子游戏</span>
          <span id="select_condition"> － 基本走势图 － 期数：30</span>
          <!-- <div class="ChooseLocation"><span class="active">冠军</span>｜<span>亚军</span>｜<span>季军</span></div> -->
        </div>
        <div id="LotteryListDiv" style="position:relative;">
          <table width="100%">
            <tbody>
              <tr class="record_dep_nav">
                <th class="lottery_dep_nav_menu" width="110">期数</th>
                <th class="lottery_dep_nav_menu" id="open_lottery_th" width="160">开奖号码</th>
                <th class="lottery_dep_nav_menu" id="lotter_number_title">
                  <table class="fiveunit" style="width: 100%;">
                    <tbody>
                      <tr>
                        <th class="lottery_dep_nav_menu spanTitle" colspan="3">走势</th>
                      </tr>
                      <tr>
                        <th class="lottery_dep_nav_menu" style="width: 50%;">单</th>
                        <th class="lottery_dep_nav_menu" style="width: 50%; border-right: none;">双</th>
                        <!-- <th class="lottery_dep_nav_menu" style="width: 33.3333%; border-right: none;padding-right: 18px;">蓝</th> -->
                      </tr>
                    </tbody>
                  </table>
                </th>
              </tr>
            </tbody>
          </table>
          <canvas id="canvas"></canvas>
          <div class="scroll-wrapper lottery_scorllbar" id="Vue" style="position: relative; height: 579px;">
            <div class="lottery_scorllbar scroll-content scroll-scrolly_visible" style="height: auto; margin-bottom: 0px; margin-right: 0px; max-height: 579px;">
              <table class="record_dep_main" id="lottery_list" width="100%">
                <tbody>
                  <tr class="order_dep_list" v-for="(item,index) in list">
                    <td class="record_dep_list_txt" style="width: 110px;">{{item.IssueCode}}</td>
                    <td class="record_dep_list_txt" style="width: 160px;">
                        <div v-for="(item1,index) in item.obj" >
                           <div v-for="(item2,index) in item1" :class="item2.active">
                           </div>
                        </div>
                    </td>
                    <td class="record_dep_list_txt">
                      <table style="width: 100%;">
                        <tbody>
                          <tr >
                            <td class="lottery_dep_nav_menu number_td" style="width: 50%;" >
                              <div class="ball red" v-if="item.Content.slice(0,1)+item.Content.slice(2,3)== 01 ||item.Content.slice(0,1)+item.Content.slice(2,3)== 10">单</div>
                              <div class="miss_ball" v-else>{{item.obj.list[0].累计1}}</div>
                            </td>
                            <td class="lottery_dep_nav_menu number_td" style="width: 50%;">
                              <div class="ball green" v-if="item.Content.slice(0,1)+item.Content.slice(2,3)== 11 ||item.Content.slice(0,1)+item.Content.slice(2,3)== 00">双</div>
                              <div class="miss_ball" v-else>{{item.obj.list[0].累计2}}</div>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>

          </div>
          <table class="trend-statistics" width="100%">

            <tbody>
              <tr class="record_dep_nav" style="height: auto;">
                <th class="lottery_dep_nav_menu SumStr" width="270">
                  <table class="fiveunit" width="100%">
                    <tbody>
                      <tr>
                        <th class="lottery_dep_nav_menu " style="text-align:right;padding-right:10px;">总次数</th>
                      </tr>
                      <tr>
                        <th class="lottery_dep_nav_menu" style="text-align:right;padding-right:10px;">最大遗漏</th>
                      </tr>
                    </tbody>
                  </table>
                </th>
                <th class="lottery_dep_nav_menu" id="lotter_number_fotter">
                  <table class="fiveunit" id="footer_table" style="width: 100%;">
                    <tbody>
                      <tr>
                        <th class="lottery_dep_nav_menu red-total" style="width: 33.3333%;"></th>
                        <th class="lottery_dep_nav_menu green-total" style="width: 33.3333%;"></th>
                      </tr>
                      <tr>
                        <th class="lottery_dep_nav_menu" style="width: 33.3333%;">{{arrSort1}}</th>
                        <th class="lottery_dep_nav_menu" style="width: 33.3333%;">{{arrSort2}}</th>
                      </tr>
                    </tbody>
                  </table>
                </th>
                <th class="lottery_dep_nav_menu last" width="15">&nbsp;</th>
              </tr>
            </tbody>
          </table>
        </div>
        <div id="NotDevelop">
        </div>
      </div>
      <!-- <div class="bg_mask" v-if="mask"></div> -->
    </div>
  </div>


</body>
<script src="./js/jquery-3.1.0.min.js"></script>
<script src="./webConfig/config.js"></script>
<script src="./js/vue.js"></script>
<script>



  function canvas() {
    let canList = []
    var ballAll = $('.ball')
    for (let i = 0; i < ballAll.length; i++) {
      canList.push({
        left: ballAll[i].offsetLeft + 15,
        top: ballAll[i].offsetTop + 15
      })
    }
    let table = $('#lottery_list')
    let cvs = document.querySelector('canvas')
    cvs.style.position = 'absolute'
    cvs.style.left = 0 + 'px'
    cvs.style.top = 0 + 'px'
    cvs.width = table[0].scrollWidth    // 获取表格的宽并用来确定画布的宽度
    cvs.height = table[0].scrollHeight         // 表格的高度等同画布高度
    let cxt = cvs.getContext('2d')
    cxt.strokeStyle = 'red'
    cxt.moveTo(canList[0].left, canList[0].top)
    for (let i = 0; i < canList.length; i++) {         // 循环上面的数组，绘制绘画的点位
      cxt.lineTo(canList[i].left, canList[i].top)
    }
    cxt.stroke()
    table.append(cvs)
  }



  window.onresize = function () {
    canvas()
  }

  new Vue({
    el: '#Vue',
    data() {
      return {
        number_Arr: [null, '单', '双', ],
        list: [],
        arrSort1: '',
        arrSort2: '',
        累计1: 0,
        累计2: 0,
        tarNumber: 0,
        mask: false,
        active:""
      }
    },
    methods: {
      numberList() {
        this.list = []
        this.累计1 = this.累计2  = 0
        this.arrSort1 = this.arrSort2  = false
        $('#select_condition').html(` － 基本走势图 － 期数：${$('select[name="periods_number"]').val()}`)
        var date = new Date()
        let n = date.getFullYear()
        let y = date.getMonth()
        let r = date.getDate()
        if (y == 0) {
            y += 1
        }
        var time = n + '-' + y + '-' + r
        $.ajax({
          method: 'POST',
          url: `${config.url}/Lottery/LadderBet/GetLadderBetResultList`,
          data: {
            rows: $('select[name="periods_number"]').val(),
            date: time,
            page: 1,
            gameType: 'tz',
          },
          crossDomain: true, //设置跨域为true
					xhrFields: {
						withCredentials: true //默认情况下，标准的跨域请求是不会发送cookie的
					},
          success: x => {
            this.mask = false
            this.list = x.rows
            for (let i = this.list.length - 1; i >= 0; i--) {
              var obj = {}
              var 开奖号 = this.list[i].Content.split('|')
              obj.开奖号 = 开奖号
              obj.list = []
              this.tarNumber = obj.开奖号[this.tarNumber]
              if(obj.开奖号.slice(0,1)+obj.开奖号.slice(1,3) == 00){
                this.active = "ladder-piece ladder-piece-img_bet_00"
              }else if(obj.开奖号.slice(0,1)+obj.开奖号.slice(1,3) == 11){
                this.active = "ladder-piece ladder-piece-img_bet_11"
              }else if(obj.开奖号.slice(0,1)+obj.开奖号.slice(1,3) == 01){
                this.active = "ladder-piece ladder-piece-img_bet_01"
              }else if(obj.开奖号.slice(0,1)+obj.开奖号.slice(1,3) == 10){
                this.active = "ladder-piece ladder-piece-img_bet_10"
              }
              if (obj.开奖号.slice(0,1)+obj.开奖号.slice(1,3) ==01 ||obj.开奖号.slice(0,1)+obj.开奖号.slice(1,3)==10 ) {
                this.累计1 = 0
              } else {
                this.累计1++
              }
              if (obj.开奖号.slice(0,1)+obj.开奖号.slice(1,3) ==11 ||obj.开奖号.slice(0,1)+obj.开奖号.slice(1,3)==00 ) {
                this.累计2 = 0
              } else {
                this.累计2++
              }
             
              obj.list.push({
                累计1: this.累计1,
                累计2: this.累计2,
                active:this.active
               
              })
              this.list[i].obj = obj
            }
            this.arrSort1 = Math.max.apply(Math, this.list.map(function (o) { return o.obj.list[0].累计1 }))
            this.arrSort2 = Math.max.apply(Math, this.list.map(function (o) { return o.obj.list[0].累计2 }))
            this.$nextTick(() => {
              canvas()
              $('.red-total').html($('.ball.red').length)
              $('.green-total').html($('.ball.green').length)
            })
          },
          error: x => {
            console.log(x)
          }
        })
      },
      GoSelect() {
        this.mask = true
        this.numberList()
      },
      changeSpan() {
        
      }
    },
    mounted() {
      this.mask = true
      this.numberList();
      this.changeSpan()
    },
  })


</script>

</html>