<link rel="stylesheet" href="css/reset.min.css">
<link rel="stylesheet" href="css/bootstrap.min.css">
<link rel="stylesheet" href="css/font-awesome.min.css">
<link rel="stylesheet" href="css/jquery-ui.min.css">
<link rel="stylesheet" href="css/jquery.datetimepicker.min.css">
<link rel="stylesheet" href="css/jquery.Scrollbar.css">
<link rel="stylesheet" href="css/font.css">
<link rel="stylesheet" href="css/loading.css">
<link rel="stylesheet" href="css/ZgCreate.min.css">
<link rel="stylesheet" href="css/Page_mem.min.css">
<link rel="stylesheet" href="css/ZgWindow.min.css">
<link rel="stylesheet" href="css/custom.css">
<link rel="stylesheet" href="css/poker.css">
<link rel="stylesheet" href="css/stylesheet.css">
<link rel="stylesheet" href="css/reset.min.css">
<link rel="stylesheet" href="css/custom2.css">
<link rel="stylesheet" href="css/style-desktop.css">
<link rel="stylesheet" href="css/VDNLottery.css">
<link rel="stylesheet" href="css/others.css">
<link rel="stylesheet" type="text/css" href="./css/ladder.css">

<div id="OrderList" style="height: 100%;">
  <div class="common_form">
    <div class="report_top" style="position:relative;">
      <div class="report_left">
        <span>彩 类 :</span>
        <select name="select_type">
          <option value="梯子游戏">梯子游戏</option>
          <option value="蜗牛赛跑">蜗牛赛跑</option>
        </select>
      </div>
      <div class="report_date">
        <div class="report_date_name">浏览日期</div>
        <div class="report_date_choice">
          <div class="report_date_choice_div">
            <input type="text" name="s_date" class="dpk" autocomplete="off">
            <img src="./images/calendar.png" alt="">
          </div>
          <div class="report_date_choice_div">
            <input type="text" name="e_date" class="dpk" autocomplete="off">
            <img src="./images/calendar.png" alt="">
          </div>
        </div>
        <div class="report_date_small_chi">
          <ul class="clearfix">
            <li><a href="javascript:void(0)" id="Today" class="btn-red">今日</a></li>
            <li class="last"><a href="javascript:void(0)" id="Yesterday" class="btn-red">昨日</a></li>
          </ul>
          <ul class="clearfix">
            <li><a href="javascript:void(0)" id="Thisweek" class="btn-red">本周</a></li>
            <li class="last"><a href="javascript:void(0)" id="Lastweek" class="btn-red">上周</a></li>
          </ul>
          <ul class="clearfix">
            <li><a href="javascript:void(0)" id="Thismonth" class="btn-red">本月</a></li>
            <li class="last"><a href="javascript:void(0)" id="Lastmonth" class="btn-red">上月</a></li>
          </ul>
        </div>
      </div>
      <div class="record_right">
        <div class="record_search btn-red" id="GoSelect">报表查询</div>
      </div>
      <div class="record_explain"></div>
    </div>
    <div class="record_dep_closet">
      <table class="record_dep">
        <tr>
          <td class="record_dep_txt">*投注报表</td>
          <td class="record_dep_txt">彩 类：<span id="OrderGameName"> 梯子游戏 </span></td>
          <td class="record_dep_txt"><span id="OrderSDate"></span> - <span id="OrderEDate"></span></td>
          <td style="font-weight: 600;">※请按查询送出※ 05:00:00 为跨日基准。</td>
          <!-- <td class="record_dep_atten">贴心小提醒：点击号码能查询详细投注明细</td> -->
        </tr>
      </table>
    </div>
    <div>
      <div id="OrderReportDiv" style="display:block">
        <div class="OrderReportDiv_inner">
          <table width="100%">
            <tbody>
              <tr class="record_dep_nav">
                <th width="20%" class="record_dep_nav_menu">报表日期</th>
                <th width="20%" class="record_dep_nav_menu">投注总额</th>
                <th width="20%" class="record_dep_nav_menu">有效笔数</th>
                <th width="20%" class="record_dep_nav_menu">有效投注</th>
                <th width="20%" class="record_dep_nav_menu">实际盈亏</th>
                <!--  <th width="362" class="record_dep_nav_menu">功能操作</th> -->
              </tr>
            </tbody>
          </table>
          <div class="report_scorllbar" style="overflow: auto;">
            <table width="100%" id="ReportContent" class="record_dep_main">
              <tbody>

              </tbody>
            </table>
          </div>
        </div>

        <div class="report_footer" style="margin-top:0px;">
          <ul class="report_sum">
            <li class="total">总计</li>
            <li>投注总额</li>
            <li class="amount" id="report_bet_money"> 0 </li>
            <li>有效笔数</li>
            <li class="amount" id="report_bet_num"> 0 </li>
            <li>有效投注总额</li>
            <li class="amount" id="report_effective_money"> 0 </li>
            <li>实际盈余</li>
            <li class="amount" id="report_bet_real_pl"> 0 </li>
          </ul>
        </div>
      </div>

      <div id="OrderListDiv" style="display:none;">
        <div class="OrderListDiv_inner">
          <table width="100%">
            <tbody>
              <tr class="record_dep_nav">
                <th width="110" class="record_dep_nav_menu">注单号</th>
                <th width="110" class="record_dep_nav_menu">彩 种</th>
                <th width="110" class="record_dep_nav_menu">期 号</th>
                <th width="154" class="record_dep_nav_menu">玩 法</th>
                <th width="77" class="record_dep_nav_menu">下注金额</th>
                <th width="77" class="record_dep_nav_menu">有效投注</th>
                <th width="77" class="record_dep_nav_menu">返水金额</th>
                <th width="77" class="record_dep_nav_menu">中奖金额</th>
                <th width="77" class="record_dep_nav_menu">返还金额</th>
                <th width="77" class="record_dep_nav_menu">实际盈亏</th>
                <th width="77" class="record_dep_nav_menu">状态</th>
              </tr>
            </tbody>
          </table>
          <div class="order_scorllbar">
            <table width="100%" id="ReportContent" class="record_dep_main">
              <tbody>
                <tr class="record_dep_list" style="display: none;">
                  <td width="120" class="record_dep_list_txt">
                    <div class="ellipsis_width" style="width: 80px; padding-left: 8px;">1a908096968e93e478ad99d12d07bde4
                    </div>
                  </td>
                  <td width="120" class="record_dep_list_txt">重庆时时彩</td>
                  <td width="120" class="record_dep_list_txt">20150922050</td>
                  <td width="154" class="record_dep_list_txt">后三(一码不定位)</td>
                  <td width="77" class="record_dep_list_txt"><span>10</span></td>
                  <td width="77" class="record_dep_list_txt"><span>1.26</span></td>
                  <td width="77" class="record_dep_list_txt"><span>9.408</span></td>
                  <td width="77" class="record_dep_list_txt"><span>10.668</span></td>
                  <td width="77" class="record_dep_list_txt"><span class="blue">0.668</span></td>
                  <td width="77" class="record_dep_list_txt right">中奖</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        <div class="report_footer" style="margin-top:0px;">
          <ul class="report_sum">
            <li class="total">总计</li>
            <li>下注金额:</li>
            <li class="amount" id="order_bet_money"> 0 </li>
            <li>有效投注:</li>
            <li class="amount" id="order_effective_money"> 0 </li>
            <li>返水金额:</li>
            <li class="amount" id="order_rakeback"> 0 </li>
            <li>中奖金额:</li>
            <li class="amount" id="order_bouns_money"> 0 </li>
            <li>返还金额:</li>
            <li class="amount" id="order_back_money"> 0 </li>
            <li>实际盈亏:</li>
            <li class="amount" id="order_bet_real_pl"> 0 </li>
            <li>笔数:</li>
            <li class="amount" id="order_bet_bet_count"> 0 </li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>
<script src="./webConfig/config.js"></script>
<script src="./js/moment.js"></script>
<script type="text/javascript" src="./js/jquery-3.1.0.min.js"></script>
<script type="text/javascript" src="./js/jquery-migrate-3.0.0.min.js"></script>
<script type="text/javascript" src="./js/jquery-ui.min.js"></script>
<script type="text/javascript" src="./js/bootstrap.min.js"></script>
<script type="text/javascript" src="./js/jquery.datetimepicker.min.js"></script>
<script type="text/javascript" src="./js/jquery.Scrollbar.js"></script>
<script type="text/javascript" src="./js/jquery.scrollbar.min.js"></script>
<script>
  $.fn.datetimepicker.defaults.lang = "zh_cn";
</script>
<script type="text/javascript" src="./js/global.js"></script>
<script type="text/javascript" src="./js/loading.js"></script>
<script type="text/javascript" src="./js/ZgCreate.js"></script>
<script type="text/javascript" src="./js/Page_mem.js"></script>
<script type="text/javascript" src="./js/js_computing.min.js"></script>
<script type="text/javascript" src="./js/ZgCountDown.js"></script>
<script type="text/javascript" src="./js/ZgWindow.min.js"></script>
<script type="text/javascript" src="./js/peasantcalendar.js"></script>
<script type="text/javascript" src="./js/poker.js"></script>
<script src="./js/zh_cn.js"></script>

<script>
  var startFormat = "YYYY-MM-DD 05:00";
  var endFormat = "YYYY-MM-DD 05:00";
  var OrderReport = function () {
    var $this = this;
    var that = $("#OrderList");
    var that_win = that.closest(".Windows");
    this.loading = function (Open) {
      if (Open) {
        that.children(".bg_mask").show();
      } else {
        that.children(".bg_mask").hide();
      }
    };
    var catch_order_info_ajax = false;
    this.CatchOrderInfo = function () {
      that.find("#OrderContent").stop(true, false).fadeIn().siblings().hide();
      if (catch_order_info_ajax) {
        catch_order_info_ajax.abort();
      };
      var s_date = $.trim(that.find("input[name='s_date']").val());
      var e_date = $.trim(that.find("input[name='e_date']").val());
      var send = {};
      send.gameType = that.find("select[name='select_type']").val() == '蜗牛赛跑' ? 'wnsp' : 'tz';
      send.datetime = s_date + ' 至 ' + e_date
      if (send.s_date == "" || send.e_date == "") {
        return;
      };
      var url = `${config.url}/Lottery/SnailBet/GetSanilBetReport `;
      var data = send;

      $.ajax({
        type: "post",
        url: url,
        crossDomain: true, //设置跨域为true
        xhrFields: {
          withCredentials: true //默认情况下，标准的跨域请求是不会发送cookie的
        },
        data: data,
        success: function (obj) {
          // ajax_get(url, data, function () {
          //   $this.loading(true);
          // }).always(function () {
          //   $this.loading(false);
          // }).done(function (obj) {
            $('#OrderGameName').html($("select[name='select_type']").val());
            // obj = JSON.parse(obj);
            that.find("#OrderSDate").html($('input[name="s_date"]').val());
            that.find("#OrderEDate").html($('input[name="e_date"]').val());
            CreateOrderBetInfo(obj);
          // });
        },
        error: function (err) {
          console.log(err)
        }
      });
      // ajax_get(url, data, function () {
      //   $this.loading(true);
      // }).always(function () {
      //   $this.loading(false);
      // }).done(function (obj) {
      //   $('#OrderGameName').html($("select[name='select_type']").val());
      //   obj = JSON.parse(obj);
      //   that.find("#OrderSDate").html($('input[name="s_date"]').val());
      //   that.find("#OrderEDate").html($('input[name="e_date"]').val());
      //   CreateOrderBetInfo(obj);
      // });
    };

    var CreateOrderBetInfo = function (BetInfo) {
      var t_body = that.find("#OrderReportDiv #ReportContent tbody");
      t_body.html("");
      if (!BetInfo.total) {
        t_body.append(`<tr class="record_dep_list">
                      <td colspan="5" class="record_dep_list_txt">尚无资料。</td>
                    </tr>`);
        $('#report_bet_money').html(0);
        $('#report_bet_num').html(0);
        $('#report_effective_money').html(0);
        $('#report_bet_real_pl').html(0);
        return;
      } else {
        BetInfo.rows.map(item => {
          t_body.append(`<tr class="record_dep_list">
									<td width="20%" class="record_dep_list_txt">${item.Date}</td>
									<td width="20%" class="record_dep_list_txt">${item.BetAmount}</td>
									<td width="20%" class="record_dep_list_txt">${item.BetCount}</td>
									<td width="20%" class="record_dep_list_txt">${item.ValidatBetAmount}</td>
									<td width="20%" class="record_dep_list_txt">${item.ResultMoney}</td>
								</tr>`)
        })
        $('#report_bet_money').html(BetInfo.footer[0].BetAmount);
        $('#report_bet_num').html(BetInfo.footer[0].BetCount);
        $('#report_effective_money').html(BetInfo.footer[0].ValidatBetAmount);
        $('#report_bet_real_pl').html(BetInfo.footer[0].ResultMoney);
      }
    };
    var dpk_today = function () {
      var today = moment(new Date());
      var today_str = today.format(startFormat);
      var today_end = today.add(1, 'days').format(endFormat);
      that.find("input[name='s_date']").val(today_str);
      that.find("input[name='e_date']").val(today_end);
    };
    var dpk_yesterday = function () {
      var yesterday = moment(new Date()).subtract(1, 'd');;
      var yesterday_str = yesterday.format(startFormat);
      var yesterday_end = yesterday.add(1, 'days').format(endFormat);
      that.find("input[name='s_date']").val(yesterday_str);
      that.find("input[name='e_date']").val(yesterday_end);
    };
    var dpk_thisweek = function () {
      var thisWeek = moment(new Date()).startOf('week');
      var thisWeek_str = thisWeek.format(startFormat);
      var thisWeek_end = thisWeek.endOf('week').add(1, 'days').format(endFormat);
      that.find("input[name='s_date']").val(thisWeek_str);
      that.find("input[name='e_date']").val(thisWeek_end);
    };
    var dpk_lastweek = function () {
      var thisWeek = moment(new Date()).subtract(1, 'w').startOf('week');
      var s_str = thisWeek.format(startFormat);
      var e_str = thisWeek.endOf('week').add(1, 'days').format(endFormat);
      that.find("input[name='s_date']").val(s_str);
      that.find("input[name='e_date']").val(e_str);
    };
    var dpk_thismonth = function () {
      var thisMonth = moment(new Date()).startOf('month');
      var s_str = thisMonth.format(startFormat);
      var e_str = thisMonth.endOf('month').add(1, 'days').format(endFormat);
      that.find("input[name='s_date']").val(s_str);
      that.find("input[name='e_date']").val(e_str);
    };
    var dpk_lastmonth = function () {
      var LastMonth = moment(new Date()).subtract(1, 'M');
      var s_str = LastMonth.startOf('month').format(startFormat);
      var e_str = LastMonth.endOf('month').add(1, 'days').format(endFormat);
      that.find("input[name='s_date']").val(s_str);
      that.find("input[name='e_date']").val(e_str);
    };
    var resize = function () {
      that.find(".report_scorllbar").height(that.height() - 321);
      that.find(".order_scorllbar").height(that.height() - 321);
    };
    var init = function () {
      that.css("position", "relative");
      that.append($('<div/>').addClass("bg_mask"));
      /*時間選擇器*/
      that.find('.dpk').datetimepicker({
        format: "Y-m-d H:i",
        defaultTime: '05:00',
        timepicker: true
      });
      dpk_today();
      that.find("#Today").click(function () {
        dpk_today();
      });
      that.find("#Yesterday").click(function () {
        dpk_yesterday();
      });
      that.find("#Thisweek").click(function () {
        dpk_thisweek();
      });
      that.find("#Lastweek").click(function () {
        dpk_lastweek();
      });
      that.find("#Thismonth").click(function () {
        dpk_thismonth();
      });
      that.find("#Lastmonth").click(function () {
        dpk_lastmonth();
      });
      that.find("#GoSelect").click(function () {
        $this.CatchOrderInfo();
      });

      that_win.resize(function () {
        resize();
      });
    };
    init();
  };
  var order_report = new OrderReport()

</script>