<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no,minimal-ui,viewport-fit=cover">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>特邀嘉宾</title>
    <!-- <link rel="stylesheet" href="bootstrap-3.3.7/css/bootstrap.css"> -->
    <link rel="stylesheet" href="swiper/css/swiper.css">
    <link rel="stylesheet" href="sweetalert2/sweetalert2.min.css">
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div id="vue" v-cloak>
        <!-- v-show="backShow" -->
        <div class="back" @click="back()">
            返回
        </div>
        <div class="content">
            <img class="bg_1" src="image/bg.jpg" />
            <div class="text_center bg_2">
                <img src="image/文字.png" />
            </div>
            <div class="swiper_box">
                <div class="swiper-container">
                    <div class="swiper-wrapper">
                        <div class="swiper-slide" v-for="(item, index) in list" :key="index">
                            <!-- <div class="item" :class="getclass(item)" @click="lingqu(index)"> -->
                            <div class="item" :class="item.className" @click="lingqu(index,item)">
                                <div class="hongbao_1">
                                    <img class="hongbao_1" src="image/红包1.png" />
                                </div>
                                <img class="lingqu" src="image/已领取1.png" />
                                <img class="shixiao" src="image/已失效1.png" />
                                <div class="text">
                                    <div class="day">
                                        <span>{{item.day}}</span>
                                    </div>
                                    <div class="tishi_1">充值{{item.chongzhi}}元</div>
                                    <div class="huode">
                                        <!-- <img src="image/红包.png" /> -->
                                        <span>获得</span>
                                        <span class="money">{{item.zengsong}}</span>
                                        <span>元</span>
                                    </div>
                                    <div class="btn_1">立即领取</div>
                                </div>
                                <div class="mask"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="guize">
                <img src="image/规则.png" alt="" srcset="">
            </div>

            <div class="start_stop" @click="addNumber()"></div>

            <div class="loading" v-show="loading">
                <div>
                    <img src="image/加载中.png" alt="" srcset="">
                </div>
            </div>
            <!-- <div @click="lingqu()">
                    领取
                </div> -->
        </div>
    </div>
    <script src="rem.js"></script>
    <script src="jquery-3.4.1.min.js"></script>
    <script src="vue.js"></script>
    <script src="swiper/js/swiper.js"></script>
    <!-- <script src="sweetalert2/sweetalert2.all.js"></script> -->
    <script src="sweetalert2/sweetalert2.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/promise-polyfill"></script>
    <!-- <script src="bootstrap-3.3.7/js/bootstrap.js"></script> -->
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/6.4.4/babel.min.js"></script> -->
    <script>
        Vue.config.productionTip = false
        var url = ""
        // var url = 'http://10.10.27.150:3001/api'
        $.ajaxSetup({
            crossDomain: true,
            xhrFields: {
                withCredentials: true
            }
        });
        function GetRequest() {
            var url = location.search;
            var theRequest = new Object();
            if (url.indexOf("?") != -1) {
                var str = url.substr(1);
                strs = str.split("&");
                for (var i = 0; i < strs.length; i++) {
                    theRequest[strs[i].split("=")[0]] = decodeURI(strs[i].split("=")[1]);
                }
            }
            return theRequest;
        }
        new Vue({
            el: "#vue",
            data:{
                list: [
                    { day: '第一天', 'chongzhi': 0.1, 'zengsong': 7, index_1: '1', index_2: 1 ,className:""},
                    { day: '第一天', 'chongzhi': 0.2, 'zengsong': 7, index_1: '1', index_2: 2 ,className:""},
                    { day: '第一天', 'chongzhi': 0.3, 'zengsong': 7, index_1: '1', index_2: 3 ,className:""},
                    { day: '第二天', 'chongzhi': 0.4, 'zengsong': 8, index_1: '2', index_2: 1 ,className:""},
                    { day: '第二天', 'chongzhi': 0.5, 'zengsong': 8, index_1: '2', index_2: 2 ,className:""},
                    { day: '第二天', 'chongzhi': 0.6, 'zengsong': 8, index_1: '2', index_2: 3 ,className:""},
                    { day: '第三天', 'chongzhi': 1, 'zengsong': 9, index_1: '3', index_2: 1 ,className:""},
                    { day: '第三天', 'chongzhi': 5, 'zengsong': 9, index_1: '3', index_2: 2 ,className:""},
                    { day: '第三天', 'chongzhi': 10, 'zengsong': 9, index_1: '3', index_2: 3 ,className:""},
                    { day: '第四天', 'chongzhi': 60, 'zengsong': 30, index_1: '4', index_2: 1 ,className:""},
                    { day: '第五天', 'chongzhi': 200, 'zengsong': 40, index_1: '5', index_2: 1 ,className:""},
                    { day: '第六天', 'chongzhi': 800, 'zengsong': 66, index_1: '6', index_2: 1 ,className:""},
                ],
                backShow: false,
                time1: "",
                number: 0,
                loading: false,
                lingquXQ: {
                    Day: 0,
                    DayCount: 0,
                    Days: ""
                },
                // lingquXQ:{"Day":3,"DayCount":1,"Days":"3-1"},
                swiper: "",

                swiper_index: 1,

            },
            methods: {
                back:function() {
                    history.back()
                },
                lingqu:function(index,item) {
                    console.log(index ,this.swiper_index , item)
                    if (index != this.swiper_index || item.className !='当前'){
                        return
                    }
                    // console.log(this.swiper.activeIndex)
                    var this_1 = this
                    this.loading = true
                    $.ajax({
                        type: "post",
                        url: url + "/MApi/Activity/Post",
                        data: { url: '/Activities/Vip3/Receive' },
                        success: function (x) {
                            console.log(x)
                            if (x.code == 0) {
                                Swal.fire({ icon: 'success', width: 300, text: '领取成功！' })
                                setTimeout(function(){
                                    this_1.chaxun()
                                }, 1000);
                            } else {
                                this_1.loading = false
                                if(x.code==2){
                                    swal.fire({ 
                                        title: '提示', 
                                        text: x.msg, 
                                        type: 'warning',
                                        showCancelButton: true, 
                                        confirmButtonText: '充值',
                                        cancelButtonText:"取消",
                                        reverseButtons:true,
                                    }).then(function(result){
                                        if (result.value) {
                                           parent.appVue.toChongzhi()
                                        }
                                    })
                                }else {
                                    Swal.fire({ icon: 'error', width: 300, text: x.msg, confirmButtonText: "好的" })
                                }
                            }
                        },
                        error: function (err) {
                            this_1.loading = false
                            Swal.fire({ icon: 'error', width: 300, text: '系统错误稍后再试' })
                        }
                    });
                },
                chaxun:function() {
                    var this_1 = this;
                    this.loading = true
                    $.ajax({
                        type: "post",
                        url: url + "/MApi/Activity/Post",
                        data: { url: "/Activities/Vip3/getinfo" },
                        success: function (x) {
                            if(x.msg=='您不在活动范围内'){
                                Swal.fire({title:"提示", width: 300, text: '若您是电话或短信特邀用户，请先联系客服领取资格。若您是普通会员还可以关注本公司其他活动，感谢您的支持！', confirmButtonText: "好的" })
                                this_1.qunbuShixiao()
                            }else if (x.msg) {
                                Swal.fire({ icon: 'error', width: 300, text: x.msg })
                                this_1.qunbuShixiao()
                            } else {
                                // var x = {"Day":1,"DayCount":3,"Days":"1-3","currCount":4}
                                    if(x.Day<4){
                                        if(x.currCount==4){
                                            x.Day = x.Day+1
                                            x.currCount = 1
                                        }
                                    }else{
                                        if(x.currCount==2){
                                            x.Day = x.Day+1
                                            x.currCount = 1
                                        }
                                    }
                                this_1.lingquXQ = x
                                this_1.setClassName()                                    
                            }
                            this_1.loading = false
                        },
                        error: function (err) {
                            Swal.fire({ icon: 'error', width: 300, text: '系统错误稍后再试' })
                            this_1.loading = false
                            this_1.qunbuShixiao()
                        }
                    });
                },
                qunbuShixiao:function(){
                    for (var i = 0; i < this.list.length; i++) {
                        this.list[i].className ='yishixiao'
                    }
                },
                setClassName:function(){
                    var this_1 = this;
                    var Days = this.lingquXQ.Days
                        Days = Days.split(',');
                        console.log(Days)
                    var index = 0

                    this.list.map(function(item, index){
                        var item = this_1.list[index]
                        if (this_1.lingquXQ.Day > item.index_1) {
                            var day = Days.find(function (x) {
                                return x.startsWith(item.index_1);
                            });
                            if (day) {
                                // console.log(day[2],item.index_2)
                                if (day[2] >= item.index_2) {
                                    // console.log('已领取')
                                    item.className = 'yilingqu'
                                } else {
                                    // console.log('已失效')
                                    item.className = 'yishixiao'
                                }
                            } else {
                                // console.log('已失效')
                                item.className = 'yishixiao'
                            }
                        } else if(this_1.lingquXQ.Day == item.index_1){
                            // 是不是当天
                            var currCount = this_1.lingquXQ.currCount;
                            if(currCount > item.index_2){
                                console.log(currCount , item.index_2)
                                item.className = 'yilingqu'
                            }else if(currCount == item.index_2){
                                item.className = '当前'
                                this_1.swiper_index = index
                                this_1.swiper.slideTo(this_1.swiper_index , 0, false);//切换到第一个slide，速度为1秒
                            }else{
                                item.className = '不可领取'
                            }
                        }else{
                            item.className = '不可领取'
                        }
                    })
                },
                addNumber:function() {
                    this.number++
                    var this_1 = this
                    if (this.number >= 10) {
                        this.jinYong()
                    }
                    try {
                        clearTimeout(this.time1)
                    } catch (error) { }
                    this.time1 = setTimeout(function(){
                        this_1.number = 0
                    }, 1000);
                },
                // 禁用
                jinYong:function() {
                    var this_1 = this
                    // var pwd=prompt("请输入密码","")
                    swal.fire({
                        title: '请输入密码',
                        input: 'text',
                        showCancelButton: true,
                        confirmButtonText: '确定',
                        cancelButtonText: "取消",
                        reverseButtons: true,        //将“确认”按钮放到右边
                        preConfirm: function (x) {
                            if(!x){
                                // Swal.showValidationMessage(`请输入密码`)
                                alert('请输入密码')
                                return false
                            }else{
                                this_1.jinYong2(x)
                            }
                            // return new Promise(function (resolve, reject) {
                            //     if (!x) {
                            //         Swal.showValidationMessage(`请输入密码`)
                            //         resolve(false);
                            //     } else {
                            //         resolve();
                            //     }
                            // });
                        },
                    })
                   
                },
                jinYong2:function(pwd){
                    this.loading = true
                    if (pwd != null && pwd != "") {
                        $.ajax({
                            type: "post",
                            url: url + "/MApi/Activity/Post",
                            data: { url: '/Activities/Vip3/Stop', s: pwd },
                            success: function (x) {
                                if (x.code == 0) {
                                    Swal.fire({ icon: 'success', width: '80%', text: '设置成功!' })
                                } else {
                                    Swal.fire({ icon: 'error', width: 300, text: x.msg })
                                }
                                this_1.loading = false
                            },
                            error: function (err) {
                                this_1.loading = false
                                Swal.fire({ icon: 'error', width: 300, text: '系统错误稍后再试!' })
                            }
                        });
                    }
                },
                setVip引导:function(){
                    $.ajax({
                        type: "post",
                        url: url + "/other/play/SetGuideVip",
                        data: {stat:true},
                        success: function (x) {
                            console.log(x)
                        },
                        error:function(err){
                            console.log(err)
                        }
                    });
                }
            },
            mounted:function() {
                this.setVip引导()
                var this_1 = this
                
                this.swiper = new Swiper('.swiper-container', {
                    effect: 'coverflow',
                    // grabCursor: true,   //鼠标为手的样式
                    slideToClickedSlide: true,
                    centeredSlides: true,
                    // initialSlide: this.swiper_index,    //默认第几个
                    slidesPerView: 'auto',
                    spaceBetween: 30,
                    coverflowEffect: {
                        rotate: 0, //slide做3d旋转时Y轴的旋转角度。默认50。
                        stretch: 0, //每个slide之间的拉伸值，越大slide靠得越紧。 默认0。
                        depth: 200, //slide的位置深度。值越大z轴距离越远，看起来越小。 默认100。
                        modifier: 1, //depth和rotate和stretch的倍率，相当于depth*modifier、rotate*modifier、stretch*modifier，值越大这三个参数的效果越明
                        slideShadows: false,    //开启slide阴影。默认 true
                    },
                    on: {
                        slideChangeTransitionEnd: function () {
                            if (this_1.swiper.activeIndex != undefined) {
                                this_1.swiper_index = this_1.swiper.activeIndex
                            }
                        }
                    },
                })

                this.chaxun()
                var Request = new Object();
                Request = GetRequest();
                if (Request.back) {
                    this.backShow = true;
                }
            }
        })
    </script>
</body>

</html>