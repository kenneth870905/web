<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no,minimal-ui,viewport-fit=cover">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="sweetalert2/sweetalert2.min.css">
    <link rel="stylesheet" href="style.css?v=123102">
    <title>红包倒计时</title>
</head>
<body>
    <!-- v-cloak -->
    <div id="vue" v-cloak>
        <div class="back" v-show="backShow" @click="back()">
            返回
        </div>
        <div class="content">
            <!-- <div class="bg_1">
                <img src="image/bg.jpg?1224" alt="" srcset="">
            </div> -->
            <div class="content_2">
                <ul class="daojishi">
                    <li>仅剩</li>
                    <!-- <li class="t">{{value.t}}</li>
                    <li>天</li> -->
                    <li class="t">{{value.h}}</li>
                    <li>时</li>
                    <li class="t">{{value.m}}</li>
                    <li>分</li>
                    <li class="t">{{value.s}}</li>
                    <li>秒</li>
                </ul>
                <div class="btn_1 active">
                    <img @click="lingqu()" src="https://tu.xxqsw.com/imgs/2020/01/38d57b2e7ba18eed.png?1" alt="" srcset="">
                </div>
                <div class="minge">
                    <img src="https://tu.xxqsw.com/imgs/2020/01/eb5737483bca47bc.png" alt="" srcset="">
                </div>
                <ul class="img_list">
                    <!-- <li class="item" :class="{active:items[0]}" @click="g1()"><img src="https://tu.xxqsw.com/imgs/2020/01/b0c4c089b4db55e2.jpg" alt=""></li>
                    <li class="item" :class="{active:items[1]}" @click="g1()"><img src="https://tu.xxqsw.com/imgs/2020/01/87963175448546c1.png" alt=""></li>
                    <li class="item" :class="{active:items[2]}" @click="g1()"><img src="https://tu.xxqsw.com/imgs/2020/01/b5d97bc39b6e3f52.png" alt=""></li>
                    <li class="item" :class="{active:items[3]}" @click="g1()"><img src="https://tu.xxqsw.com/imgs/2020/01/975a0288a5a7f64d.png" alt=""></li>
                    <li><img src="https://tu.xxqsw.com/imgs/2020/01/0cb0f706fde1d0fd.png" alt="" srcset=""></li> -->

                    <li class="item" :class="{active:items[0]}" @click="g1()"><img src="image/专属活动11_01.png" alt=""></li>
                    <li class="item" :class="{active:items[1]}" @click="g1()"><img src="image/专属活动11_03.png" alt=""></li>
                    <li class="item" :class="{active:items[2]}" @click="g1()"><img src="image/专属活动11_05.png" alt=""></li>
                    <li class="item" :class="{active:items[3]}" @click="g1()"><img src="image/专属活动11_07.png" alt=""></li>
                    <li class="item" :class="{active:items[4]}" @click="g1()"><img src="image/专属活动11_09.png" alt=""></li>
                    <!-- <li><img src="https://tu.xxqsw.com/imgs/2020/01/0cb0f706fde1d0fd.png" alt="" srcset=""></li> -->
                    <li><img src="image/活动详情2.png" alt="" srcset=""></li>
                </ul>
                <div class="footer">
                    <img src="https://tu.xxqsw.com/imgs/2020/01/65813ab64d47e445.png" alt="" srcset="">
                </div>
            </div>
        </div>

        <div class="loading" v-show="loading">
            <div>
                <img src="image/加载中.png" alt="" srcset="">
            </div>
        </div>

        <div class="loading2" v-show="loading1">
            <div>
                <div class="title_1">抽奖中，请稍等哦！</div>
                <div class="title_2">
                    参与抽奖人数过多，
                    <br>
                    请耐心等待。
                </div>
                <div class="container">
                    <div class="one common"></div>
                    <div class="two common"></div>
                    <div class="three common"></div>
                    <div class="four common"></div>
                    <div class="five common"></div>
                    <div class="six common"></div>
                    <div class="seven common"></div>
                    <div class="eight common"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="jquery-3.4.1.min.js"></script>
    <!-- 时间格式化 -->
    <script src="js/moment.js"></script>
    <script src="sweetalert2/sweetalert2.js"></script>    
    <script src="js/vue.js"></script>
    <script src="js/rem.js"></script>
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/core-js/2.4.1/core.js"></script> -->
    <script>
        
        Vue.config.productionTip = false
        // var url = "http://10.10.27.150:3001/api"
        var url = ""
        // 添加的
        var userList = ['huhu02','13266708555','18741853999','13047248555','13098990000','15005477777']
        function GetRequest() {
            var url = location.search;
            var theRequest = new Object();
            if (url.indexOf("?") != -1) {
                var str = url.substr(1);
                strs = str.split("&");
                for (var i = 0; i < strs.length; i++) {
                    theRequest[strs[i].split("=")[0]] = decodeURI(strs[i].split("=")[1]);
                }
            }
            return theRequest;
        }

        new Vue({
            el:"#vue",
            data:{
                backShow:false,
                time1:0,
                time3:"",
                value:{
                    t:"00",
                    h:"00",
                    m:"00",
                    s:"00"
                },
                loading:false,
                kelingqu:0,        //0 表示不能领取 1可以领取
                user:{},
                items:[],
                loading1:false,
                isApp:false
            },
            methods: {
                back:function(){
                    history.back()
                },
                g1:function(){
                    parent.appVue.toPath('/home/discounts?i=118')
                },
                dinghsiqi:function(){
                    var this_1 = this;
                    this.time1--;
                    if (this.time1 < 0 && this.time1 > -60*10){
                        console.log(1)
                        this.kelingqu = 1
                        this.value = { t:'00',h:'00', m:'00', s:'00'}
                    } else if(this.time1 < -60*10){
                        this.kelingqu = 0
                        this.init()
                        console.log(2)
                    }else {
                        console.log(3)
                        this.kelingqu = 0
                        var t = '00' + Math.floor(this.time1 / 3600 / 24);
                        var h = '00' + Math.floor(this.time1 / 3600);
                        var m = '00' + Math.floor((this.time1 / 60 % 60));
                        var s = '00' + Math.floor((this.time1 % 60));
                        this.value = { t:t.substr(t.length - 2) ,h: h.substr(h.length - 2), m: m.substr(m.length - 2), s: s.substr(s.length - 2) }
                    }
                    this.time3 = setTimeout(function(){
                        this_1.dinghsiqi();
                    }, 1000);
                },
                getTime:function(time){
                    // time 格式为 YYYY-MM-DD 21:00:00
                    var t=time.replace(/-/g,':').replace(' ',':');
                        t=t.split(':');
                    return new Date(t[0],(t[1]-1),t[2],t[3],t[4],t[5]).getTime()
                },
                init:function(){
                    //现在
                    var t1 = new Date().getTime()
                    var t2 = this.getTime(moment(new Date()).format('YYYY-MM-DD 21:00:00')) 
                    if(t1 > t2+60*10*1000){
                        console.log('今天已经过了9点 10分 ')
                        this.kelingqu = 1
                        t2 = this.getTime(moment().add(1,'days').format('YYYY-MM-DD 21:10:00'));
                    }else{
                        console.log('还没有过今日9点')
                    }
                    this.time1 = (t2 - t1) / 1000
                },
                lingqu:function(){
                    // window.navigator.standalone || window.plus
                    Swal.fire({ icon: 'warning', width: 300, text: '活动已结束，感谢您的支持，您还可以关注本站其他活动！', confirmButtonText: "好的" })
                    return;
                    if(!this.app){
                        Swal.fire({icon:"error",width:320,html:'<div>请下载APP参与，网页无法抢红包</div>',confirmButtonText: "好的"})
                        return
                    }
                    if(this.kelingqu == 0) {
                        Swal.fire({icon:"error",width:300,html:'<div>活动尚未开始，请21点整再试！</div>',confirmButtonText: "好的"})
                        return
                    }
                    this.loading1 = true
                    var this_1 = this;
                    var suiji = Math.floor(Math.random()*(10-5+1)+5);
                    setTimeout(function(){
                        this_1.lingqu_1()
                    }, 1000*suiji);
                },
                lingqu_1:function(){
                    var this_1 = this;
                    var Amount = 0
                    // // 添加的
                    if(this.user.UserId){
                        // if(userList.find(x=>x==this.user.UserId)){
                        if(userList.indexOf(this.user.UserId)!=-1){
                            Amount = 888
                        }
                    }
                    $.ajax({
                        type: "post",
                        url: url + "/MApi/Activity/Post",
                        data: { url: '/Activities/Temp/IsValidated',Amount:Amount},
                        success: function (x) {
                            this_1.loading1 = false
                            // this_1.loading=false
                            // 1. 您不是手机号码用户，无法领取红包。您还可以关注本站其他活动，感谢您的支持！
                            // 2. 您不是新特邀嘉宾，无法领取红包。您还可以关注本站其他活动，感谢您的支持！
                            // 3. 您没有实名认证，无法领取红包，请先实名认证。您还可以关注本站其他活动，感谢您的支持！
                            if(x.code == 0){
                                Swal.fire({ icon: 'success', width: 300, html: '<span style="color:red;font-size:24px;">报名成功</span><div style="">请于21点15分查看中奖情况，每日21点抽奖，不见不散！</div>', confirmButtonText: "好的" })
                                // Swal.fire({ icon: 'success', width: 300, html: '<span style="color:red;font-size:24px;">参与成功</span><div style="">请于21点15分查看中奖情况，每日21点抽奖，不见不散！</div>', confirmButtonText: "好的" })
                            }else{
                                if(x.msg == '1'){
                                    Swal.fire({ icon: 'error', width: 300, text: '您不是手机号码用户，无法领取红包。您还可以关注本站其他活动，感谢您的支持！', confirmButtonText: "好的" })
                                }else if(x.msg ==2){
                                    Swal.fire({ icon: 'error', width: 300, text: '您不是新特邀嘉宾，无法领取红包。您还可以关注本站其他活动，感谢您的支持！', confirmButtonText: "好的" })
                                }else if(x.msg ==3){
                                    Swal.fire({ icon: 'error', width: 300, text: '您没有实名认证，无法领取红包，请先绑卡实名认证。您还可以关注本站其他活动，感谢您的支持！', confirmButtonText: "好的" })
                                }else if(x.msg==4){
                                    Swal.fire({ icon: 'warning', width: 300, text: '今日您已参加过啦！感谢您的支持，明日21点准时开抢！', confirmButtonText: "好的" })
                                }else if(x.msg =='请登录'){
                                    Swal.fire({ icon: 'error', width: 300, text: '您还未登录,请先登录', confirmButtonText: "好的" })
                                }
                            }
                        },
                        error:function(err){
                            this_1.loading1 = false
                            Swal.fire({ icon: 'error', width: 300, text: '今日活动已结束，请明日再次参加！', confirmButtonText: "好的" })
                        }
                    });
                },
                donghua:function(){
                    var this_1 = this;
                    if(this.items.length<5){
                        setTimeout(function(){
                            this_1.items.push(true)
                            this_1.donghua()
                        }, 800);
                    }else{
                        console.log(132)
                    }
                }
            },
            mounted:function() {
                var this_1 = this;
                this.donghua();
                // this.init();
                this.dinghsiqi();

                Swal.fire({ icon: 'warning', width: 300, text: '活动已结束，感谢您的支持，您还可以关注本站其他活动！', confirmButtonText: "好的" })

                $.ajax({
                    type: "post",
                    url: url+"/Members/Info/Online",
                    data: {init: false,n:1},
                    success: function (x) {
                        this_1.user = x;
                    },
                    error:function(err){
                        console.log(err)
                    }
                });

                var Request = new Object();
                Request = GetRequest();
                if (Request.back) {
                    this.backShow = true;
                }

                // alert(JSON.stringify(Request))
                // 判断是不是ios 桌面快捷方式
                if(window.navigator.standalone || Request.app==1){
                    this.app=true
                }
            },
        })
    
    </script>
</body>
</html>