/*
    1.导航切换
    2.返回顶部
    3.公告栏目
    4.调查评价
    5.试玩
*/
//导航切换
$.fn.navChange = function () {
    $(window).scroll(function () {
        $offset = $('.placeholder').offset();//不能用自身的div，不然滚动起来会很卡
        if ($(window).scrollTop() > $offset.top) {
            $('.tb-menu').addClass('menu-small');
        } else {
            $('.tb-menu').removeClass('menu-small');
        }
    });
}
//返回顶部
$.fn.topControl = function () {
    $(window).scroll(function () {
        //返回顶部
        if ($(window).scrollTop() > 120)
            $('#tb-topcontrol #tb-returntop').fadeIn(100);
        else
            $('#tb-topcontrol #tb-returntop').fadeOut(100);

    });

    //返回顶部
    $('#tb-topcontrol #tb-returntop').click(function () {
        $('body,html').animate({ scrollTop: 0 }, 200);
        return false;
    });
}

// 公告栏目
function getAnno() {
    if ($(".notice_marquee").size() <= 0) return;
    $.invoke_api({ GetAnno: {} }, {
        success: function (data, textStatus, jqXHR) {
            if (data.Status == 1) {
                var liData = [];
                liData.push('<marquee style="cursor: pointer;position: absolute;line-height: 36px; color:#fff;" direction="left" scrolldelay="80" scrollamount="5" behavior="scroll"> ');
                $.each(data.row, function (i, o) {
                    //liData.push('<li data-title="' + o.Name + '" data-time="' + dateFormat(new Date(o.Time)) + '" ><span></span><a href="#">' + o.Text + '</a></li>');
                    liData.push('<span class="Tb-News-span" data-title="' + o.Name + '" data-time="" >' + o.Text + '</span>');
                });
                liData.push('</marquee>');
                $('.notice_marquee').append(liData.join(''));
            }
        }
    });
}

// 调查评价
$.fn.questConponent = function () {
    var _this = $(this);
    var questConponent = research({
        callBack: function (obj) {
            var postData = $('.quest-conter').getPostData();
            $.invoke_api({ NewVerFeedback: { LevelID: postData.n1, Content: postData.n2 } }, {
                success: function (data, textStatus, jqXHR) {
                    if (data.Status == 16) { return loginConponent.Show(); }
                    if (data.Status == 1) {
                        $('body').parent().Dialog({
                            type: "Ok",
                            title: "体验报告",
                            messageTitle: "操作成功",
                            message: "您的评价已提交成功",
                            buttons: [{
                                name: "确定",
                                callback: function () { closeDialog(0); questConponent.Hide(); }
                            }],
                            closeHandler: function () { closeDialog(0); questConponent.Hide(); }
                        });
                    } else {
                        $('body').parent().Dialog({
                            type: "Err",
                            title: "体验报告",
                            messageTitle: "操作失败",
                            message: getMsg(data.Status),
                            buttons: [{
                                name: "确定",
                                callback: function () { closeDialog(0); questConponent.Hide(); }
                            }],
                            closeHandler: function () { closeDialog(0); questConponent.Hide(); }
                        });
                    }
                },
                complete: function () { },
                error: function () { }
            });
        },
        closeBack: function (obj) {
            questConponent.Hide();
            _this.removeClass('on');
        }
    });
    _this.click(function () {
        _this.addClass('on');
        questConponent.Show();
    });
}

function checkMaxInput(obj, maxLen) {
    if (obj == null || obj == undefined || obj == "")
        return;
    if (obj.value.length > maxLen) {
        obj.value = obj.value.substring(0, maxLen);
        return;
    }
    $('#max_quest').empty().append('剩{0}字'.format(maxLen - $(obj).val().length));
}


// 打开试玩 步骤一
function demoGame() {
    if (loginConponent.IsLogin()) {
        // 登录 
        return true;
    }
    var psp = $('.game-psp');
    if (!psp.length) {
        psp = $($('#game-psp-tpl').html().trim()).appendTo(document.body);
    }
    tryGameGetForm(psp.find('.on').attr('rel'));
    psp.fadeIn("slow");
}
// 关闭试玩窗口
function closeDemoGame(){
    $(".game-psp").fadeOut("slow");
}
// 开始试玩
function beginDemoGame() {
    //var $that = $(this);
    //var game = $('.game-psp').find('.on');
    //if (game.length < 1)
    //    return;// 请选择游戏厅

    //var gameType = game.eq(0).attr('rel');
    var gameType = $(this).attr('rel');

    if (gameType == "12") {
        if (loginConponent.IsLogin()) {
            // 登录 
            return true;
        } else {
            return openPlatformGame(12, null, true);
        }
    }
              
    $('#playgame' + gameType).submit();
    $('#tryGameForm').html('');
}
// 选中试玩游戏
function changeDemoGame(obj) {             
    var $that = $(obj);
    tryGameGetForm($that.attr('rel'));
    $that.parent().find("li").removeClass("on");
    $that.addClass("on");
    beginDemoGame.call($that);

}
function tryGameGetForm(typeGame) {
    var playgame = {
        '01' : '<form id="playgame01" target="_blank" method="post" action="http://777.tb34567.com/cl/?module=System&method=Live"      rel="<%=(int)GameID.BBIN %>" ></form>',
        '02' : '<form id="playgame02" target="_blank" method="post" action="http://777.tb34567.com/cl/?module=System&method=Game"      rel="<%=(int)GameID.BBIN %>" ></form>',
        '03' : '<form id="playgame03" target="_blank" method="post" action="http://777.tb34567.com/cl/?module=System&method=Ltlottery" rel="<%=(int)GameID.BBIN %>" ></form>',
        '04' : '<form id="playgame04" target="_blank" method="post" action="http://777.tb34567.com/cl/?module=System&method=ball"      rel="<%=(int)GameID.BBIN %>" ></form>',
        '15': '<form id="playgame15" target="_blank" method="get"  action="http://cache.download.banner.powerplay88.com/casinoclient.html" rel="<%=(int)GameID.PT %>">' +
                '<input type="hidden" name="language"   value="zh-cn" />'+
                '<input type="hidden" name="game"       value="jpgt" />'+
                '<input type="hidden" name="affiliates" value="1" />'+
                '<input type="hidden" name="mode"       value="offline" />'+
             '</form>',
        '18' : '<form id="playgame18" target="_blank" method="get"  action="https://amsgames.stg.ttms.co/casino/mobile/lobby/index.html" rel="<%=(int)GameID.TTG %>">'+
                '<input type="hidden" name="playerHandle"   value="999999" />'+
                '<input type="hidden" name="account"        value="FunAcct" />'+
                '<input type="hidden" name="lang"           value="zh-cn" />'+
             '</form>',
        '19' : '<form id="playgame19" target="_blank" method="get"  action="https://wildtreasure-gp3.discreetgaming.com/guestmode.do" rel="<%=(int)GameID.BSG %>">'+
                '<input type="hidden" name="bankId"   value="1914" />'+
                '<input type="hidden" name="gameId"   value="691" />'+
                '<input type="hidden" name="lang"     value="zh-cn" />'+
             '</form>',
        '11' : '<form id="playgame11" target="_blank" method="post" action="<%=ResolveUrl("~/Game/ag1.aspx")%>" rel="<%=(int)GameID.AG_AG   %>"><input type="text" name="trial" /></form>',
        '12' : '<form id="playgame12" target="_blank" method="post" action="<%=ResolveUrl("~/Game/ag2.aspx")%>" rel="<%=(int)GameID.AG_AGIN %>"><input type="text" name="trial" /></form>',
        '13': '<form id="playgame13" target="_blank" method="post" action="<%=ResolveUrl("~/Game/ag_SlotM.aspx")%>" rel="<%=(int)GameID.AG_AGIN %>"><input type="text" name="type"  value="6" /></form>',
        '21': '<form id="playgame21" target="_blank" method="get" action="http://play.dreamtech8.com/testgame/index.html" rel="<%=(int)GameID.DT %>"></form>',
        '17': '<form id="playgame17" target="_blank" method="get" action="https://redirect.contdelivery.com/Casino/Default.aspx" rel="<%=(int)GameID.MG_IN %>">'+
                '<input type="hidden" name="gameid"   value="ReelGems" />' +
                '<input type="hidden" name="theme"       value="igamingA" />' +
                '<input type="hidden" name="sext1" value="demo" />' +
                '<input type="hidden" name="sext2"       value="demo" />' +
                '<input type="hidden" name="csid"       value="2635" />' +
                '<input type="hidden" name="ul"       value="zh" />' +
                '<input type="hidden" name="applicationid"       value="1023" />' +
                '<input type="hidden" name="serverid"       value="2635" />' +
            + '</form>',
        '9': '<form id="playgame9" target="_blank" method="post" action="http://777.x0day.net/" rel="<%=(int)GameID.BBIN %>"></form>',
        '22': '<form id="playgame22" target="_blank" method="post" action="egame.aspx#22" rel="<%=(int)GameID.SW %>"></form>',
        '23': '<form id="playgame23" target="_blank" method="post" action="https://www.pragmaticplay.com/language/zh" rel="<%=(int)GameID.PP %>"></form>',
        '24': '<form id="playgame24" target="_blank" method="get" action="https://tb-api.claretfox.com/launch" rel="<%=(int)GameID.PS %>">'+
                    '<input type="hidden" name="host_id"   value="d89cbb84f594823edcfcd98b6637537b" />' +
                    '<input type="hidden" name="game_id"       value="PSS-ON-00019" />' +
                    '<input type="hidden" name="lang" value="zh-CN" />' +
                '</form>',
        '27': '<form id="playgame27" target="_blank" method="get" action="https://game.fafafa3388.com/launch_demo" rel="<%=(int)GameID.PS %>">' +
                '<input type="hidden" name="s" value="107027esfo" />' +
                '<input type="hidden" name="game_id" value="8" />' +
            '</form>',
        '28': '<form id="playgame28" target="_blank" method="get" action="http://play.ky206.com/jump.do" rel="<%=(int)GameID.KY %>"></form>',
        '30': '<form id="playgame30" target="_blank" method="get" action="https://h5c.cqgame.games/1074/" rel="<%=(int)GameID.CQ9 %>">' +
                '<input type="hidden" name="token" value="guest123" />' +
                '<input type="hidden" name="language" value="zh-cn" />' +
            '</form>',
        '31': '<form id="playgame31" target="_blank" method="get" action="https://agacw.playngonetwork.com/casino/PlayMobile" rel="<%=(int)GameID.PNG %>">' +
                // ?div=pngCasinoGame&pid=321&gid=goldencaravanmobile&lang=zh_CN&practice=1&width=1024px&height=768px
                '<input type="hidden" name="div" value="pngCasinoGame" />' +
                '<input type="hidden" name="pid" value="321" />' +
                '<input type="hidden" name="gid" value="goldencaravanmobile" />' +
                '<input type="hidden" name="lang" value="zh_CN" />' +
                '<input type="hidden" name="practice" value="1" />' +
                '<input type="hidden" name="width" value="1024px" />' +
                '<input type="hidden" name="height" value="768px" />' +
                '<input type="hidden" name="language" value="zh-cn" />' +
            '</form>',
        '32': '<form id="playgame32" target="_blank" method="get" action="http://demo.aiqp001.com/php/autologin.php" rel="<%=(int)GameID.QLY %>">'
    }
    $('#tryGameForm').html(playgame[typeGame]);
}
