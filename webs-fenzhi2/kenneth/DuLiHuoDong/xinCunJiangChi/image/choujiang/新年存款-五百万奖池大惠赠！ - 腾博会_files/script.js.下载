//var live800_url2 = 'http://f18op.livechatvalue.com/chat/chatClient/chatbox.jsp?companyID=522110&configID=53701&jid=1638214342';
//var live800_url2 = 'http://vfop.livechatvalue.com/chat/chatClient/chatbox.jsp?companyID=293933&configID=54000&jid=8086264846&lan=zh';
var live800_url2 = 'http://vftb18.livechatvalue.com/chat/chatClient/chatbox.jsp?companyID=293933&configID=54000&jid=8086264846&lan=zh';
var livechat_url = 'https://secure.livechatinc.com/licence/8699606/open_chat.cgi';

//function live800_chat(pagetitle) { window.open(live800_url2 + '&pagetitle=' + pagetitle, '', 'width=800,height=600,top=' + (window.screen.availHeight - 30 - 600) / 2 + ',left=' + (window.screen.availWidth - 10 - 800) / 2); }
//function liveChat(pagetitle) { window.open(live800_url2 + '&pagetitle=' + pagetitle, '', 'width=800,height=600,top=' + (window.screen.availHeight - 30 - 600) / 2 + ',left=' + (window.screen.availWidth - 10 - 800) / 2); }
function liveChat_default() {window.open(livechat_url, '', 'width=800,height=600,top=' + (window.screen.availHeight -30 -600) / 2 + ',left=' + (window.screen.availWidth -10 -800) / 2); }
function liveChat_800() { window.open(live800_url2, '', 'width=800,height=600,top=' + (window.screen.availHeight -30 -600) / 2 + ',left=' + (window.screen.availWidth -10 -800) / 2); }
/**
 * 访问客服
 */
function liveChat(){
    var siteId = 5000003, planId = 6;
    window.open('https://livechat.will11.com/chatserver/chatWindow.aspx?siteId=' + siteId + '&planId=' + planId, 'Comm100ChatWindow5000003', 'width=540,height=720,top=' + (window.screen.availHeight - 30 - 600) / 2 + ',left=' + (window.screen.availWidth - 10 - 800) / 2)

     //$.invoke_api({OnlineServices:{}},{
	 //	async:false,
	 //	success:function(data, textStatus, jqXHR){
	 //	    if (data.Status === 1) {
	 //	        if (data.row === "Livechat") {
	 //	            liveChat_default();
	 //	        }
	 //	        if (data.row === "Live800") {
	 //	            liveChat_800();
	 //	        }
	 //	    }
	 //	    else {
	 //	        liveChat_default();
	 //	    }
	 //	}
	 //});
}


var qqdata = [];
function qqwap_chat(o) {
    var tel;
    var rand = parseInt(Math.random() * 10) % 2 == 0;
    var $id = $('#' + o);

    if ($id.data('tel') == undefined) {
        if (rand) { tel = 800155268; } else { tel = 800031759; }
        $id.data('tel', tel);
    } else
        tel = $id.data('tel');

    if (!qqdata.some(function (q) { return q.tel == tel; })) { qqdata.push({ tel: tel, flag: true }); }
    qqdata.forEach(function (v, i) {
        if (v.flag) {
            v.flag = false;
            BizQQWPA.addCustom({ aty: '0', a: '0', type: '1', nameAccount: v.tel, selector: o });
        }
    });
}

function openQQWebchat() {
    var handle = window.open("./gameloading.html", "_blank", "toolbar=yes, location=yes, directories=no, status=no, menubar=yes, scrollbars=yes, resizable=no, copyhistory=yes, width=" + 800 + ", height=" + 600);
    var rand = parseInt(Math.random() * 10) % 2;
    var qqArray = ["http://wpa.b.qq.com/cgi/wpa.php?ln=1&key=XzgwMDE1NTI2OF80NTAyMDNfODAwMTU1MjY4XzJf", "http://wpa.b.qq.com/cgi/wpa.php?ln=1&key=XzgwMDAzMTc1OV80NTAyMDVfODAwMDMxNzU5XzJf"];
    var qq_url = qqArray[rand];
    handle.location.href = qq_url;
}

function is_login() { return $('.tb-login-h').length > 0; }

$.fn.val_trim = function () { return $.trim(this.val()); }

$.fn.getPostData = function (n) { var t = {}; return $('input[type="text"], input[type="hidden"], input[type="password"], input[type="radio"]:checked, select, textarea', this).each(function () { var i = $(this).prop("name") || ""; i.length > 0 && (t[i] = $.trim($(this).val()) || "", n == !0 && $(this).val("")) }), t }

$.fn.load2 = function (n, t, i, r) {
    return i && t && (t.data = JSON.stringify(i)), this.load(n, t, r)
}

$.fn.sliderShow = function () { function r(t, i, r, u) { n.find("li").eq(t).find("img").hide({ effect: "slide", direction: r, duration: 250 }), n.find("li").eq(i).find("img").show({ effect: "slide", direction: u, duration: 250 }) } function o(t, i) { n.find("li").eq(t).find("img").hide({ effect: "fade", duration: 250 }), n.find("li").eq(i).find("img").show({ effect: "fade", duration: 250 }) } function s(t, i) { n.find("li").eq(t).find("img").hide({ effect: "explode", duration: 800, pieces: 36 }), n.find("li").eq(i).find("img").show({ effect: "fade", duration: 400 }) } function u(t, i, r) { n.find("li").eq(t).find("img").hide({ effect: "clip", direction: r, duration: 250, complete: function () { n.find("li").eq(i).find("img").show({ effect: "clip", direction: r, duration: 250 }) } }) } function f(e) { var h, c; if ((clearTimeout(i), i = null, h = t.find("li.active").index(), h != e) && (c = n.find("li > img"), c.length != 0)) { e == undefined && (e = (h + 1) % c.length), c.stop(!0, !0), t.find("li").eq(h).removeClass("active"), t.find("li").eq(e).addClass("active"); switch (parseInt(Math.random() * 10)) { case 1: r(h, e, "up", "down"); break; case 2: r(h, e, "down", "up"); break; case 3: r(h, e, "left", "right"); break; case 4: r(h, e, "right", "left"); break; case 5: u(h, e, "up"); break; case 6: u(h, e, "down"); break; case 7: u(h, e, "left"); break; case 8: u(h, e, "right"); break; case 9: s(h, e, "right"); break; default: o(h, e) } i = setTimeout(f, 6000) } } var e = this, n = this.find("ul"), t = $("<ul><\/ul>").appendTo(e).addClass("slider_nav"), i; n.find("li").each(function () { $("img", this).hide(), $("<li><\/li>").appendTo(t) }), i = null, t.find("li").click(function () { f($(this).index()) }), f(0) }
$.fn.hoverSilder = function (s1, s2, s3, speed) {
    this.hover(
        function () {
            var isLogin = is_login();
            $(isLogin ? '.p1' : '.p2', this).show();
            $(isLogin ? '.p2' : '.p1', this).hide();
            $(s1, this).stop(true, true).show({ effect: "slide", direction: 'right', duration: speed });
            $(s2, this).stop(true, true).show({ effect: "slide", direction: 'down', duration: speed });
            $(s3, this).stop(true, true).show({ effect: "slide", direction: 'left', duration: speed });
        },
        function () {
            $(s1, this).stop(true, true).hide({ effect: "slide", direction: 'right', duration: speed });
            $(s2, this).stop(true, true).hide({ effect: "slide", direction: 'down', duration: speed });
            $(s3, this).stop(true, true).hide({ effect: "slide", direction: 'left', duration: speed });
        });
}

if (!window.console)
    window.console = { log: function () { },error: function(){} };

var IE7_PNG_SUFFIX = ".png";
$.blockUI.defaults.css = {};
$.blockUI.defaults.overlayCSS = {};

function addBookmark() { if (document.all) try { window.external.addFavorite(window.location.href, document.title) } catch (n) { alert("加入收藏失败，请使用Ctrl+D进行添加") } else window.sidebar ? window.sidebar.addPanel(document.title, window.location.href, "") : alert("加入收藏失败，请使用Ctrl+D进行添加") }

/**********************/
function egameLogin() {
    // $.invoke_api({ EgameptLogin: {} }, {
    //     async: true,
    //     invokeApi: true,
    //     url: resolveClientUrl + '.gameapi',
    //     success: function (data, textStatus, jqXHR) {
    //         $.cookie("ptlogin", data.row, { path: '/' });
    //     },
    //     error: function (xhr, ajaxOptions, thrownError) { }
    // });

    $.invoke_api({ Egamept_inLogin: {} }, {
        async: false,
        success: function (data, textStatus, jqXHR) {
            $.cookie("ptinlogin", data.row, { path: '/' });
        },
        error: function (xhr, ajaxOptions, thrownError) { }
    });

    $.invoke_api({ EgameptaLogin: {} }, {
        async: true,
        invokeApi: true,
        url: resolveClientUrl + '.gameapi',
        success: function (data, textStatus, jqXHR) {
            $.cookie("ptalogin", data.row, { path: '/' });
        },
        error: function (xhr, ajaxOptions, thrownError) { }
    });

    //$.invoke_api({ EgamebsgLogin: {} }, { async: true, success: function (data, textStatus, jqXHR) { }, error: function (xhr, ajaxOptions, thrownError) { } });
    //$.invoke_api({ EgamettgLogin: {} }, { invokeApi: true, url: resolveClientUrl + '.gameapi', async: true, success: function (data, textStatus, jqXHR) { }, error: function (xhr, ajaxOptions, thrownError) { } });
    //$.invoke_api({ EgamemgLogin: {} }, { invokeApi: true, url: resolveClientUrl + '.gameapi', async: true, success: function (data, textStatus, jqXHR) { }, error: function (xhr, ajaxOptions, thrownError) { } });
    $.invoke_api({ BbinMobileEnable: {} }, { invokeApi: true, url: resolveClientUrl + '.gameapi', async: true, success: function (data, textStatus, jqXHR) { }, error: function (xhr, ajaxOptions, thrownError) { } });
}
function login(acnt, pwd) {
    iapiLogin(acnt, pwd, "1", "zh-cn");
}
function logout(allSessions, realMode) {
    iapiLogout(allSessions, realMode);
}
/**********************/

function clearLoginInput() {
    $('input[name="n1"]', 'input[name="n2"]', 'input[name="n3"]').val("");
    $('.loginError').text("");
}

function removeLogin(btnObj, oldText) {
    if (!!btnObj) {
        $(btnObj).removeClass("btn-disabled");
        $(btnObj).get(0).disabled = false;
        $(btnObj).val(oldText);
    }
}


////////////////////////////////////////////////////
/**
 * 用户名登录
 * @param  {Boolean} isClogin [description]
 * @return {[type]}           [description]
 */
function btnLogin_click(isClogin) {
    var l_type = $("input.login-anniu-div").attr('data-type');
    if(l_type==="phoneLogin"){
        phoneLogin_click(isClogin);
        return;
    }
    var loadingObj = loadingPage({
        type: "load1",
        imgRootPath: imgRootPath,
        divClass: $("body")
    });
    var e = window.event || arguments.callee.caller.arguments[0];

    clearLoginInput();
    var login_error = $('.pop-login-err');
    if (e && (e.keyCode == 13 || e.type == 'click')) {
        if ($(".loading").size() > 0) {
            $(".loading").css({'zIndex':9999})
        }
        var btnObj = $('.login-anniu-div');
        //var oldText = $(btnObj).val();

        var $panel = $('.tb-login');
        var postData = $('.pop-login').getPostData();
        if (postData.n1 == '') { loadingObj.Hide(); $('input[name="n1"]', $('.pop-login')).focus(); return $(login_error).text('请输入账号').show().removeClass('d_n'); }
        if (!/^[A-Za-z0-9]+$/gi.test(postData.n1)) { loadingObj.Hide(); $('input[name="n1"]', $('.pop-login')).focus(); return $(login_error).text('输入的账号格式不正确！').show().removeClass('d_n'); }
        if (postData.n2 == '') { loadingObj.Hide(); $('input[name="n2"]', $('.pop-login')).focus(); return $(login_error).text('请输入密码').show().removeClass('d_n'); }
        //if (!/^(?=.*\d)(?=.*[a-zA-Z])[\da-zA-Z][^\\/#%'"".\??]{5,11}$/.test(postData.n2)) { $('input[name="n2"]', $('.pop-login')).focus(); return $(login_error).text('输入的密码格式不正确！').removeClass('d_n'); }
        //需要显示验证码
        // if (loginIsErr()) {
            // if (postData.n3 == '') { loadingObj.Hide(); $('input[name="n3"]', $('.pop-login')).focus(); return $(login_error).text('请输入验证码').show().removeClass('d_n'); }
            // if (!/^\w+$/.test($('input[name="n3"]', $('.pop-login')).val())) {
            //     loadingObj.Hide();
            //     $('input[name="n3"]', $('.pop-login')).focus();
            //     return $(login_error).text('验证码错误').show().removeClass('d_n');
            // }
        // }
        var loginData = { UserPassword: postData.n2, vcode: postData.n3};
        if (window.__CAPTCHA_OBJECT__) {
            var result = __CAPTCHA_OBJECT__.getValidate();
            if (!result) {
                return __CAPTCHA_OBJECT__.verify();
                return login_error.text('请完成验证').show();
                return alert('请完成验证');
            }
            loginData.geetest_challenge = result.geetest_challenge;
            loginData.geetest_validate = result.geetest_validate;
            loginData.geetest_seccode = result.geetest_seccode;
        }
        else {

        }
        postData.action = 'login';

        if ($(btnObj).val() == "登录中...") return;
        if (!!btnObj) {
            $(btnObj).addClass("btn-disabled");
            $(btnObj).get(0).disabled = true;
            $(btnObj).val("登录中...");
        }

        $.cookie("memberACNT", postData.n1, { path: '/' }); // 这里记录明文 用于post提交
        // geetest_challenge: result.geetest_challenge,
        //             geetest_validate: result.geetest_validate,
        //             geetest_seccode: result.geetest_seccode
        loadingObj.Show();
        $.invoke_api({ Login: loginData }, {
            //async: false,
            success: function (data) {
                setTimeout(function () {
                    loadingObj.Hide();
                }, 300);
                //console.log("登录结果:", data);
                switch(data.Status) {
                    case 1:
                        try {
                        $.cookie("ptpwd", postData.n2, { path: '/' });

                        loginConponent.CookieLive(data.row.Token, data.row.ACNT, data.row.HideACNT, data.row.Balance, data.row.GroupID, data.row.SID);
                        CheckInState.set(data.row.MallSigned , data.serverTime)
                        setTimeout(function () {
                            egameLogin();
                        }, 100);

                        if (!$.removeCookie("tengbo.login.error", { path: '/' })) {
                            $.removeCookie("tengbo.login.error");
                        }

                        if (!!isClogin) {
                            // 出纳柜台登录
                            $.cookie("pt_type", "pt", { path: '/' });
                            location.href = "/MemberCenter/Cdefault.aspx";
                        }
                        else {
                            setTimeout(function () {
                                loginConponent.Hide();
                                $('#login-lucencyDiv').show()
                                $('#login-lucencyDiv').hide();
                            }, 250);

                            //loginConponent.Hide();
                            //$('#login-lucencyDiv').show();
                            //setTimeout(function () {
                            //    $('#login-lucencyDiv').hide();
                            //}, 100);

                            loginConponent.ShowState(".login_member_top_state", "#login_member_state_operate");

                            //登录过期，处理
                            if ($.cookie("loginTimeoutData") != undefined) {
                                new loginTimeout().doBeforeTimeout()
                            }
                            else {
                                if (location.pathname != "/" && location.pathname != "/liveCasino.aspx"
                                && location.pathname != "/egame.aspx" && location.pathname != "/lottery.aspx"
                                && location.pathname != "/sports.aspx" && location.pathname != "/tbapp.aspx"
                                    && location.pathname != "/Promotion/") {
                                    window.location.reload();
                                }
                            }
                            if ($.cookie("loginTimeoutData") != undefined) {
                                $.removeCookie("loginTimeoutData", { path: '/' });
                            }
                        }
                            //注册消息连接

                        $.removeCookie("tengbo.com.msgnum", { path: '/' });
                        var params = {
                            ACNT: data.row.ACNT,
                            SID: data.row.SID,
                            Token: data.row.Token,
                            IP: "&IP&"
                        };
                        getUnreadMsgLen();
                        conn = createConn(params);
                        conn.register();
                        //conn.init();
                        //conn.init_simple();

                        //显示VIP回拨
                        $(".tb-vipzxhb").hide();
                        var groupId = $.cookie('memberGroupID');
                        if (groupId && groupId > 3 && groupId < 7) {
                            $(".tb-vipzxhb").show();
                            wathchRightSize();
                        }

                    } catch (e) {
                        console.log("平台登录发生异常");
                    }
                        break;
                    case 8004:
                        $(login_error).html('密码错误超过5次,锁定24小时,通过<a href="/ResetPassword.aspx" style="color:#09f;">找回密码</a>或手机登录解锁！').removeClass('d_n').css({ 'display': 'inline' });
                        break;

                    case 21:
                        break;
                default:
                    if (data.args && !!data.args[0]) {
                        $.cookie("SID", data.args[0], { path: '/' });
                    }
                    $.cookie("tengbo.login.error", "true");
                    if ($("#login_CheckCode").size() < 1) {
                        if (!!isClogin) {
                            addCodeHtml();
                        } else {
                            loginConponent.ShowVerifyCode();
                        }
                    }
                    loginConponent.ShowError(data.Status,data);
                    break;
                }
            },
            complete: function () {
                if (!!btnObj) {
                    setTimeout(function () {
                        setTimeout(function () {
                            loadingObj.Hide();
                        }, 200);
                        $(btnObj).removeClass("btn-disabled");
                        $(btnObj).get(0).disabled = false;
                        $(btnObj).val("登  录");
                    }, 200);
                    //$(btnObj).removeClass("btn-disabled");
                    //$(btnObj).get(0).disabled = false;
                    //$(btnObj).val("登  录");
                    return true;
                }
            }
        }, btnObj);
    }
}

/**
 * 手机登录
 * @param  {Boolean} isClogin [description]
 * @return {[type]}           [description]
 */
function phoneLogin_click(isClogin, ev) {
    var loadingObj = loadingPage({
        type: "load1",
        imgRootPath: imgRootPath,
        divClass: $("body")
    });
    var e = window.event || arguments.callee.caller.arguments[0];
    if (e && (e.keyCode == 13 || e.type == 'click')) loadingObj.Show();
    clearLoginInput();
    var login_error = $('.pop-login-err');
    // if (e.keyCode == 13 || e.type == 'click') {
        if ($(".loading").size() > 0) {
            $(".loading").css({'zIndex':9999})
        }
        var btnObj = $('.login-anniu-div');
        //var oldText = $(btnObj).val();

        var $panel = $('.tb-login');
        var postData = $('.pop-login').getPostData();
        if (postData.phone == '') { loadingObj.Hide(); $('input[name="phone"]', $('.pop-login')).focus(); return $(login_error).text('请输入手机号').removeClass('d_n').css({'display':'inline'}); }
        if (!/^1[3456789][0-9]{9}$/.test(postData.phone)) { loadingObj.Hide(); $('input[name="phone"]', $('.pop-login')).focus(); return $(login_error).text('输入的手机号格式不正确！').removeClass('d_n').css({'display':'inline'}); }
        if (postData.phone_password == '') { loadingObj.Hide(); $('input[name="phone_password"]', $('.pop-login')).focus(); return $(login_error).text('请输入短信验证码').removeClass('d_n').css({'display':'inline'}); }
        //if (!/^(?=.*\d)(?=.*[a-zA-Z])[\da-zA-Z][^\\/#%'"".\??]{5,11}$/.test(postData.n2)) { $('input[name="n2"]', $('.pop-login')).focus(); return $(login_error).text('输入的密码格式不正确！').removeClass('d_n'); }
        //需要显示验证码
        // if (loginIsErr()) {
        //     if (postData.n3 == '') { loadingObj.Hide(); $('input[name="n3"]', $('.pop-login')).focus(); return $(login_error).text('请输入验证码').removeClass('d_n'); }
        //     if (!/^\d{4}$/.test($('input[name="n3"]', $('.pop-login')).val())) {
        //         loadingObj.Hide();
        //         $('input[name="n3"]', $('.pop-login')).focus();
        //         return $(login_error).text('验证码错误').removeClass('d_n');
        //     }
        // }
        postData.action = 'login';

        if ($(btnObj).val() == "登录中...") return;
        if (!!btnObj) {
            $(btnObj).addClass("btn-disabled");
            $(btnObj).get(0).disabled = true;
            $(btnObj).val("登录中...");
        }

        $.cookie("memberACNT", postData.n1, { path: '/' }); // 这里记录明文 用于post提交
        $.invoke_api({ LoginTelACNT: { Tel : postData.phone, TelCode: postData.phone_password } }, {
            //async: false,
            success: function (data) {
                // data = {
                //   "Status": 319,
                //   "Message": "PasswordError",
                //   "args": [
                //     "028d4949e2444ba485f75ca6d1f7a97d",
                //     4
                //   ]
                // };
                setTimeout(function () {
                    loadingObj.Hide();
                }, 800);
                //console.log("登录结果:", data);
                switch(data.Status) {
                    case 1:
                        try {
                        $.cookie("ptpwd", postData.n2, { path: '/' });

                        loginConponent.CookieLive(data.row.Token, data.row.ACNT, data.row.HideACNT, data.row.Balance, data.row.GroupID, data.row.SID);
                        setTimeout(function () {
                            egameLogin();
                        }, 100);

                        if (!$.removeCookie("tengbo.login.error", { path: '/' })) {
                            $.removeCookie("tengbo.login.error");
                        }

                        if (!!isClogin) {
                            // 出纳柜台登录
                            location.href = "/MemberCenter/Cdefault.aspx";
                        }
                        else {
                            setTimeout(function () {
                                loginConponent.Hide();
                                $('#login-lucencyDiv').show()
                                $('#login-lucencyDiv').hide();
                            }, 250);

                            //loginConponent.Hide();
                            //$('#login-lucencyDiv').show();
                            //setTimeout(function () {
                            //    $('#login-lucencyDiv').hide();
                            //}, 100);

                            loginConponent.ShowState(".login_member_top_state", "#login_member_state_operate");

                            //登录过期，处理
                            if ($.cookie("loginTimeoutData") != undefined) {
                                new loginTimeout().doBeforeTimeout()
                            }
                            else {
                                if (location.pathname != "/" && location.pathname != "/liveCasino.aspx"
                                && location.pathname != "/egame.aspx" && location.pathname != "/lottery.aspx"
                                && location.pathname != "/sports.aspx" && location.pathname != "/tbapp.aspx"
                                    && location.pathname != "/Promotion/") {
                                    window.location.reload();
                                }
                            }
                            if ($.cookie("loginTimeoutData") != undefined) {
                                $.removeCookie("loginTimeoutData", { path: '/' });
                            }
                        }
                            //注册消息连接

                        $.removeCookie("tengbo.com.msgnum", { path: '/' });
                        var params = {
                            ACNT: data.row.ACNT,
                            SID: data.row.SID,
                            Token: data.row.Token,
                            IP: "&IP&"
                        };
                        getUnreadMsgLen();
                        conn = createConn(params);
                        conn.register();
                        //conn.init();
                        //conn.init_simple();

                        //显示VIP回拨
                        $(".tb-vipzxhb").hide();
                        var groupId = $.cookie('memberGroupID');
                        if (groupId && groupId > 3 && groupId < 7) {
                            $(".tb-vipzxhb").show();
                            wathchRightSize();
                        }

                    } catch (e) {
                        console.log("平台登录发生异常");
                    }
                        break;
                    case 8004:
                        $(login_error).html('验证码错误超过5次,锁定24小时,通过<a href="/ResetPassword.aspx" style="color:#09f;">找回密码</a>解锁！').removeClass('d_n').css({'display':'inline'});
                        break;
                    case 319:
                        if(data['args'][1]>0){
                            $(login_error).html('验证码错误,还剩<span style="color:#06f;margin:0 3px;">'+data['args'][1]+'</span>次输入机会！').removeClass('d_n').css({'display':'inline'});
                        }else{
                            $(login_error).html('验证码错误超过5次,锁定24小时,通过<a href="/ResetPassword.aspx" style="color:#09f;">找回密码</a>解锁！').removeClass('d_n').css({'display':'inline'});
                        }

                        break;
                    case 301:
                        $(login_error).html('提交的手机号码不合法！').removeClass('d_n').css({'display':'inline'});
                        break;
                    case 317:
                        $(login_error).html('该手机号未认证！').removeClass('d_n').css({'display':'inline'});
                        break;
                    case 986:
                        $(login_error).html('该手机号已注册或绑定！').removeClass('d_n').css({ 'display': 'inline' });
                        break;
                    case 13:
                        $(login_error).html('请先用户名登录后，才能激活手机登录功能！').removeClass('d_n').css({ 'display': 'inline' });
                        break;
                    default:
                        $(login_error).html('登录发生错误，请稍后再试！').removeClass('d_n').css({ 'display': 'inline' });
                        if (data.args && !!data.args[0]) {
                            $.cookie("SID", data.args[0], { path: '/' });
                        }
                        $.cookie("tengbo.login.error", "true");
                        if ($("#login_CheckCode").size() < 1) {
                            if (!!isClogin) {
                                addCodeHtml();
                            } else {
                                loginConponent.ShowVerifyCode();
                            }
                        }
                        //loginConponent.ShowError(data.Status,data);
                        break;
                }
            },
            complete: function () {
                if (!!btnObj) {
                    setTimeout(function () {
                        setTimeout(function () {
                            loadingObj.Hide();
                        }, 800);
                        $(btnObj).removeClass("btn-disabled");
                        $(btnObj).get(0).disabled = false;
                        $(btnObj).val("登  录");
                    }, 500);
                    //$(btnObj).removeClass("btn-disabled");
                    //$(btnObj).get(0).disabled = false;
                    //$(btnObj).val("登  录");
                    return true;
                }
            }
        }, btnObj);
    // }
}

function btnLogout_click(isClogin) {
    $.invoke_api({ Logout: {} }, {
        async:false,
        success: function (data) {}
    });

    loginConponent.CookieDie();

    loginConponent.ShowState(".login_member_top_state", "#login_member_state_operate");
    if (!!isClogin) {
        var pt_type = $.cookie('pt_type');
        if (!pt_type || pt_type == 'pt') {
            location.href = "/clogin.aspx";
        } else if (pt_type == 'ptin') {
            location.href = "/PTINLogin.aspx";
        } else if (pt_type == 'pta') {
            location.href = "/PTALogin.aspx";
        }

        return;
    }

    if (location.pathname.indexOf("MemberCenter") != -1) {
        location.href = "/";
    }
    window.location.reload();
}

function btnCLogout_click(login_url, home_url) {
    $('body').load2(login_url, {}, { action: 'logout' }, function () {
        window.location = home_url;
    });
}

// 针对平台打开
function openPlatformGame(gameId, type, isTrial) {
    if (!gameId) return;
    //不支持手机
    if (navigator.userAgent.indexOf('Mobile') > -1 || navigator.userAgent.indexOf('Android') > -1) {
        var $dom = $(".user_center").size() > 0 ? $(".user_center") : $("body");
        if (gameId == 11) { //AG旗舰不支持移动设备
            $dom.Dialog({
                type: "Ask",
                title: "温馨提示",
                messageTitle: "该厅目前不支持移动设备！",
                buttons: [{
                    name: "确定",
                    callback: function () { closeDialog(0); }
                }],
                closeHandler: function () { closeDialog(0); }
            });
            return false;
        }
    }
    return openGameWindow({
        isTrial: isTrial,
        gameType: gameId,
        gameCode: type,
        plat: true
    });
    if (!gameState(gameId)) return true;
    var hosturl = encodeURIComponent(window.location.origin);
    //isTrial = !$.cookie("memberToken") || !!isTrial; // 未登录时直接进入试玩
    isTrial = !!isTrial;
    if (gameId === 11) {

    }
    var handle = openGame2(isTrial);
    switch (gameId) {
        case 11: // AG旗舰厅
            $.invoke_api({ GetAGEntry: { IsTrial: isTrial, ClientDomain: hosturl } }, {
                invokeApi: true,
                url: resolveClientUrl + '.gameapi',
                success: function (data, textStatus, jqXHR) {
                    switch (data.Status) {
                        case 16:
                            handle.close();
                            loginConponent.Show();
                            break;
                        case 1:
                            lessThanTen(data,gameId,isTrial,function(handle){
                                var url = data.row.EntryData || data.row;
                                handle.location.href = url;
                            });
                            break;
                        case -10:// 游戏维护
                            handle.close();
                            $('.user_center').parent().Dialog({
                                type: "Ask",
                                title: "温馨提示",
                                messageTitle: getMsg(data.Status),
                                buttons: [{
                                    name: "确定",
                                    callback: function () { closeDialog(0); }
                                }],
                                closeHandler: function () { closeDialog(0); }
                            });
                            break;
                        default:
                            handle.close();
                            break;
                    }
                }
            });
            break;
        case 12:// AG国际厅
            $.invoke_api({ GetAGINEntry: { IsTrial: isTrial, ClientDomain: hosturl } }, {
                invokeApi: true,
                url: resolveClientUrl + '.gameapi',
                success: function (data, textStatus, jqXHR) {
                    switch (data.Status) {
                        case 16:
                            handle.close();
                            loginConponent.Show(); break;
                        case 1:
                            lessThanTen(data,gameId,isTrial,function(handle){
                                var url = data.row.EntryData || data.row;
                                handle.location.href = url;
                            });
                            //openGame(true, data.row);
                            break;
                        default:
                            handle.close();
                            break;
                    }
                }
            });
            break;
        case 9:// bbin波音
            $.invoke_api({ GetBBINEntry: { page_site: type } }, { //page_site :0 体育 ,3 真人 ,4 电游, 6 捕鱼, 2 彩票
                invokeApi: true,
                url: resolveClientUrl + '.gameapi',
                success: function (data, textStatus, jqXHR) {
                    //console.log(data);
                    switch (data.Status) {
                        case 16:
                            handle.close();
                            loginConponent.Show();
                            break;
                        case 1:

                            lessThanTen(data,gameId,isTrial,function(handle){
                                var url = data.row.EntryData || data.row;
                                handle.document.write(url);
                                handle.document.forms[0].submit();
                            });
                            break;
                        case -10:// 游戏维护
                            handle.close();
                            $('body').Dialog({
                                type: "Ask",
                                title: "温馨提示",
                                messageTitle: getMsg(data.Status),
                                buttons: [{
                                    name: "确定",
                                    callback: function () { closeDialog(0); }
                                }],
                                closeHandler: function () { closeDialog(0); }
                            });
                            break;
                        case 321:
                            $('body').Dialog({
                                type: "Ask",
                                title: "温馨提示",
                                messageTitle: "未完善个人资料",
                                message: '您的个人资料不全，请完善个人资料！',
                                buttons: [{
                                    name: "确定",
                                    callback: function () { closeDialog(0); gotoZzyh(44);}
                                }],
                                closeHandler: function () { closeDialog(0); gotoZzyh(44);}
                            });
                            break;
                        default:
                            handle.close();
                            break;
                    }
                }
            });
            break;
        case 17://MG国际真人
            var gameCode = 'mgLiveGame';
            $.invoke_api({ GetMGINEntry: { GameCode: gameCode, IsHtml5: false } }, {
                invokeApi: true,
                url: resolveClientUrl + '.gameapi',
                success: function (data, textStatus, jqXHR) {
                    if (data.Status === 1) {
                        lessThanTen(data,gameId,isTrial,function(handle){
                            var url = data.row.EntryData || data.row;
                            url = url.replace('[lobbyURL]', hosturl);
                            url = url.replace('[bankingURL]', hosturl);
                            handle.location.href = url;
                        });
                    } else if (data.Status === 16) {
                        handle.close();
                        loginConponent.Show();
                    } else {
                        handle.close();

                    }
                }
            })
            break;
        case 25://平博体育
            $.invoke_api({ GetPBEntry: {} }, {
                invokeApi: true,
                url: resolveClientUrl + '.gameapi',
                success: function (data, textStatus, jqXHR) {
                    switch (data.Status) {
                        case 16:
                            handle.close();
                            loginConponent.Show();
                            break;
                        case 1:
                            lessThanTen(data,gameId,isTrial,function(handle){
                                var url = data.row.EntryData || data.row;
                                handle.location.href = url;
                            });
                            break;
                        default:
                            handle.close();
                            break;
                    }
                }
            });
            break;
        case 29: // VR 彩票
            $.invoke_api({ GetVREntry: {} }, {
                invokeApi: true,
                url: resolveClientUrl + '.gameapi',
                success: function (data, textStatus, jqXHR) {
                    switch (data.Status) {
                        case 16:
                            handle.close();
                            loginConponent.Show();
                            break;
                        case 1:
                            lessThanTen(data,gameId,isTrial,function(handle){
                                var url = data.row.EntryData || data.row;
                                handle.location.href = url;
                            });
                            break;
                        default:
                            handle.close();
                            break;
                    }
                }
            });
            break;

        case 33: //IMG电竞牛
            $.invoke_api({ GetIMEntry: { GameCode: type } }, {
                invokeApi: true,
                url: resolveClientUrl + '.gameapi',
                success: function (data, textStatus, jqXHR) {
                    switch (data.Status) {
                        case 16:
                            handle.close();
                            loginConponent.Show();
                            break;
                        case 1:
                            lessThanTen(data, gameId, isTrial, function (handle) {
                                var url = data.row.EntryData || data.row;
                                handle.location.href = url;
                            });
                            break;
                        default:
                            handle.close();
                            break;
                    }
                }
            });
            break;
    }

    /**
     * 游戏余额少于10元弹出框
     * @param  {[type]}   data    [游戏api返回内容]
     * @param  {[type]}   Gtype   [游戏id]
     * @param  {Boolean}  isTrial [是否试玩]
     * @param  {Function} fn      [回调函数]
     * @return {[type]}           [description]
     */
    function lessThanTen(data,Gtype,isTrial,fn){
        if(data.row.isBalanceTips){
            handle.close();
            var params = {
                balance: data.row.gameBalance,
                gameId: Gtype,
                isTrial: isTrial
            };
            var balanceTip = beforeGameIn(params,fn);
            balanceTip.Show();
        }else{
            // handle = openGame1(0, 0, 0, 0, isTrial);
            fn && fn(handle);
        }
    }
}

// 针对单个游戏打开
function openGame(/*true:表示tag方式打开，false：表示弹出一个窗口*/isTag, url, w, h, t) {
    w = w || 800;
    h = h || 600;
    t = t || "_blank";
    if (!!$.cookie("memberToken")) {
        if (isTag) {
            window.open(url);
        }
        else {
            window.open(url, t, "toolbar=yes, location=yes, directories=no, status=no, menubar=yes, scrollbars=yes, resizable=no, copyhistory=yes, width=" + w + ", height=" + h);
        }
    }
    else {
        loginConponent.Show({ loginType: 1 });
    }
}

// 优先弹窗来装载游戏
function openGame1(/*加载时呈现的内容*/content, w, h, t, isTrial) {
    w = w || 800;
    h = h || 600;
    t = t || "_blank";
    content = content || "数据加载中，请稍后...";

    //弹窗居中
    var w_width = window.screen.width;
    var w_height = window.screen.height;
    var obj_top = (w_height - h) / 2;
    var obj_left = (w_width - w) / 2;
    if (!!$.cookie("memberToken") || !!isTrial) {
        //var handle = window.open("text/html", t, "toolbar=yes, location=yes, directories=no, status=no, menubar=yes, scrollbars=yes, resizable=no, copyhistory=yes, width=" + w + ", height=" + h);
        //?n1=" + $.cookie("ptlogin") + "&n2=" + $.cookie("ptpwd")
        var url = "/gameloading.html"; //"http://" + location.host + "/gameloading.html";
        //var handle = window.open(url, t, "toolbar=yes, location=yes, directories=no, status=no, menubar=yes, scrollbars=yes, resizable=no, copyhistory=yes, top=" + obj_top + ", left=" + obj_left + ", width=" + w + ", height=" + h);
        var handle = window.open(url, t, "top=" + obj_top + ", left=" +obj_left + ", width=" +w + ", height=" +h);

        return handle;
    } else {
        loginConponent.Show({ loginType: 1 });
    }

}

// 以tag方式打开
function openGame2(isTrial) {
    isTrial = isTrial || false;
    if (isTrial) {
        var handle = window.open("./gameloading.html");

        return handle;
    }
    else {
        if (!!$.cookie("memberToken")) {
            var handle = window.open();

            return handle;
        } else {
            loginConponent.Show({ loginType: 1 });
        }
    }

}

function openGameByForm(/*true:表示tag方式打开，false：表示弹出一个窗口*/isTag, /*这里只能是表单提交页面内容，表单中target设置为_self*/formHtml, w, h, t) {
    w = w || 800;
    h = h || 600;
    t = t || "_blank";
    if (!!$.cookie("memberToken")) {
        var w;
        if (isTag) {
            //w = window.open("text/html");
            w = window.open("./gameloading.html");
        }
        else {
            //w = window.open("text/html", t, "toolbar=yes, location=yes, directories=no, status=no, menubar=yes, scrollbars=yes, resizable=no, copyhistory=yes, width=" + w + ", height=" + h);
            w = window.open("./gameloading.html", t, "toolbar=yes, location=yes, directories=no, status=no, menubar=yes, scrollbars=yes, resizable=no, copyhistory=yes, width=" + w + ", height=" + h);
        }

        var s = w.document.open();
        s.write(formHtml)
        w.document.close();

        w.document.forms[0].submit();
    }
    else {
        loginConponent.Show({ loginType: 1 });
    }
}

// bbin游戏下载
function downGameBBin() {
    var handle = openGame2();
    $.invoke_api({ GetBBINAPP: {} }, {
        success: function (data, textStatus, jqXHR) {
            console.log(data);
            switch (data.Status) {
                case 16: loginConponent.Show(); break;
                case 1:
                    handle.location.href = data.row;
                    break;
                default: break;
            }
        }
    });
}

///////////////////////////////////////////////////



var login_error = new function () {
    var handle = null;
    function clearHandle() {
        if (handle != null)
            window.clearTimeout(handle);
        handle = null;
    }
    function setHandle() {
        handle = window.setTimeout(hide, 3000);
    }
    function show(msg) {
        clearHandle();
        $('.login_err').hide().text(msg).show('drop', { direction: 'right' }, 200, setHandle);
    }
    function hide() {
        clearHandle();
        $('.login_err').hide('drop', { direction: 'right' }, 500);
    }

    return { show: show, hide: hide }
}

function pt_trygame() { is_login() ? $('.pt_trygame').hide() : $('.pt_trygame').show(); $('.right_Pt').css({ height: $('.left_Pt').height() - 15 }); }

$.fn.playgame = function (trial) {
    if (!gameState($(this).attr('rel'))) return true;
    $('input[name="trial"]', this).val(trial);
    if (this.length == 1) { this[0].submit(); }
}

$.fn.loadegame = function (openUrl, iWidth, iHeight)
{
    if (is_login())
        window.open(openUrl + '?gamecode=' + $(this).attr('gamecode'), '', 'width=' + iWidth + ', height=' + iHeight + ', top=' + (window.screen.availHeight - 30 - iHeight) / 2 + ', left=' + (window.screen.availWidth - 10 - iWidth) / 2 + ',menubar=no,scrollbars=no,toolbar=no,location=no,directories=no,resizable=no');
    else
        loginConponent.Show({ loginType: 1 });
}

//$.fn.DialogAlert = function (title, content, id, icon, time, hasCancel) { if (hasCancel) art.dialog({ title: title, content: content, id: id, icon: icon, time: time, ok: function () { return true; }, cancel: function () { return true; } }); else art.dialog({ title: title, content: content, id: id, icon: icon, time: time, ok: function () { return true; } }); }

$.fn.float_close = function () { event.cancelBubble = true; $(this).closest('.TplFloatSet').hide(); }

$.fn.float_ad = function (op) {
    var $this = this;

    function centerY() { $this.each(function () { $(this).animate({ top: $(document).scrollTop() + ($(window).innerHeight() - $(this).outerHeight()) / 2 }, op); }); };
    centerY();

    $(document).scroll(function () { centerY(); }).resize(function () { centerY(); });
}

function getQueryString(n) { var i = new RegExp("(^|&)" + n + "=([^&]*)(&|$)", "i"), t = window.location.search.substr(1).match(i); return t != null ? unescape(t[2]) : null }

function stripscript(n) { var t = ""; for (var r = new RegExp("[/\\\\#%\"'.?]"), i = 0; i < n.length; i++) { t = t + n.substr(i, 1).replace(r, ''); } return t; }

function specialValue(v) { v = v.replace(/[\W|_]/gi, ''); return v; }

function verifValue(v) { v = v.replace(/[\W|_]/gi, ''); return v; }

function floatAmountText(n) { var t = ""; for (var r = new RegExp(/[^\d.]/g), i = 0; i < n.length; i++) { t = t + n.substr(i, 1).replace(r, "") } if (t.length >= 4 || t.length < 2) { if (!/^\d+(?:\.)?$/.test(t) || t.length > 11) { if (!/^\d+(?:\.\d{1,2})?$/.test(t)) { t = t.substring(0, t.length - 1) } } } return t };

$.fn.floatAmount = function () { $(this).keypress(function (e) { var keyCode = e.keyCode || e.which; if (!(keyCode >= 48 && keyCode <= 57 || keyCode == 46)) { return false } }).blur(function () { if (!(/^\d|^-+$/.test($(this).val()))) { $(this).val("") } }) };

$.fn.setHide = function (s) { var p, q; if (s.length <= 1) return; if (s.length == 2) { p = 1; q = '*' } else if (s.length > 2 && s.length <= 4) { p = 2; q = '**' } else if (s.length > 4) { p = 4; q = '****' } return s.substring(0, s.length - p) + q; }

$.fn.chk_select = function () {
    var pass = false;
    var e = window.event || arguments.callee.caller.arguments[0];

    $(this).bind('DOMNodeInserted', function (e) {
        if ($(this).val() == null || $(this).val() == '')
            $(this).setstate('s2');
        else if ($(this).val().indexOf('选择') >= 0)
            $(this).setstate('s2');
        else {
            $(this).setstate('s3');
            pass = true;
        }
    });

    //if (e.type == 'click') {
    //    $(this).trigger('change');
    //    return pass;
    //}
}
$.fn.chk_input = function (t, firefoxEvent) {
    var pass = false;
    var e = window.event || arguments.callee.caller.arguments[0] || firefoxEvent;


    registerPost = false;
    $(this).unbind("blur");

    $(this).bind("blur", function () {
        var v = $(this).val().trim();
        switch (t) {
            case 'acnt':
                var _postData = { id: '' };
                var chkid = true;
                var $this = $(this);
                _postData.id = v;
                if (!(/^[^0|^\W][a-zA-Z0-9]{4,9}$/.test(_postData.id))) {
                    if (_postData.id == 0 && !registerPost)
                        $this.setstate('s1');
                    else
                        $this.setstate('s2', '必须是5-10个字符，可使用字母、数字，首位不能为0');
                    chkid = false;
                }
                var acntMsgS2 = $('#reg-acnt-s2').css('display') == 'none';
                var acntMsgS3 = $('#reg-acnt-s3').css('display') == 'none';
                if (registerPost && chkid && (acntMsgS2 || acntMsgS3)) {
                    return pass = true;
                }

                if (!registerPost && chkid) {
                    $this.setstate('s4');
                    $.cookie("memberACNT", _postData.id, { path: '/'});
                    $.invoke_api({ MemberExist: {} }, {
                        async:false,
                        success: function (data, textStatus, jqXHR) {
                            switch (data.Status) {
                                case 1:
                                    setTimeout(function () {
                                        $this.setstate('s3');
                                    }, 500);
                                    pass = true;
                                    break;
                                default: $this.setstate('s2', getMsg(data.Status)); break;
                            }
                        },
                        error: function (xhr, ajaxOptions, thrownError) {
                            $this.setstate('s2', "HTTP {0} : {1}".format(xhr.status, xhr.statusText));
                        },
                        complete: function (jqXHR, textStatus) { }
                    });
                } break;
            case 'mail':
                if (v.length == 0 && !registerPost)
                    $(this).setstate('s1');
                else if (!/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(v))
                    $(this).setstate('s2');
                else {
                    $(this).setstate('s3');
                    pass = true;
                } break;
            case 'pwd':
                var reg = /^(?=.*\d)(?=.*[a-zA-Z])[\da-zA-Z][^\\/#%'"".\??]{5,11}$/;
                if (v.length == 0 && !registerPost)
                    $(this).setstate('s1');
                else if (!reg.test(v))
                    $(this).setstate('s2');
                else {
                    $(this).setstate('s3');
                    pass = true;
                } break;
            case 'bankAccount':
                if (v.length == 0 && !registerPost)
                    $(this).setstate('s1');
                else if (!/^\d{16,19}$/g.test(v))
                    $(this).setstate('s2');
                else {
                    $(this).setstate('s3');
                    pass = true;
                } break;
            case 'simpleBankAccount':
                if (v.length == 0 && !registerPost)
                    $(this).setstate('s1');
                else if (!/^\d{6,6}$/g.test(v))
                    $(this).setstate('s2');
                else {
                    $(this).setstate('s3');
                    pass = true;
                } break;
            case 'pay_code':
                if (v.length == 0 && !registerPost)
                    $(this).setstate('s1');
                else if (!/^\d{18}$/g.test(v))
                    $(this).setstate('s2');
                else {
                    $(this).setstate('s3');
                    pass = true;
                } break;
            case 'secNotarize':
                if (v.length == 0 && !registerPost)
                    $(this).setstate('s1');
                else if ($(this).parent().parent().prev().find('input').val() != v)
                    $(this).setstate('s2');
                else if (v.length != 0) {
                    $(this).setstate('s3');
                    pass = true;
                } break;
            case 'drawMoney':
                if (v.length == 0 && !registerPost)
                    $(this).setstate('s1');
                else if (isNaN($(this).val_trim()) || $(this).val_trim() < 100 || !/^\d+(?:\.\d{1,2})?$/.test($(this).val_trim()))
                    $(this).setstate('s2');
                else {
                    $(this).setstate('s3');
                    pass = true;
                } break;
            case 'deposit':
                if (v.length == 0 && !registerPost)
                    $(this).setstate('s1');
                else if (isNaN($(this).val_trim()) || $(this).val_trim() <= 0 || !/^\d+(?:\.\d{1,2})?$/.test($(this).val_trim()))
                    $(this).setstate('s2');
                else {
                    $(this).setstate('s3');
                    pass = true;
                } break;
            case 'tradeNo': //第三方订单号28-32位数字,验证订单号有效性***
                if (v.length == 0 && !registerPost)
                    $(this).setstate('s1');
                else if (!/^\d{28,32}$/.test($(this).val_trim()))
                    $(this).setstate('s2');
                else {
                    //验证支付宝订单号开始6位有效性 (只支持2天内的订单)
                    var orderDate = v.substr(0, 8).replace(/^(\d{4})(\d{2})(\d{2})$/, '$1-$2-$3');
                    //判断日期格式
                    var arrDate = orderDate.split('-');
                    orderDate = new Date(arrDate[0], arrDate[1] - 1, arrDate[2], ' ', ' ', ' ');
                    var day = (orderDate - new Date()) / (1000 * 60 * 60 * 24);

                    if (orderDate == 'Invalid Date' || day < -2 || day > 0)
                        $(this).setstate('s2');
                    else {
                        $(this).setstate('s3');
                        pass = true;
                    }
                } break;
            case 'null':
                var minlength;
                if (!!$(this).attr('data-minlength')) minlength = $(this).attr('data-minlength'); else minlength = 0;
                if (v.length == 0 && !registerPost)
                    $(this).setstate('s1');
                else if (v.length == 0 || v.length < minlength)
                    $(this).setstate('s2');
                else {
                    $(this).setstate('s3');
                    pass = true;
                } break;
            case 'safeQuestion':
                if (v.length == 0 && !registerPost)// && !registerPost
                    $(this).setstate('s1');
                else if (v.length < 2 || v.length > 16)
                    $(this).setstate('s2');
                else {
                    $(this).setstate('s3');
                    pass = true;
                } break;
            case 'vcode':
                if (v.length == 0 && !registerPost)
                    $(this).setstate('s1');
                else if (v.length < 4)
                    $(this).setstate('s2');
                else {
                    $(this).setstate('s3');
                    pass = true;
                } break;
            case 'name'://姓名 中文
                if (v.length == 0 && !registerPost)
                    $(this).setstate('s1');
                //else if (!/^[\u4e00-\u9fa5]{2,10}$/.test(v))
                else if (!/^[\u4e00-\u9fa5]{2,4}$/.test(v))
                    $(this).setstate('s2');
                else {
                    $(this).setstate('s3');
                    pass = true;
                } break;
            case 'name_ex'://姓名 中文
                if (v.length == 0 && !registerPost)
                    $(this).setstate('s1');
                else if (!/^[\u4e00-\u9fa5]{2,5}$/.test(v))
                    $(this).setstate('s2');
                else {
                    $(this).setstate('s3');
                    pass = true;
                } break;
            case 'tel':
                if (v.length == 0 && !registerPost)
                    $(this).setstate('s1');
                //else if (!/((1[3|4|5|7|8|9][0-9]\d{8})|^((\d{7,8})|(\d{4}|\d{3})-(\d{7,8})|(\d{4}|\d{3})-(\d{7,8})-(\d{4}|\d{3}|\d{2}|\d{1})|(\d{7,8})-(\d{4}|\d{3}|\d{2}|\d{1}))$)/.test(v))
                else if (!/^1[3456789][0-9]{9}$/.test(v))
                    $(this).setstate('s2');
                else {
                    $(this).setstate('s3');
                    pass = true;
                } break;
            case 'qq':
                if (v.length == 0 && !registerPost)
                    $(this).setstate('s1');
                else if (!/^[1-9][0-9]{4,11}$/.test(v))
                    $(this).setstate('s2');
                else {
                    $(this).setstate('s3');
                    pass = true;
                } break;

            case 'w': //多位字母或数字
                if (v.length == 0 && !registerPost)
                    $(this).setstate('s1');
                else if (!/^\w+$/.test(v))
                    $(this).setstate('s2');
                else {
                    $(this).setstate('s3');
                    pass = true;
                } break;
            case 'fourNum': //4位数字
                if (v.length == 0 && !registerPost)
                    $(this).setstate('s1');
                else if (!/^\d{4}$/.test(v))
                    $(this).setstate('s2');
                else {
                    $(this).setstate('s3');
                    pass = true;
                } break;
            case 'integer': //正整数
                if (v.length == 0 && !registerPost)
                    $(this).setstate('s1');
                else if (!/^[1-9][0-9]{0,}$/.test(v))
                    $(this).setstate('s2');
                else {
                    $(this).setstate('s3');
                    pass = true;
                } break;
            case 'username': //用户名验证
                if (v.length == 0 && !registerPost)
                    $(this).setstate('s1');
                else if (!/^[A-Za-z0-9]+$/gi.test(v.trim()))
                    $(this).setstate('s2');
                else {
                    $(this).setstate('s3');
                    pass = true;
                } break;
            case 'is888': //幸运注单订单号验证 50-1539735689-989592888-3
                var type = $(this).attr('data-type');
                v = v.replace(/\s+/g,'');
                if (v.length == 0 && !registerPost)
                    $(this).setstate('s1');
                else if (!/^[\w-_#.]+$/.test(v) || v.indexOf('888') <0 )
                    $(this).setstate('s2');
                else {
                    if (type == '28' || type == '39') {
                        $(this).setstate('s3');
                        pass = true;
                    } else {
                        //var arr = v.split('-');
                        //v = arr[2];
                        if ( v.slice(-3) == '888') {
                            $(this).setstate('s3');
                            pass = true;
                        } else {
                            $(this).setstate('s2');
                        }
                    }
                } break;
            case 'luckyCash':   //幸运注单订单号验证
                if (v.length == 0 && !registerPost)
                    $(this).setstate('s1');
                else if (isNaN($(this).val_trim()) || $(this).val_trim() < 1 || !/^\d+(?:\.\d{1,2})?$/.test($(this).val_trim()))
                    $(this).setstate('s2');
                else {
                    $(this).setstate('s3');
                    pass = true;
                } break;
            case 'idCard':   //身份证号验证
                if (v.length == 0 && !registerPost)
                    $(this).setstate('s1');
                else if (isNaN($(this).val_trim()) || $(this).val_trim() < 1 || !/(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/.test($(this).val_trim()))
                    $(this).setstate('s2');
                else {
                    $(this).setstate('s3');
                    pass = true;
                } break;
                //

        }
    }).focus(function () {
        registerPost = false;
        //$(this).triggerHandler('blur');
        $(this).setstate("s1");
    });

    if (e != undefined) {
        if (e.type == 'click' || e.type == 'button') {
            registerPost = true;
            $(this).trigger('blur');
            return pass;
        }
    }
}

$.fn.setstate = function(state, msg) {
    var $n1 = $(this).closest('dl').find('.msgbox');
    var $n2 = $('.msg.' + state, $n1);
    if ($n2.length == 0) return;
    $('.msg', $n1).hide();
    if (msg) $n2.text(msg);
    $n2.show();
}
$.fn.onlyNum = function () {
    $(this).keypress(function (e) {
        var keyCode = e.keyCode || e.which;
        if (keyCode == 8) {
            return;
        }
        if (!(keyCode >= 48 && keyCode <= 57))
            return false;
    }).blur(function () {
        if (!(/^\d|^-+$/.test($(this).val())))
            $(this).val('');
    });
};

$.fn.chk_name = function () {
    $(this).blur(function (e) {
        //if (!(/^[\u4e00-\u9fa5]{2,10}$/.test($(this).val())))
        if (!(/^[\u4e00-\u9fa5]{2,4}$/.test($(this).val()))) {
            //$(this).val('');
        }
        else
            $(this).setstate('s3');
    });
};

//独立的扩展验证
$.fn.chk_input_ex = function (data, firefoxEvent) {
    if (!data || !data.type) return;
    var e = window.event || arguments.callee.caller.arguments[0] || firefoxEvent;
    var pass = true;
    $(this).bind("blur", function () {
        var v = $(this).val();
        switch (data.type) {
            case 'deposit':
                v = typeof $(this).val_trim() === "string" ? parseFloat($(this).val_trim()) : $(this).val_trim();
                var maxNum = data.maxNum ? data.maxNum : 999999999;
                if (/^\d+(\.\d{1,2})?$/.test(v) && v > maxNum) {
                    $(this).closest('dd').find("span").hide();
                    $(this).closest('dd').find('.input_length_err').show().text('输入的金额最多不能超过' + maxNum + '！');
                    pass = false;
                }
                if (!/^\d+(\.\d{1,2})?$/.test(v)) {
                    pass = false;
                }
                break;

            case 'transfer':
                var v = $(this).val_trim();
                if (!/^[1-9][0-9]{0,}$/.test(v)) {
                    pass = false;
                }
        }
    }).focus(function () {
        if (data.type === "deposit") {
            $(this).closest('dd').find("span").hide();
            var minimuma = $("#depositTitle li.on").attr("minimum");
            var maximum = $("#depositTitle li.on").attr("maximum");
            if (minimuma == 0 && maximum == 0) {
                return;
            }
            if (minimuma && maximum)
                $("#amountLimit").show().html('存款金额最小<span style="color:#09f"> ' + minimuma + ' </span>元，最大<span style="color:#09f"> ' + maximum + ' </span>元！');
        } else if (data.type === 'transfer') {
            var v = $(this).val_trim();
            if (v == '' || /^[1-9][0-9]{0,}$/.test(v)) {
                $(this).parents('dl').find(".input_length_err").hide();
            }
        }

    });

    if (data.isWatch) {
        $(this).bind('keyup', function () {
            switch (data.type) {
                case 'deposit':
                    var v = $(this).val_trim();
                    if (!/^\d+$/.test(v)) {
                        v = typeof $(this).val_trim() === "string" ? parseFloat($(this).val_trim()) : $(this).val_trim();
                        $(this).closest('dd').find("span").hide();
                        $(this).closest('dd').find('.input_length_err').show().text('请输入正确的存款金额,金额只能为整数');
                        pass = false;
                    } else {
                        $(this).closest('dd').find('.input_length_err').hide();
                        pass = true;
                    } break;
                case 'deposit_decimal':
                    var v = $(this).val_trim();
                    if (!/^\d+(\.\d{1,2})?$/.test(v)) {
                        v = typeof $(this).val_trim() === "string" ? parseFloat($(this).val_trim()) : $(this).val_trim();
                        $(this).closest('dd').find("span").hide();
                        $(this).closest('dd').find('.input_length_err').show().text('请输入正确的金额，最多2位小数');
                        pass = false;
                    } else {
                        $(this).closest('dd').find('.input_length_err').hide();
                        pass = true;
                    } break;

                case 'transfer':
                    var v = $(this).val_trim();
                    var errInput = $(this).parents('dl').find(".input_length_err");
                    if (!/^[1-9][0-9]{0,}$/.test(v)) {
                        v = typeof $(this).val_trim() === "string" ? parseFloat($(this).val_trim()) : $(this).val_trim();
                        errInput.show();
                        pass = false;
                    } else {
                        errInput.hide();
                        pass = true;
                    }
                    break;
            }
        })
    }
    if (e != undefined) {
        if (e.type == 'click' || e.type == 'button' || e.type === 'submit') {
            $(this).trigger('blur');
            return pass;
        }
    }
}

//下拉菜单
$.fn.divselect = function (inputselectid) {

    var inputselect = $(inputselectid);
    var $this = $(this);
    $this.mouseleave(function () {
        $this.removeClass('open');
    })
    $this.children('.dropDown').click(function (e) {
        $('.select').removeClass('open');

        $this.toggleClass('open');
        e.stopPropagation();
    });
    $this.delegate('ul li', 'click', function (e) {
        var _this = $(this);
        $this.children('.dropDown').children('div').text(_this.text());
        $this.children('.dropDown').children('div').attr('data-value', _this.attr('data-value'));
        inputselect.val(_this.attr('data-value'));
        _this.addClass('Selected').siblings().removeClass('Selected');
        $this.removeClass('open');
        e.stopPropagation();
        $(this).find('ul li').undelegate('click');
    });
}

// 保留两位小数
function currencyFormatted(amount) {
    var i = parseFloat(amount);
    if (isNaN(i)) { i = 0.00; }
    var minus = '';
    if (i < 0) { minus = '-'; }
    i = Math.abs(i);
    i = parseInt((i + .005) * 100);
    i = i / 100;
    s = new String(i);
    if (s.indexOf('.') < 0) { s += '.00'; }
    if (s.indexOf('.') == (s.length - 2)) { s += '0'; }
    s = minus + s;
    return s;
}


var getMsg = function (msgs) {
	return function (n) {
		return msgs[n] || '未知系统错误';
	}
}({
        '1': '提交成功',
        '4': '账号含有不合法字符',
        '-6': '未登录',
        '7': '验证码错误',
        '8': '账号不存在',
        '9': '由于网络波动，请稍后再试',
        '10': '账号已过期(停用)',
        '11': '账号不存在',
        '12': '密码不正确',
        '13': '密码过期',
        '15': '安全问题答案验证失败',
        '16': '登录超时，请重新登录',
        '18': 'IP地址验证失败',
        '204': '必须与登录密码保持一致',
        '205': '请输入旧密码',
        '206': '请输入新密码',
        '207': '两次输入必须相同',
        '208': '原始密码不正确',
        '209': '安全密码不正确',
        '211': '您的登录密码已经修改成功！请在下次登录时使用新密码！',
        '212': '您的安全密码已经修改成功！',
        '213': '安全密码未设定',
        '210': '密码不合法',
        '301': '手机号码不合法',
        '302': 'QQ不合法',
        '303': '真实姓名不合法',
        '305': '账号和邮箱不匹配',
        '306': '找回登录密码记录不存在',
        '307': '邮件发送失败',
        '308': '每天邮箱找回密码限3次',
        '309': '安全邮箱验证链接错误',
        '310': '安全邮箱验证链接已失效',
        '311': '邮件地址不合法',
        '312': '银行卡号不合法',
        '314': '抱歉，您未绑定银行卡',
        '316': '3分钟内不允许重复申请验证码!',
        '317': '请填写已验证的手机号码！',
        '319': '手机验证码错误！',
        '315': '对不起，您还不是VIP!',
        '401': '基本信息已经更新!',
        '402': '银行资料已经更新!',
        '501': '请稍等，您上次的提款还未处理！',
        '502': '提交失败，单次提款不能少于100元！',
        '503': '您的提款要求已送出，我们会尽快为您处理',
        '504': '您的主账户余额不足',
        '506': '您当前存在提款限额，无法申请提款',
        '601': '内容不合法',
        '602': '提交内容不能为空',
        '607': '类型错误',
        '608': '提交金额为空',
        '611': '问题答案错误',
        '617': '该银行已绑定过银行卡！',
        '707': '未达到当前支付方式的最低存款金额{0}元',
        '708': '已超出当前支付方式的最大存款金额',
        '709': '已超出当前支付方式每天存款次数限制！',
        '710': '此订单已完成，请检查您的存款记录！',
        '711': '交易信息无效，请检查！',
        '712': '您的账号无法查找到符合条件的订单！',
        '713': '交易信息已过期(只支持2天内的订单)！',
        '714': '订单号验证失败！',
        '716': '抱歉，入帐失败，请稍后重试，如问题继续请联系在线客服！',
        '728': '抱歉，此银行账户不支持自助入账！',

        '-1': '未知系统错误',
        '-3': '信息不能为空',
        '-5': '验证失败，请重新载入',
        '-9': '由于网络波动，请稍后再试。',
        '-10': '游戏平台维护中',
        '-11': '余额获取失败，请手动刷新',
        '-14': '上次查询正在处理中，请过5秒后重试！',

        //自助入账
        '718': '您的订单信息已锁定，请稍后在试',
        '719': '由于网络延时，您提交的订单请在倒计时后再次尝试',
        '720': '您自助入账操作太频繁，请倒计时后进行自助入账',
        '724': '当前通道已关闭，请使用其它存款通道',
        '730': '当前账户已停止自助入账',
        '8005': '对不起，自助入账暂时关闭',
        '312': '您输入的银行卡号不正确',
        //支付宝
        '725': '您已经超过了今天的存款最大次数，请用支付宝转银行卡通道存款',
        '726': '对不起，当前订单提交未超过10分钟，不可以取消！',
        '727': '此支付通道繁忙，请稍后再试或选择其它支付方式',

        '902': '登录失败，请重新登录！',
        '904': 'MG账号未激活，如有问题请联系客服人员',
        //验证
        '951': '手机验证成功！',
        '952': '邮箱验证成功！',
        '953': '密码验证成功！',
        '954': '安全密码验证成功',
        '955': '安全问题验证成功！',
        '956': '手机验证失败！',
        '957': '邮箱验证失败！',
        '958': '密码验证失败！',
        '959': '安全密码验证失败！',
        '960': '安全问题验证失败！',
        '962': '验证失败！',
        '963': '没有验证项！',
        '964': '手机验证码发送成功！',
        '965': '邮箱验证码发送成功！',
        '966': '手机验证码发送失败！',
        '967': '邮箱验证码发送失败！',
        '968': '每天邮箱验证不能超过三次！',
        '969': '发送短信的次数超过当天最大次数',
        '971': '您填写的手机号码与注册手机号码不符！',
        '972': '您填写的邮箱与注册邮箱不符！',
        '975': '验证码错误！',
        '976': '十分钟内不允许重复申请验证码！',
        '986': '该手机号已注册或绑定！',
        //短信修改银行卡号
        '977': '发送验证码类型不能为空！',
        '978': '验证码不能为空！',
        '979': '用户名不能为空！',
        '980': '没有修改银行卡号的相关验证信息！',
        '981': '银行卡号修改成功！',
        '982': '银行卡号修改失败！',
        '961': '银行卡验证失败！',
        '983': '验证码超时！',
        '985': '银行卡资料没有变更！',
        '987': '账户信息有误！',
        '1000': '{0}不存在！',
        '1005': '账号不存在！',
        //游戏
        '1002': '进入游戏失败，请稍后再试。',
        //自助首存优惠begin
        '1201': '首存优惠正在审核，请勿重复申请！',
        '1202': '您已申请过首存优惠，请勿重复申请！',
        '1203': '抱歉，您首次存款金额小于50元，不符合申请条件！',
        '1204': '抱歉，您的注册IP已申请过首存优惠，如有问题请联系客服！', //抱歉，您不符合申请条件，如有问题请联系客服！
        '1205': '抱歉，您的登录IP已申请过首存优惠，如有问题请联系客服！',
        '1206': '抱歉，您的登录IP已申请过首存优惠，如有问题请联系客服！',
        '1207': '抱歉，您的银行卡已申请过首存优惠，如有问题请联系客服！',
        '1208': '抱歉，申请失败，请联系客服！',
        '1209': '您的账号未存款，更多优惠可查看官网“优惠活动”！',
        '1301': '申请成功，请耐心等待审核！',
        '1304': '请勿重复领取彩金!',
        '1302': '不要急，活动还未开始！',
        '1303': '对不起，活动已经结束！',
        '1305': '您的账号存在套利风险，活动期间新注册会员总存款金额50元以上方可领取国庆彩金！',
        '1307': '您已经申领过礼金',
        '1309': '洗码维护中，请稍后再试！',// 抢红包期间，请勿频繁洗码!
        '1310': '系统正在核对您的洗码，请稍后重试',
        '1312': '相同电话号码的用户已领取过认证礼金',
        '1313': '相同邮箱地址的用户已领取过认证礼金',
        '1314': '相同银行信息的用户已领取过认证礼金',
        //周勤
        '1602': '未达到申领礼金条件',
        '1603': '领奖时间还未开始',
        '1605': '已领过周勤',
        '1601': '活动时间为：2018-01-20 上午 11:00:00 至 2018-03-20 晚上 18:00:00',
        '1610': '当前该平台余额大于5元，不能参与笔笔存送活动',
        '2005': '账号已经被使用！',
        '2006': '您的银行资料已完善，请勿重复提交!',
        '3000': '余额不足',
        '3011': '转账失败',//'转账金额不能大于余额',
        '8001': '账号不可为空白！',
        '8002': '您已超过最大提交次数',
        '8004': '您已超过最大提交次数',
        //自助首存优惠end
        '8003': '您的注册信息已存在,请勿重复注册！',
        //短信设置
        '8081': '恭喜您！短信功能已经为您提交成功！',
        '8082': '提交失败！',

        //AstroPay  edit by kobe,2017/05/20
        '10001': '此卡资金不充足！',
        '10002': '此卡状态异常！',
        '10003': '输入的金额无效！',
        '10004': '此卡过期的日期无效！',
        '10005': '此卡已过期！',
        '10006': '订单重复，请稍后再试',
        '10013': '此卡片代码无效，请检查后再试！',
        //RequestWithdrawalCommand 申请提款返回
        '1316': '您当前存在洗码限额，无法申请提款',
        '731': '该平台存在流水限额，暂时无法操作',
        //幸运注单异常
        '1616': '下单时间超过1天，已过期',
        '1611': '请填写有效的注单信息,如有问题请联系客服。',
        '1612': '注单号不符合条件',
        '1614': '存在未处理的订单',
        '1615': '当天已参加活动',
        '1613': '当前游戏平台注单号已参与，请勿重复申请',
        '1617': '每天最多可申请3次，超过最大可申请次数',
        '1618': '游戏未找到',
        '0732': '创建订单失败，请尝试更换其它充值金额！',

        '4003': '进入游戏失败，请稍后再试 ！',
        '108': '该厅账户已被锁，如有疑问请联系客服！'
    });


$.fn.autoEmail = function (mailNameLen, isReg) {
    isReg = isReg || false;
    var elt = $(this), autoComplete, autoLi;
    var emailTep = {
        emailTep_li: '<li hz="{0}"></li>',
        emailList: '@qq.com,@163.com,@126.com,@sohu.com,@sina.com,@gmail.com,@hotmail.com,@yahoo.com,@live.com'
    }
    $.each(emailTep.emailList.split(','), function (i, o) {
        $('.AutoComplete_ul').append(emailTep.emailTep_li.format(o));
    });
    autoComplete = $('#AutoComplete');
    autoComplete.data('elt', elt);
    autoLi = $('#AutoComplete').find('li');
    autoLi.mouseover(function () {
        $(this).siblings().filter('.hover').removeClass('hover');
        $(this).addClass('hover');
    }).mouseout(function () {
        $(this).removeClass('hover');
    }).mousedown(function () {
        autoComplete.data('elt').val($(this).attr('data-val')).change();
        autoComplete.hide();
    });
    elt.keyup(function (e) {
        if (/13|38|40|116/.test(e.keyCode) || this.value == '')
            return false;
        var username = this.value;
        autoLi.each(function () {
            $(this).attr('data-val', username.replace(/\@+.*/, '') + $(this).attr('hz'))
            if (username.length > mailNameLen)
                this.innerHTML = username.replace(/\@+.*/, '').substr(0, mailNameLen) + '...' + $(this).attr('hz');
            else
                this.innerHTML = username.replace(/\@+.*/, '') + $(this).attr('hz');
            if ($(this).attr('data-val').indexOf(username) >= 0)
                $(this).show();
            else
                $(this).hide();
        }).filter('.hover').removeClass('hover');

        autoComplete.show().css({
            left: $(this).offset().left,
            top: $(this).offset().top + $(this).outerHeight(true) - 1,
            position: 'absolute',
            zIndex: '99999'
        });

        //增加输入框清空按钮后调整样式
        if (window.location.href.indexOf("Register") > -1 || window.location.href.indexOf("ResetPassword") > -1 || isReg) {
            autoComplete.show().css({
                left: 0,
                top: "40px",
                position: 'absolute',
                zIndex: '99999'
            });
        }

        if (autoLi.filter(':visible').length == 0) {
            autoComplete.hide();
        } else {
            autoLi.filter(':visible').eq(0).addClass('hover');
        }
    }).keydown(function (e) {
        if (e.keyCode == 38)
            autoLi.filter('.hover').prev().not('.AutoComplete_title').addClass('hover').next().removeClass('hover');
        else if (e.keyCode == 40)
            autoLi.filter('.hover').next().addClass('hover').prev().removeClass('hover');
        else if (e.keyCode == 13) {
            autoLi.filter('.hover').mousedown();
            e.preventDefault();
        }
    }).focus(function () {
        autoComplete.data('elt', $(this));
    }).blur(function () {
        autoComplete.hide();
    });
}

$.fn.refreshBalance = function (balance) {
    var bVal;
    var $this = $(this);
    if ($this.hasClass('user-m-loading') == true) return;
    $this.addClass('user-m-loading');
    $(".refresh_balance").addClass('user-m-loading');
    //扩展刷新余额，如传入balance(余额)直接赋值显示
    if (balance != null && balance != undefined && !isNaN(balance)) {
        //setTimeout(function () { $this.prev('span').text(balance); $this.removeClass('reloading-i').addClass('refresh-i'); }, 100);
    } else {
        $.invoke_api({ UserBalance: {} }, {
            success: function (data, textStatus, jqXHR) {
                if (data.Status == 1){
                    bVal = data.row;
                    refBalance(data.row);
                } else if (data.Status == 16) {
					loginConponent.Show()
                } else {
                    bVal = 'N/A';
                }
            },
            complete: function (jqXHR, textStatus) {
                setTimeout(function () {
                    $this.removeClass('user-m-loading');
                    $(".refresh_balance").removeClass('user-m-loading');
                    $(".banlance_span").text(bVal);
                }, 1000);
                //setTimeout(function () { $this.parent().find("span:not(.refresh)").text(bVal + " 元"); $this.removeClass('reloading-i').addClass('refresh-i'); }, 100);
            }
        });
    }
}

//LogError
// window.onerror = function handleErr(msg, url, l) {
//     if (!$.cookie(msg + url + l + navigator.userAgent) || $.cookie(msg + url + l + navigator.userAgent) == undefined) {
//         $.invoke_api({ JsErrorCommand: { url: url, lineNum: l, errorMsg: msg, browser: navigator.userAgent } });
//         // $.cookie(msg + url + l + navigator.userAgent, true);
//         return true;
//     }
// }

function gameState(g) {
    var m = '';
    $.invoke_api({ GameStateList: { gameId: g } }, {
        invokeApi: true,
        url: resolveClientUrl + '.gameapi',
        async: false,
        success: function (data, textStatus, jqXHR) {
            switch (data.Status) {
                case 16: loginConponent.Show(); break;
                case 1:
                    if (data.row.Locked == 1) {
                        m = data.row.MaintainMsg || '游戏平台维护中';
                    } else if (data.row.Locked == 2) {
                        m = '游戏平台维护中';
                    } break;
                default: m = getMsg(data.Status); break;
            }
        },
        error: function (xhr, ajaxOptions, thrownError) { }
    });
    return showTips(m);

    // return bln;
}
function showTips(msg) {
    var bln = true;
    if (msg != '') {
        //art.dialog({
        //    title: '<label>温馨提示</label>',
        //    content: msg,
        //    icon: 'face-smile',
        //    padding: 2,
        //    lock: true,
        //    ok: function () { return true; }
        //});
        $('body').Dialog({
            type: "Ask",
            title: "温馨提示",
            message: msg,
            buttons: [{
                name: "确定",
                callback: function () { closeDialog(0); }
            }],
            closeHandler: function () { closeDialog(0); }
        });

        bln = false;
    }
    return bln;
}
//登录弹窗
function pop_login() { $('.pop-login').fadeIn(200); $('#account').focus(); }
function pop_off() { $('.pop-login').fadeOut(200); }
function imgLazyload() {
    $('img').lazyload({
        placeholder: 'images/loading.gif',
        event: 'scroll',
        effect: 'fadeIn'
    });
}

// 用户超时登出
function loginTimeOut() {
    location.href = "/";
}

function isLoginByApi(url) {
    if (!loginConponent.IsLogin()) {
        loginConponent.Show();
        return false;
    }
    else {
        if (!!url) {
            location.href = url;
        }
        return true;
    }
}

function copyValue(obj,target) {
    var ele = !!document.querySelector ? document.querySelector(target) : document.getElementById(target.replace("#", ""));
    var text = ele.innerText;

    var flag = copyToClipboard(text);
    $(obj).val(flag ? '复制成功' : "复制失败");
}
function copyToClipboard(str){
    var el = document.createElement('textarea');
    el.value = str;
    el.setAttribute('readonly', '');
    el.style.position = 'absolute';
    el.style.left = '-9999px';
    document.body.appendChild(el);
    var selected =
        document.getSelection().rangeCount > 0
            ? document.getSelection().getRangeAt(0)
            : false;
    el.select();
    var success = document.execCommand('copy');
    document.body.removeChild(el);
    if (selected) {
        document.getSelection().removeAllRanges();
        document.getSelection().addRange(selected);
    }
    //返回执行状态
    return success;
};
/*关闭消息层*/
function closeDialog(index) {
    $(".pro-box").remove();
    $(".pro-big-box").remove();
    $(".popup-overlay").remove();
    if (index && index != 0) {
        $('body').navshow("0" + index);
    }
}

//首页平台选项卡JS
/*
$(function () {
    var _tab = $('ul#tabfirst-ntb>li');
    var _con = $('div#tab-box-ntb>div');
    var _conthis;
    var _index = 0;

    _tab.click(function () {
        _index = _tab.index(this);
        $(this).addClass('tabin-ntb').siblings().removeClass('tabin-ntb');
        _con.filter(':visible').stop(true, true).fadeOut(200, function () {
            _con.eq(_index).fadeIn(200)
        })
    });


})
*/
//显示、隐藏金额
function toggleBalance() {
    var isShow = $.cookie("banlance_span_flag");
    if (!isShow || isShow === "false") {
        $.cookie("banlance_span_flag",true);
        $.cookie("banlance_span", $(".banlance_span_1").html());
        $(".banlance_span_1").html("*****");
        $(".refresh_balance").hide();
        $(".banlance_title").html("显示");

        $.cookie("memberBalance", "*****", { path: '/' });
    }
    else {
        $.cookie("banlance_span_flag",false);
        $(".banlance_span_1").html($.cookie("banlance_span"));
        $(".refresh_balance").show();
        $(".banlance_title").html("隐藏");

        $.cookie("memberBalance", $.cookie("banlance_span"), { path: '/' });
    }
}

function refBalance(m) {
    var banlance = $(".banlance_span_1").html();
    if (location.href.indexOf('Cdefault') > -1)
        banlance = $(".n-u-balance .banlance_span").text();
    if (banlance == undefined) return;
    if (banlance.indexOf("*") != -1) {
        //不更新显示，只更新cookie
    }
    else {
        //全部更新
        $(".banlance_span_1").html(m).addClass("balance-animate-1");
        $(".banlance_span").addClass("balance-animate-1");
        setTimeout(function () { $(".banlance_span_1").removeClass("balance-animate-1"); $(".banlance_span").removeClass("balance-animate-1"); }, 1000);
    }
    $.cookie("banlance_span", m, { path: '/' });
    $.cookie("memberBalance", m, { path: '/' });
}

function refreshBalance() {
    $('.refresh').refreshBalance();
}


function loadPtaScript() {
    var ptjsurl = 'https://login.winforfun88.com/jswrapper/integration.js.php?casino=winforfun88';
        var ptconf = document.createElement("script");
        document.body.appendChild(ptconf);

        var ptjs = document.createElement("script");
        ptjs.setAttribute("src", ptjsurl);
        document.body.appendChild(ptjs);

        var ptr = document.createElement("script");
        ptr.setAttribute("src", "../js/ptrun.js?v=20190525");
        document.body.appendChild(ptr);
        ptiniapiVersion = false;

}

function loadPtScript(isPTin) {
    isPTin = isPTin || false;
    var ptjsurl = 'https://login.powerplay88.com/jswrapper/integration.js.php?casino=powerplay88';
    if (isPTin) { //PT国际
        ptjsurl = 'https://login.greatfortune88.com/jswrapper/integration.js.php?casino=greatfortune88';
        var ptconf = document.createElement("script");
        document.body.appendChild(ptconf);
        var ptjs = document.createElement("script");
        ptjs.setAttribute("src", ptjsurl);
        document.body.appendChild(ptjs);

        var ptr = document.createElement("script");
        ptr.setAttribute("src", "../js/ptrun.js?v=20190525");
        document.body.appendChild(ptr);
        ptiniapiVersion = true;
    } else {
        var ptconf = document.createElement("script");
        //ptconf.setAttribute("src", "https://www.816396.com:6443:8443/services/js/1/integration.conf.js");
        //ptconf.setAttribute("src", "https://login.powerplay88.com/jswrapper/integration.conf.js?casino=powerplay88");
        document.body.appendChild(ptconf);

        var ptjs = document.createElement("script");
        ptjs.setAttribute("src", ptjsurl);
        document.body.appendChild(ptjs);

        var ptr = document.createElement("script");
        ptr.setAttribute("src", "../js/ptrun.js?v=20190525");
        document.body.appendChild(ptr);
        ptiniapiVersion = false;
    }
}
function openGameWindow(ops) {
    var isTrial = ops.isTrial || false;
    if (!$.cookie("memberToken") && !isTrial) {
        return loginConponent.Show({ loginType: 1 });
    }
    var agent = navigator.userAgent;
    var url = "/gameloading.aspx?_1=" + ops.gameType + '&_2=' + (ops.gameCode || '') + '&_3=' + isTrial + '&_4=' + (ops.html5 || false);
    if (ops.plat) {
        url += '&_5=' + ops.plat;
    }
    if (ops.gameName) {
        url += '&_6=' + ops.gameName;
    }
    console.log(url);
    if (~agent.indexOf('Electron')) {
        ops.width = ops.width || 800;
        ops.height = ops.height || 600;
        // Important!
        ops.webPreferences = {
            nodeIntegration: false,
            nativeWindowOpen: true,
            plugins: true
        };
        try {
            var ipcRenderer = require('electron').ipcRenderer;
            return ipcRenderer.send("nativeOpenWin", location.origin + url, ops, 'game_' + Math.random())
        }
        catch(e) {
            console.log(e)
        }
    }
    var w = ops.width || 800;
    var h = ops.height || 600;

    //弹窗居中
    var w_width = window.screen.width;
    var w_height = window.screen.height;
    var obj_top = (w_height - h) / 2;
    var obj_left = (w_width - w) / 2;
    var handle = window.open(url, "_blank", ops.plat ? null : "top=" + obj_top + ", left=" +obj_left + ", width=" +w + ", height=" +h);

    return handle;
}
function getGameName($this) {
    if ($this) {
        return $this.closest('li').find('[gamename]').attr('gamename')
    }
}
//进入游戏
function playGame($this, isTrial) {
    isTrial = isTrial || false; //是否试玩
    if (!isTrial) {
        $.removeCookie("loginTimeoutData", { path: '/' });
    }
    var gameCode = $this ? $this.attr("gamecode"):arguments[2];
    var Gtype = $this ? ($this.attr('rel') || $('.egame-type').children('.on').attr('rel')) : arguments[3];
    var url;
    var html5 = $this ? $this.attr("data-html5"):arguments[4];
    var gameName = arguments[5] || ($this && $this.attr("gamename")) || getGameName($this);
    var size = gameWindowAdaptor(Gtype, gameCode);
    console.log('ggggggggggggame', gameName);
    return openGameWindow({
        width: size.width,
        height: size.height,
        isTrial: isTrial,
        html5: html5,
        gameType: Gtype,
        gameCode: gameCode,
        gameName: gameName
    });
    var handle = openGame1(0, w, h, 0, isTrial);

    var hosturl = encodeURIComponent(window.location.origin);

    if (!gameState(Gtype)) {
        handle.close();
        return true;
    }

    //var flag = isLoginByApi();
    //if (!flag) return true;

    if (Gtype == 15) {
        // pt
        $.invoke_api({
            GetPTEntry: { GameCode: gameCode, IsTrial: isTrial, IsHtml5: html5 }
        }, {
            async: false,
            invokeApi: true,
            url: resolveClientUrl + '.gameapi',
            success: function (data, textStatus, jqXHR) {
                //console.log(data);
                switch (data.Status) {
                    case 16:
                        handle.close();
                        loginConponent.Show();
                        break;
                    case 1:
                        if (!!isTrial) {
                            handle.location.href = data.row;
                            return true;
                        }
                        lessThanTen(data,Gtype,isTrial,function(handle){
                            var url = data.row.EntryData || data.row;
                            $.when(loadPtScript()).done(function () {
                                var runInterval = setInterval(function () {
                                    //if (!!iapiVersion && !ptiniapiVersion) {
                                    if (typeof iapiVersion !=="undefined" && !ptiniapiVersion && !!iapiConf && iapiConf.casinoname == 'powerplay88') {
                                        if (html5==="true") {
                                            data.row = resolveClientUrl + 'PTloader.html?_1=' + encodeURIComponent(url) + '&_2=' + $.cookie('ptlogin') + '&_3=' + $.cookie('ptpwd');
                                        } else {
                                            ptrun(false);
                                        }

                                        clearInterval(runInterval);
                                        runInterval = null;
                                        setTimeout(function () {
                                            handle.location.href = url;
                                        }, 1000 * 1);
                                    }
                                }, 200);
                            });
                        });
                        break;
                    default:
                        //console.log(data);
                        playgameFail(data.Status);
                        break;
                }
            }
        });

    } else if (Gtype == 35) {
        // PT亚洲
        $.invoke_api({
            GetPTAEntry: { GameCode: gameCode, IsTrial: isTrial, IsHtml5: html5 }
        }, {
            async: false,
            invokeApi: true,
            url: resolveClientUrl + '.gameapi',
            success: function (data, textStatus, jqXHR) {
                //console.log(data);
                switch (data.Status) {
                    case 16:
                        handle.close();
                        loginConponent.Show();
                        break;
                    case 1:
                        if (!!isTrial) {
                            handle.location.href = data.row;
                            return true;
                        }
                        lessThanTen(data, Gtype, isTrial, function (handle) {
                            var url = data.row.EntryData || data.row;
                            $.when(loadPtaScript()).done(function () {
                                var runInterval = setInterval(function () {
                                    //if (!!iapiVersion && !ptiniapiVersion) {
                                    if (typeof iapiVersion !== "undefined" && !ptiniapiVersion && !!iapiConf && iapiConf.casinoname == 'powerplay88') {
                                        if (html5 === "true") {
                                            data.row = resolveClientUrl + 'PTloader.html?_1=' + encodeURIComponent(url) + '&_2=' + $.cookie('ptlogin') + '&_3=' + $.cookie('ptpwd');
                                        } else {
                                            ptrun(false);
                                        }

                                        clearInterval(runInterval);
                                        runInterval = null;
                                        setTimeout(function () {
                                            handle.location.href = url;
                                        }, 1000 * 1);
                                    }
                                }, 200);
                            });
                        });
                        break;
                    default:
                        //console.log(data);
                        playgameFail(data.Status);
                        break;
                }
            }
        });

    }
    else if (Gtype == 12) {
        // ag
        $.invoke_api({ GetAGXINEntry: { trial: isTrial, IsTrial: isTrial, Type: "", GameCode: gameCode, IsHtml5: html5, ClientDomain: hosturl } }, {
            async: false,
            invokeApi: true,
            url: resolveClientUrl + '.gameapi',
            success: function (data, textStatus, jqXHR) {
                //console.log(data);
                switch (data.Status) {
                    case 16:
                        handle.close();
                        loginConponent.Show();
                        break;
                    case 1:
                        lessThanTen(data,Gtype,isTrial,function(handle){
                            var url = data.row.EntryData || data.row;
                            handle.location.href = url;
                        });
                        break;
                    default:
                        //console.log(data);
                        playgameFail(data.Status);
                        break;
                }
            }
        });
    }
    else if (Gtype == 18) {
        // ttg
        $.invoke_api({ GetTTGEntry: { GameCode: gameCode, IsTrial: isTrial, IsHtml5: html5 } }, {
            async: false,
            invokeApi: true,
            url: resolveClientUrl + '.gameapi',
            success: function (data, textStatus, jqXHR) {
                //console.log(data);
                switch (data.Status) {
                    case 16:
                        handle.close();
                        loginConponent.Show();
                        break;
                    case 1:
                        lessThanTen(data,Gtype,isTrial,function(handle){
                            var url = data.row.EntryData || data.row;
                            handle.location.href = url;
                        });
                        break;
                    default:
                        //console.log(data);
                        playgameFail(data.Status);
                        break;
                }
            }
        });
    }
    else if (Gtype == 17 || Gtype == 16) {
        // mg mgin
        var mginId = 17;
        var command = Gtype == mginId ? { GetMGINEntry: { GameCode: gameCode, IsTrial: isTrial, IsHtml5: html5 } } : { GetMGEntry: { GameCode: gameCode, IsHtml5: html5 } };
        $.invoke_api(command, {
            async: false,
            invokeApi: true,
            url: resolveClientUrl + '.gameapi',
            success: function (data, textStatus, jqXHR) {

                //console.log(data);
                switch (data.Status) {
                    case 16:
                        handle.close();
                        loginConponent.Show();
                        break;
                    case 1:
                        if (!!isTrial) {
                            handle.location.href = data.row;
                            return true;
                        }
                        lessThanTen(data,Gtype,isTrial,function(handle){
                            if (html5 == "false") {
                                var action = typeof(data.row.EntryData)=='string'?data.row.EntryData : data.row.EntryData.EntryGameUrl;
                                var gameId = data.row.EntryData.GameID;
                                var theme = data.row.EntryData.Theme;
                                var uL = data.row.EntryData.UL;
                                var sExt1 = data.row.EntryData.sEXT1;
                                var sExt2 = data.row.EntryData.sEXT2;

                                var formHtml = '<form action="' + action + '" method="post" target="_self">'
                                                + '<input type="hidden" name="gameid"         value="' + gameId + '" />'
                                                + '<input type="hidden" name="sEXT1"          value="' + sExt1 + '"  />'
                                                + '<input type="hidden" name="sEXT2"          value="' + sExt2 + '"  />'
                                                + '<input type="hidden" name="UL"             value="' + uL + '" />'
                                                + '<input type="hidden" name="applicationid"  value="1023"             />'
                                                + '<input type="hidden" name="usertype"       value="0"      />';

                                if (Gtype == mginId) {
                                    // mgin
                                    formHtml += '<input type="hidden" name="csid"           value="2635"            />'
                                                + '<input type="hidden" name="serverid"       value="2635"            />'
                                                + '<input type="hidden" name="theme"          value="igamingA"        />'
                                                + '</form>';
                                }
                                else {
                                    // mg
                                    formHtml += '<input type="hidden" name="csid"           value="16113"            />'
                                                + '<input type="hidden" name="serverid"       value="16113"            />'
                                                + '<input type="hidden" name="theme"          value="iGamingA4"        />'
                                                + '<input type="hidden" name="variant"        value="instantplay"      />'
                                                + '</form>';
                                }

                                //openGameByForm(false, formHtml);
                                handle.document.open();
                                handle.document.write(formHtml);
                                handle.document.close();
                                handle.document.forms[0].submit();
                            } else {
                                var url = data.row.EntryData.replace('[lobbyURL]', hosturl);
                                url = url.replace('[bankingURL]', hosturl);
                                handle.location.href = url;
                            }
                        });

                        break;
                    default:
                                //console.log(data);
                        playgameFail(data.Status);
                        break;
                }
            }
        });
    }
    else if (Gtype == 19) {
        // bsg
        $.invoke_api({ GetBSGEntry: { GameCode: gameCode, IsTrial: isTrial, IsHtml5: html5 } }, {
            async: false,
            invokeApi: true,
            url: resolveClientUrl + '.gameapi',
            success: function (data, textStatus, jqXHR) {
                //console.log(data);
                switch (data.Status) {
                    case 16:
                        handle.close();
                        loginConponent.Show();
                        break;
                    case 1:
                        lessThanTen(data,Gtype,isTrial,function(handle){
                            var url = data.row.EntryData || data.row;
                            handle.location.href = url;
                        });
                        break;
                    default:
                        //console.log(data);
                        playgameFail(data.Status);
                        break;
                }
            }
        });
    }else if (Gtype == 20) {
        // GG捕鱼
        $.invoke_api({ GetGGEntry: { GameCode: gameCode, IsTrial: isTrial, IsHtml5: html5 } }, {
            async: false,
            invokeApi: true,
            url: resolveClientUrl + '.gameapi',
            success: function (data, textStatus, jqXHR) {
                //console.log(data);
                switch (data.Status) {
                    case 16:
                        handle.close();
                        loginConponent.Show();
                        break;
                    case 1:
                        lessThanTen(data,Gtype,isTrial,function(handle){
                            var url = data.row.EntryData || data.row;
                            handle.location.href = url;
                        });
                        break;
                    default:
                        //console.log(data);
                        playgameFail(data.Status);
                        break;
                }
            }
        });
    } else if (Gtype == 21) {
        // DT厅
        $.invoke_api({ GetDTEntry: { GameCode: gameCode, IsTrial: isTrial, IsHtml5: html5 } }, {
            async: false,
            invokeApi: true,
            url: resolveClientUrl + '.gameapi',
            success: function (data, textStatus, jqXHR) {
                //console.log(data);
                switch (data.Status) {
                    case 16:
                        handle.close();
                        loginConponent.Show();
                        break;
                    case 1:
                        lessThanTen(data,Gtype,isTrial,function(handle){
                            var url = data.row.EntryData || data.row;
                            url = url.replace('[closeUrl]', hosturl);
                            handle.location.href = url;
                        });

                        break;
                    default:
                        //console.log(data);
                        playgameFail(data.Status);
                        break;
                }
            }
        });
    }else if (Gtype == 22) {
        // SW厅
        $.invoke_api({ GetPT_SkyWindEntry: { GameCode: gameCode, IsTrial: isTrial, IsHtml5: html5 } }, {
            async: false,
            invokeApi: true,
            url: resolveClientUrl + '.gameapi',
            success: function (data, textStatus, jqXHR) {
                //console.log(data);
                switch (data.Status) {
                    case 16:
                        handle.close();
                        loginConponent.Show();
                        break;
                    case 1:
                        lessThanTen(data,Gtype,isTrial,function(handle){
                            var url = data.row.EntryData || data.row;
                            handle.location.href = url;
                        });
                        break;
                    default:
                        //console.log(data);
                        playgameFail(data.Status);
                        break;
                }
            }
        });
    } else if (Gtype == 9) {
        if (!!gameCode) {
            $.invoke_api({ GetBBINEntry: { page_site: 4, GameCode: gameCode } }, { //page_site :0 体育 ,3 真人 ,4 电游, 6 捕鱼
                invokeApi: true,
                url: resolveClientUrl + '.gameapi',
                success: function (data, textStatus, jqXHR) {
                    console.log(data);
                    switch (data.Status) {
                        case 16:
                            handle.close();
                            loginConponent.Show();
                            break;
                        case 1:
                            if (!!data.row) { //波音捕鱼达人
                                lessThanTen(data,Gtype,isTrial,function(handle){
                                    var url = data.row.EntryData || data.row;
                                    handle.location.href = url;
                                });
                            }
                            break;
                        default:
                            playgameFail(data.Status);
                            break;
                    }
                }
            });
        }
    } else if (Gtype == 23) {
        // PP厅
        $.invoke_api({ GetPPEntry: { GameCode: gameCode, IsTrial: isTrial, IsHtml5: html5, lobbyURL: encodeURIComponent(location.host) } }, {
            async: false,
            invokeApi: true,
            url: resolveClientUrl + '.gameapi',
            success: function (data, textStatus, jqXHR) {
                //console.log(data);
                switch (data.Status) {
                    case 16:
                        handle.close();
                        loginConponent.Show();
                        break;
                    case 1:
                        lessThanTen(data,Gtype,isTrial,function(handle){
                            var url = data.row.EntryData || data.row;
                            url = url.replace('[closeUrl]', hosturl);
                            handle.location.href = url;
                        });

                        break;
                    default:
                        //console.log(data);
                        playgameFail(data.Status);
                        break;
                }
            },
            error: function () {
                playgameFail();
            }
        });
    }else if (Gtype == 24) {
        // PS厅
        $.invoke_api({ GetPSEntry: { GameCode: gameCode, IsTrial: isTrial, IsHtml5: html5, lobbyURL: encodeURIComponent(location.host) } }, {
            async: false,
            invokeApi: true,
            url: resolveClientUrl + '.gameapi',
            success: function (data, textStatus, jqXHR) {
                //console.log(data);
                switch (data.Status) {
                    case 16:
                        handle.close();
                        loginConponent.Show();
                        break;
                    case 1:
                        lessThanTen(data,Gtype,isTrial,function(handle){
                            var url = data.row.EntryData || data.row;
                            url = url.replace('[lobbyURL]', hosturl + "/egame.aspx#24");
                            handle.location.href = url;
                        });
                        break;
                    default:
                        //console.log(data);
                        playgameFail(data.Status);
                        break;
                }
            },
            error: function () {
                playgameFail();
            }
        });
    } else if (Gtype == 26) {
        // pt国际
        $.invoke_api({
            GetPT_INEntry: { GameCode: gameCode, IsTrial: isTrial, IsHtml5: html5 }
        }, {
            async: false,
            invokeApi: true,
            url: resolveClientUrl + '.gameapi',
            success: function (data, textStatus, jqXHR) {
                //debugger
                switch (data.Status) {
                    case 16:
                        handle.close();
                        loginConponent.Show();
                        break;
                    case 1:
                        if (!!isTrial) {
                            handle.location.href = data.row;
                            return true;
                        }

                        lessThanTen(data,Gtype,isTrial,function(handle){
                            var url = data.row.EntryData || data.row;
                            $.when(loadPtScript(true)).done(function () {
                                var runInterval = setInterval(function () {
                                    if (typeof iapiVersion !=="undefined" && ptiniapiVersion && !!iapiConf && iapiConf.casinoname == 'greatfortune88') {
                                        if (html5==="true") {
                                            data.row = resolveClientUrl + 'PT_INloader.html?_1=' + encodeURIComponent(url) + '&_2=' + $.cookie('ptinlogin') + '&_3=' + $.cookie('ptpwd');
                                        } else {
                                            ptrun(true);
                                        }

                                        clearInterval(runInterval);
                                        runInterval = null;
                                        setTimeout(function () {
                                            handle.location.href = url;
                                        }, 1000 * 1);
                                    }
                                }, 200);
                            });
                        });

                        break;
                    default:
                        //console.log(data);
                        playgameFail(data.Status);
                        break;
                }
            },
            error: function () {
                playgameFail();
            }
        });

    } else if (Gtype == 27) {
        // PP厅
        $.invoke_api({ GetAEEntry: { GameCode: gameCode, IsTrial: isTrial, IsHtml5: html5 } }, {
            async: false,
            invokeApi: true,
            url: resolveClientUrl + '.gameapi',
            success: function (data, textStatus, jqXHR) {
                //console.log(data);
                switch (data.Status) {
                    case 16:
                        handle.close();
                        loginConponent.Show();
                        break;
                    case 1:
                        lessThanTen(data,Gtype,isTrial,function(handle){
                            var url = data.row.EntryData || data.row;
                            handle.location.href = url;
                        });
                        break;
                    default:
                        //console.log(data);
                        playgameFail(data.Status);
                        break;
                }
            },
            error: function () {
                playgameFail();
            }
        });
    } else if (Gtype == 28) {
        // PP厅
        $.invoke_api({ GetKYEntry: { GameCode: gameCode, IsTrial: isTrial, IsHtml5: html5 } }, {
            async: false,
            invokeApi: true,
            url: resolveClientUrl + '.gameapi',
            success: function (data, textStatus, jqXHR) {
                //console.log(data);
                switch (data.Status) {
                    case 16:
                        handle.close();
                        loginConponent.Show();
                        break;
                    case 1:
                        lessThanTen(data,Gtype,isTrial,function(handle){
                            var url = data.row.EntryData || data.row;
                            handle.location.href = url;
                        });
                        break;
                    default:
                        //console.log(data);
                        playgameFail(data.Status);
                        break;
                }
            },
            error: function () {
                playgameFail();
            }
        });
    } else if (Gtype == 30) {
        // cq9厅
        $.invoke_api({ GetCQ9Entry: { GameCode: gameCode, IsTrial: isTrial, IsHtml5: html5 } }, {
            async: false,
            invokeApi: true,
            url: resolveClientUrl + '.gameapi',
            success: function (data, textStatus, jqXHR) {
                //console.log(data);
                switch (data.Status) {
                    case 16:
                        handle.close();
                        loginConponent.Show();
                        break;
                    case 1:
                        lessThanTen(data,Gtype,isTrial,function(handle){
                            var url = data.row.EntryData || data.row;
                            handle.location.href = url;
                        });
                        break;
                    default:
                        //console.log(data);
                        playgameFail(data.Status);
                        break;
                }
            },
            error: function () {
                playgameFail();
            }
        });
    }
    else if (Gtype == 31) {
        // png厅
        $.invoke_api({ GetPNGEntry: { GameCode: gameCode, IsTrial: isTrial, IsHtml5: html5,clientDomain: location.origin } }, {
            async: false,
            invokeApi: true,
            url: resolveClientUrl + '.gameapi',
            success: function (data, textStatus, jqXHR) {
                // console.log(data);
                switch (data.Status) {
                    case 16:
                        handle.close();
                        loginConponent.Show();
                        break;
                    case 1:
                        lessThanTen(data,Gtype,isTrial,function(handle){
                            var url = data.row.EntryData || data.row;
                            handle.document.open();
                            handle.document.write('<form action="/Game/PNG.aspx" method="post" id="form"><input type="hidden" name="url" value="' +url +'" /></form>\
                                <script>document.getElementById(\'form\').submit()</script>')
                            handle.document.close();
                        });
                        break;
                    default:
                        //console.log(data);
                        playgameFail(data.Status);
                        break;
                }
            },
            error: function () {
                playgameFail(data.Status);
            }
        });
    }else if (Gtype == 32) {
        // 761厅
        $.invoke_api({ GetQP761Entry: { GameCode: gameCode, IsTrial: isTrial, IsHtml5: html5 } }, {
            async: false,
            invokeApi: true,
            url: resolveClientUrl + '.gameapi',
            success: function (data, textStatus, jqXHR) {
                //console.log(data);
                switch (data.Status) {
                    case 16:
                        handle.close();
                        loginConponent.Show();
                        break;
                    case 1:
                        lessThanTen(data, Gtype, isTrial, function (handle) {
                            var url = data.row.EntryData || data.row;
                            handle.location.href = url;
                        });
                        break;
                    default:
                        playgameFail(data.Status);
                        break;
                }
            },
            error: function () {
                playgameFail();
            }
        });
    }
    else if (Gtype == 34) {
        // NT厅
        $.invoke_api({ GetNTEntry: { GameCode: gameCode, IsTrial: isTrial, IsHtml5: html5 } }, {
            async: false,
            invokeApi: true,
            url: resolveClientUrl + '.gameapi',
            success: function (data, textStatus, jqXHR) {
                //console.log(data);
                switch (data.Status) {
                    case 16:
                        handle.close();
                        loginConponent.Show();
                        break;
                    case 1:
                        lessThanTen(data, Gtype, isTrial, function (handle) {
                            var url = data.row.EntryData || data.row;
                            handle.location.href = url;
                        });
                        break;
                    default:
                        playgameFail(data.Status);
                        break;
                }
            },
            error: function () {
                playgameFail();
            }
        });
    }

    //内函数，进入游戏失败
    function playgameFail(status) {
        handle.close();
        if(status){
            if (status == 321) {
                $('body').Dialog({
                    type: "Ask",
                    title: "温馨提示",
                    messageTitle: "未完善个人资料",
                    message: '您的个人资料不全，请完善个人资料！',
                    buttons: [{
                        name: "确定",
                        callback: function () {  gotoZzyh(44); }
                    }],
                    closeHandler: function () {  gotoZzyh(44); }
                });
            } else {
                $('body').Dialog({
                    type: "Ask",
                    title: "温馨提示",
                    messageTitle: "进入游戏失败",
                    message: getMsg(status),
                    buttons: [{
                        name: "确定",
                        callback: function () { closeDialog(0); }
                    }],
                    closeHandler: function () { closeDialog(0);}
                });
            }
        }else{
            $('body').Dialog({
                type: "Ask",
                title: "温馨提示",
                messageTitle: "进入游戏失败，请稍后再试。",
                //message: getMsg(data.Status),
                buttons: [{
                    name: "确定",
                    callback: function () {
                        $(".pro-box").remove();
                        $(".pro-big-box").remove();
                        $(".popup-overlay").remove();
                    }
                }],
                closeHandler: function () {
                    $(".pro-box").remove();
                    $(".popup-overlay").remove();
                }
            });
        }

    }

    /**
     * 游戏余额少于10元弹出框
     * @param  {[type]}   data    [游戏api返回内容]
     * @param  {[type]}   Gtype   [游戏id]
     * @param  {Boolean}  isTrial [是否试玩]
     * @param  {Function} fn      [回调函数]
     * @return {[type]}           [description]
     */
    function lessThanTen(data,Gtype,isTrial,fn){
        if(data.row.isBalanceTips){
            handle.close();
            var params = {
                balance: data.row.gameBalance,
                gameId: Gtype,
                isTrial: isTrial
            };
            var balanceTip = beforeGameIn(params,fn);
            balanceTip.Show();
        }else{
            // handle = openGame1(0, 0, 0, 0, isTrial);
            fn && fn(handle);
        }
    }

}
// 根据平台和游戏code返回游戏窗口尺寸
function gameWindowAdaptor(Gtype,code,name) {
    var w = Math.max(window.screen.width * 0.75, 800),
        h = Math.max(window.screen.height * 0.75, 600);
    if (Gtype == 28 || Gtype == 32 || Gtype == 36 || Gtype == 38 ) {
        w = 950;
    }
    else if (Gtype == 18 || Gtype == 39) {
        w = 1080;
        h = 680;
    }
    else if (Gtype == 31) {
        w = 1024;
        h = 768;
    }
    else if (Gtype == 34) {
        w = 960;
        h = 540;
    }
    else if (Gtype == 37) {
        // mga横屏游戏
        if (code && typeof MGA_SPECIAL_GAMES === 'string') {
            if (MGA_SPECIAL_GAMES.indexOf(','+code+',') > -1) {
                w = 1000;
                h = 563;
            }
        }
        // mga竖屏游戏
    }
    return {
        width: w, height: h
    }
}
//手机QQ浏览器
function GetMQQBrowser() {
    var MQQBrowser;
    if (client_user.Terminal != "PC" && navigator.userAgent.indexOf("MQQBrowser") != -1)
        MQQBrowser = true;

    return MQQBrowser;
}

/**
* 给input[type=text]添加清空内容的按钮
* type [string] 识别参数
*/
function tipInputClose(sign) {
    sign = sign || undefined;
    if (!!window.ActiveXObject || "ActiveXObject" in window) {
        return false;
    }
    var elemInput = $("input");
    if (sign==="login") {
        elemInput = $("#login_conponent input");
    }
    var tipInput = null;
    if (elemInput.size() > 0) {
        var notNeed = ["button", "submit", "reset", "checkbox", "radio", "hidden"];
        elemInput.each(function (i) {
            tipInput = $('<i class="btn-input-close"></i>');
            var thisType = $(this).attr("type");
            var thisTime = false;
            for (var k = 0; k < notNeed.length; k++) {
                if (thisType == notNeed[k]) {
                    thisTime = true;
                }
            }
            if (thisTime) {
                return true;
            }
            if ($(this).next("i.btn-input-close").size() == 0) {
                $(this).after(tipInput);
            }
            var _width = $(this).width();
            var _left = _width - 12;
            var _top = 12;

            if (sign) {
                switch (sign) {
                    case "login": //登录时
                        _left = _width - 22;
                        _top = 23;
                        break;
                    case "register"://注册
                        if (i == 0) {
                            return true;
                        } else if (i == 1) {
                            _left += 30;
                        }
                        break;
                    case "egame":
                        _top = 7;
                        _left = _width - 20;
                        break;
                    default:
                        break;
                }
            }

            $(this).parent().css({
                "position": "relative"
            });
            $(this).next("i.btn-input-close").css({
                "float": "left",
                "width": "18px",
                "height": "18px",
                "cursor": "pointer",
                "background": "url(/image/bg/text-off.png) no-repeat 0 0",
                "position": "absolute",
                "left": _left + "px",
                "top": _top+"px",
                "display": "none"
            });
            //登录时
            if (sign && sign == "login") {
                $("#login_conponent").find("i.btn-input-close").eq(0).show();
                elemInput.eq(0).css({
                    "background": "none"//url(../image/pic/bg/user-ico.png) no-repeat right center
                });

            }
            $(this).next("i.btn-input-close").click(function () {
                var $input = $(this).prev("input");
                if ($input.val().length == 0 || $input.val() == "") return false;
                $(this).prev("input").val("");
                if (sign == "login" && $input.attr("id") == "account") {
                    //$input.css({ "background": "url(../image/pic/bg/user-ico.png) no-repeat right center" });
                } else if (sign == "login" && $input.attr("id") == "login_password") {
                    //$input.css({ "background": "url(../image/pic/bg/lock-ico.png) no-repeat right center" });
                }
                $input.focus();
            });
            $(this).focus(function () {
                $(this).next("i.btn-input-close").show();
                if (sign == "register" && $(this).attr("name") == "mail") {
                    $(this).parent().find("#AutoComplete").show();
                } else if (sign == "login" && $(this).attr("id") == "account") {
                    $(this).css({"background":"none"});
                } else if (sign == "login" && $(this).attr("id") == "login_password") {
                    $(this).css({ "background": "none" });
                }
            });
            $(this).blur(function () {
                if ($(this).val() != "") {
                    $(this).next("i.btn-input-close").show();
                } else {
                    $(this).next("i.btn-input-close").hide();
                    if (sign == "login" && $(this).attr("id") == "account") {
                        //$(this).css({ "background": "url(../image/pic/bg/user-ico.png) no-repeat right center" });
                    } else if (sign == "login" && $(this).attr("id") == "login_password") {
                        //$(this).css({ "background": "url(../image/pic/bg/lock-ico.png) no-repeat right center" });
                    }
                }
            });
        })
    }
}

//顶部下拉框选择跳转
function gotoZzyh(index) {
    index = index || "24";
    try {
        if ($.cookie('zzyh_nav_index')) {
            $.removeCookie('zzyh_nav_index', { path: '/' });
        }
        $.cookie('zzyh_nav_index', index, { path: '/' });
        if (location.href.indexOf('SelfPromo') > -1 || location.href.indexOf('Cdefault') > -1 || location.href.indexOf('CPromotion') > -1 || location.href.indexOf('CDeposit') > -1 || location.href.indexOf('Contact') > -1) {
            window.location.href = "/MemberCenter/SelfPromo.aspx";
        } else {
            window.location.href = "/MemberCenter/PromotionXM.aspx";
        }
    } catch (e) {
        console.log(e);
    }
}


//单个游戏试玩
function try_playGame(obj) {
    obj = obj ? obj : $(this);
    var isTrial = true; //是否试玩
    var gameCode = obj.attr("gamecode");
    var Gtype = $('.egame-type').children('.on').attr('rel') || obj.attr('rel');
    var html5 = obj.attr("data-html5");
    playGame(null, isTrial, gameCode, Gtype, html5, getGameName(obj));
}

//首次登录是否异常
function loginIsErr() {
    return !!$.cookie("tengbo.login.error");
}

//获取验证码 回调函数
function verifyCode(fn, type) {
    $.invoke_api({ GetVerifyCode: {width:80,height:30, type: type || 77} }, {
        success: function (data) {
            if (data.Status == 1) {
                $.cookie("SID", data.row.SID, { path: '/' });
                if (typeof fn === "function") {
                    fn.call(this, data); //验证码图片：data.row.imgdata， SID：data.row.SID
                }
            } else {
                return false;
            }
        }
    });
}

//监听键盘enter键，并登录
function verifyCodeWatchkey(e) {
    if (e.keyCode === 13) {
        btnLogin_click();
    } else {
        return false;
    }
}

//柜台添加验证码DOM
function addCodeHtml() {
    var codeWrap = $('<div class="login-inpt">');

    verifyCode(function (data) {
        var codeHtml = '<input id="ipt_code" style="width:33%;float:left;" name="n3" placeholder="验证码" type="text" />' +
        '<img id="login_CheckCode" class="login_CheckCode fl" src="data:image/png;base64,' + data.row.imgdata + '" width="80" height="44" >'+
        '<span class="pop-login-span-err"></span>';

        codeWrap.html(codeHtml);

        if (!!$.cookie("tengbo.login.error", { path: '/' }) && $("#ipt_code").size() < 1) {
            $(".login-anniu").prepend(codeWrap);
            codeWrap.find("#login_CheckCode").on('click', function () { //点击图片 刷新验证码
                verifyCode(function (data) {
                    codeWrap.find("#login_CheckCode").attr("src", "data:image/png;base64," + data.row.imgdata);
                })
            })
        }
    })
}

//站内信推送 //先注册，再接收消息
function createConn(param) {
    //var hosturl = 'http://192.168.3.211:5050/signalr/hubs/';
    var hosturl = window.location.origin + '/signalr/hubs/';
    var connection = null;

    //开始创建连接
    function Start() {
        connection=$.hubConnection(hosturl);
        param = param || {
            ACNT: $.cookie("memberACNT"),
            SID: $.cookie("SID"),
            Token: $.cookie("memberToken"),
            IP: "&IP&"
        };

        connection.qs = param;

        var TipCenter = connection.createHubProxy('tipCenter');
        TipCenter.on('sendMessage', function (msgData) {
        	console.log(msgData);
            //{Status: 0, Msg: "系统消息系统", Data: null}
            if (msgData.Status == 0)//0错误注册失败，1成功
            {
                Close();
                localStorage.setItem('tengbo.connSuc', "false", {path:'/'});
                return;
            }
			localStorage.setItem('tengbo.connSuc', "true", {path:'/'});
            if(msgData.Status == 1 && msgData.Msg=="Success"){
	                return; //
            }
            localStorage.setItem("EVENT.PUB", JSON.stringify(msgData));
            var msgNum = parseInt($(".user-newsNo").text());
            msgNum += 1;
            $(".user-newsNo").text(msgNum).show();
            $.cookie('tengbo.com.msgnum', msgNum, {path:'/'})

        });


        connection.start().done(function () {
            console.log('connect success !');
        });
        //connection.start({ transport: ['webSockets', 'foreverFrame', 'longPolling', 'serverSentEvents'], jsonp: true }).done(function(){
        //    console.log('connect success !');
        //});

        var navInfo = navigator.userAgent;
        if (navInfo.indexOf("MSIE 7") > -1 || navInfo.indexOf("MSIE 8") > -1 || navInfo.indexOf("MSIE 9") > -1 || navInfo.indexOf("MSIE 10") > -1) {
            connection.start({ transport: ['webSockets', 'foreverFrame', 'longPolling', 'serverSentEvents'], jsonp: true }).done(function () {
                console.log('connect success !');
            });
        }
     }
    //断开连接
    function Close() {
        if (connection) {
            connection.stop('断开连接', true);
            connection = null;
        }
    }
    return {
        register: Start,
        close: Close
    }
}
//是否是移动设备 是返回true,否则返回false
function isMobile() {
    var isMobile = navigator.userAgent.indexOf("Mobile") > -1 || navigator.userAgent.indexOf("iPhone") > -1 || navigator.userAgent.indexOf("Android") > -1;
    if (isMobile)
        return true;
    else
        return false;
}

//获取平台数据,异步回调函数，参数: 处理后的数组
function getPlatforms(fn, platMap, showLoading) {
    // var goalArr = [{ id: '', title: '主账户' }, { id: '15', title: 'PT厅' }, { id: '17', title: 'MG国际厅' },
    // { id: '21', title: 'DT厅' }, { id: '9', title: 'BBIN波音厅' }, { id: '12', title: 'AG国际厅' },
    // { id: '11', title: 'AG旗舰厅' }, { id: '18', title: 'TTG厅' }, { id: '20', title: 'GG厅' },
    // { id: '22', title: 'SW厅' }, { id: '23', title: 'PP厅' }, { id: '24', title: 'PS厅' },
    // { id: '25', title: '平博厅' }, { id: '26', title: 'PT国际厅' }, { id: '27', title: 'AE厅' },
    // { id: '28', title: '开元棋牌厅' }, { id: '29', title: 'VR厅' }, { id: '30', title: 'CQ9厅' },
    // {id: '31', title: 'PNG厅'}];
    // platMap = (platMap && platMap.length>0) ? platMap : goalArr;
    platMap = (!!platMap && JSON.stringify(platMap) != '{}') ? platMap : Util.GamePlat;
    var arr = [{ id: '', title: '主账户' }];
    var loadingObj = loadingPage({
        type: "load1",
        imgRootPath: imgRootPath,
        divClass: $(".user_center")
    });
    if (!!showLoading)
        loadingObj.Show();
    $.invoke_api({ GamePlatformList: {} }, {
        success: function (data) {
            if (!!showLoading)
                loadingObj.Hide();
            if (data.Status === 1) {
                var res = data.row;
                if (!data.row || !data.row.length) return [];
                // for (var i = 1; i < platMap.length; i++) {
                    for (var k = 0; k < res.length; k++) {
                        var rk = res[k];
                        if (platMap[rk.ID]) {
                            arr.push({
                                id: rk.ID,
                                title: platMap[rk.ID].title,
                                Locked: rk.Locked,
                                LockDspPromo: rk['LockDspPromo'],
                                IsDspPromo: rk['IsDspPromo'],
                                LockDsgPromo: rk['LockDsgPromo'],
                                IsDsgPromo: rk['IsDsgPromo'],
                                GameUserStatus: rk['GameUserStatus']
                            });
                            // break;
                        }
                    }
                // }
                if (typeof fn === "function") {
                    fn.call(null, arr);
                }
            }
        },
        complete: function () {
            if (!!showLoading)
                loadingObj.Hide();
        }
    })
}

//监听local事件
function watchStorageEvent() {
    var connsuc = localStorage.getItem('tengbo.connSuc');
    if (!connsuc || connsuc == "false") {
        connNow();
        return;
    }
    $(window).on('storage', function (ev) {
        var connsucx = localStorage.getItem('tengbo.connSuc');
        if (ev.originalEvent.key == "tengbo.connSuc") {
            connsucx = ev.originalEvent.newValue;
        }
        if (!connsucx || connsucx == "false") {
            connNow();
            return;
        }
        var event = ev.originalEvent,
            message = "";
        if (event.key === 'EVENT.PUB') {
            message = event.newValue;// 解析出符合的对象值
            console.log(JSON.parse(message))
        } else {
            return;
        }
    })
}

//连接站内信
function connNow() {
    if (!$.cookie("memberACNT")) {
        return;
    }
    if (!conn) {
        conn = createConn();
        conn.register();
    }
}

//离开页面
function leavePage() {
    $(window).unload(function () {
        if (conn) {
        	conn.close();
            localStorage.setItem('tengbo.connSuc', 'false', { path: '/' });
        }else if(!conn && localStorage.getItem('tengbo.connSuc') && localStorage.getItem('tengbo.connSuc')=="true"){
        	localStorage.setItem('tengbo.connSuc', 'false', { path: '/' });
        }
    });
}

/**
* 获取服务器当前时间
* @return {[type]} [description]
*/
function getServerDate() {
    var s;
    $.invoke_api({ GetServerDateCommand: {} }, {
        async: false,
        success: function (data, textStatus, jqXHR) {
            if (data.Status == 1) {
                //s = new Date(data.row.Year, data.row.Month - 1, data.row.Day, data.row.Hour, data.row.Minute, data.row.Second);
                s = data.serverTime;
            }
        }
    });
    return s;
}


//解决IE10以下不支持Function.bind
if (!Function.prototype.bind) {
    Function.prototype.bind = function(context) {
     var fn = this, args = Array.prototype.slice.call(arguments, 1);
     return function(){
        return fn.apply(context, Array.prototype.concat.apply(args, arguments));
     };
  };
}

//获取正式的H5网站地址
function getH5Url(fn) {
    $.invoke_api({ GetTransferUrl: { } }, {
        success: function (data) {
            if (data.Status == 1) {
                fn && fn(data);
            }
        }
    })
}

/**
	 * [kbNumformat description]
	 * @param  {[string]} num [传入的数据]
	 * @param  {[init]} len [格式的长度]
	 * @return {[string]}     [返回格式后的数字]
	 */
function kbNumformat(num, len) {
    len = len || 3;
    var arr = [], dot = '';
    if (typeof num === "number") {
        num = num.toString();
    }
    if (!/^[1-9]\d*(\.\d+)?$/.test(num)) return num;
    if (num.indexOf('.') > -1) {
        var pos = num.indexOf('.');
        dot = num.substring(pos);
        num = num.substring(0, pos);
    }
    arr = num.split('').reverse();
    if (arr.length > len) {
        for (var i = len; i < arr.length; i = i + len) {
            arr[i] = arr[i] + ',';
        }
    }
    num = arr.reverse().join('');
    return num + dot;
}

//PT柜台检查是移动设备跳转
function ptGoH5(hostUrl) {
    if ($.cookie('memberToken') && $.cookie('memberACNT') && isMobile()) {
        var params = '?SID=' + $.cookie('SID') + '&Token=' + $.cookie('memberToken') + '&ACNT=' + $.cookie('memberACNT') + '&GroupID=' + $.cookie('memberGroupID') + '&memberCenterOnly=true&RemotePage=true'
            , _host = hostUrl || 'https://m.tb8988.com/membercenter';
        window.location.href = _host + params;
    }
}

//获取未读推送消息的数量
function getUnreadMsgLen() {
    if ($.cookie('memberToken') && $.cookie('memberACNT')) {
        $.invoke_api({ GetMemberMsgCount: {} }, {
            success: function (data) {
                if (data.Status == 1) {
                    if (data.row != undefined) {
                        if (data.row > 0) {
                            $(".user-newsNo").text(data.row).show();
                            $.cookie('tengbo.com.msgnum', data.row, { path: '/' })
                        } else {
                            $(".user-newsNo").text(data.row).hide();
                            $.cookie('tengbo.com.msgnum', data.row, { path: '/' })
                        }

                    }
                }
                //console.log(data);
            }
        });
    } else {
        $(".user-newsNo").text(0).hide();
        $.cookie('tengbo.com.msgnum', 0, { path: '/' })
    }
}

/*
* VIP贵宾电话
*/
function showDialogPhone() {
    var domStr = '<div class="popup pop-valt mail_verify" id="PhoneNumberPop">' +
	    '<div class="popup-overlay"></div>'+
        '<div class="popup-content" style="padding-bottom:40px; margin-left:-230px;margin-top:-150px;">'+
    	    '<div class="popup-off bg-ico close_verify"></div>'+
        '<div class="valt-con mail_verify_first">'+
        	    '<h2 class="valt-bt">贵宾专属回拨</h2>' +
                '<div class="valt-div"><h3 class="valt-div-ts">电话号码如需修改，请联系<span style="color:#09f;cursor:pointer;" onclick="liveChat()">在线客服</span>！</h3></div>' +
                '<div class="valt-div">'+
                    '<input class="tb-inpt fl" name="mailNumber" type="text" value="" id="PhoneNumber" maxlength="11" readOnly>' +
                '</div>'+
                '<div class="valt-div"><div class="valt-an sendBtn_mail_first" id="btn_PhoneNumber">确 定</div></div>' +
                '<div class="valt-div" style="margin-left:10px;"><span class="point err"><em class="bg-ico"></em><span class="user_errmsg"></span></span></div>'+
            '</div></div></div>';
    var $dom = $(domStr);
    $dom.find('#btn_PhoneNumber').bind('click', function () {
        $.invoke_api({ CallBack: {} }, {
            success: function (data) {
                if ($("#PhoneNumberPop").size() > 0)
                    $("#PhoneNumberPop").remove();
                if (data.Status == 1) {
                    if (data.row != undefined && data.row) {
                        $('body').Dialog({
                            type: "OK",
                            title: "操作成功",
                            messageTitle: "提交成功",
                            message: '提交成功，专属客服将会给您回电！',
                            buttons: [{
                                name: "确定",
                                callback: function () { closeDialog(0); }
                            }],
                            closeHandler: function () { closeDialog(0); }
                        });
                    }
                } else if (data.Status == 1602) {
                    $('body').Dialog({
                        type: "Ask",
                        title: "温馨提示",
                        messageTitle: "提交失败",
                        message: '您的VIP等级未达到条件！',
                        buttons: [{
                            name: "确定",
                            callback: function () { closeDialog(0); }
                        }],
                        closeHandler: function () { closeDialog(0); }
                    });
                } else if (data.Status == 2000) {
                    $('body').Dialog({
                        type: "Ask",
                        title: "温馨提示",
                        messageTitle: "提交失败",
                        message: '最近申请正在处理中，请保持绑定电话畅通或联系在线客服！',
                        buttons: [{
                            name: "确定",
                            callback: function () { closeDialog(0); }
                        }],
                        closeHandler: function () { closeDialog(0); }
                    });
                } else {
                    $('body').Dialog({
                        type: "Ask",
                        title: "温馨提示",
                        messageTitle: "提交失败",
                        message: "提交失败，请稍后重试！",
                        buttons: [{
                            name: "确定",
                            callback: function () { closeDialog(0); }
                        }],
                        closeHandler: function () { closeDialog(0); }
                    });
                }
            }
        });
    })
    $dom.find('.close_verify').bind('click', function () {
        if ($("#PhoneNumberPop").size() > 0)
            $("#PhoneNumberPop").remove();
    })

    $.invoke_api({ GetMemberBaseInfoCommand: {} }, {
        success: function (data) {
            if (data.Status == 1) {
                if (data.row && data.row.Tel) {
                    $('body').append($dom);
                    $("#PhoneNumber").val(data.row.Tel);
                }
            }

        }
    });
}

//PT柜台跳转到活动详情页，传入DOM的id, 活动页Index
function lookForDetail(id, index) {
    if (navigator.userAgent.indexOf("MSIE 7") > -1) {
        if (!id || !index) return;
        id = '#' + id;
        $(id).attr('href', '#');
        $(id).attr('index', 'promotion' + index);
        $(id).removeAttr('target');
        $(id).click(function () {
            $(this).navshow();
        })
    }
}

function showServerPhone(fn) {
    $.invoke_api({ GetServiceContact: {} }, {
        success: function (data) {
            if (data.Status == 1) {
                fn && fn(data.row);
            }
        }
    })
}


/**
 * 进入游戏前弹窗
 * @return {[type]} [description]
 */
function beforeGameIn(data,fn){
    var balance = 0;
    if(typeof data !=="undefined" && typeof data.balance !=="undefined")
        balance = data.balance;
    var html = '<div id="beforGameTip" class="beforGameTip">'+
        '<div class="layer"></div>'+
        '<div class="content">'+
            '<span class="closeTip"></span>'+
            '<h4>当前厅余额不足<b>10</b>元，是否需要转账？</h4>  ' +
            '<p class="errText"></p>' +
            '<ul class="acount_info">'+
                '<li class="title">'+
                    '<span>主账户</span>' +
                    '<span></span>'+
                    '<span></span>'+
                '</li>'+
                '<li style="overflow:hidden;">' +
                    '<b class="account_num my_account"></b>'+
                    '<span class="backToAccount">全部转入&gt;</span>'+
                    '<b class="account_num my_balance" style="float: right;"></b>'+
                '</li>'+
            '</ul>  '+
            '<div class="money_input">'+
                '<input type="tel" placeholder="转入的金额只能是整数"/> 元'+
            '</div>   '+
            '<div class="btn_opt">'+
                '<span class="transToGame">转账并进入游戏</span>'+
                '<a href="/MemberCenter/Deposit.aspx" target="_blank">立即存款</a>'+
                '<a href="javascript:;" class="goToGame">直接进入游戏</a>'+
            '</div>  '+
        '</div>'+
    '</div>';
    var $html = $(html);
    var handle = null;
    var hosturl = encodeURIComponent(window.location.origin);

    function Show(){
        if(typeof data =="undefined" || typeof data.gameId == "undefined") return;
        $html.find('.my_balance').text(balance);
        $html.find('.acount_info li.title>span:eq(2)').text(Util.GamePlat[data.gameId].title);
        $html.find('.closeTip').bind('click', function () {
            if (~location.href.indexOf('gameloading.aspx')) {
                window.close();
            }
            else {
                Hide();
            }
        });
        $html.find('.money_input input').bind('keyup', watchInput);
        $html.find('.btn_opt>.goToGame').bind('click', goTogame);
        $html.find('.backToAccount').on('click', function(e) {
            var money = $html.find('.my_account').text();
            money = Math.floor( money.replace(/\,/g, '') );
            $html.find('.money_input input').val(money).trigger('keyup');
            doTrans()
        });
        $('body').append($html);
        $html.find('.money_input input').focus();
        getUserBalance(function (account) {
            $html.find('.my_account').text(account);
        });
    }

    function Hide(){
        if($('#beforGameTip').size()>0)
            $('#beforGameTip').remove();
        // window.close();
    }

    /**
     * 输入框监听事件
     * @return {[type]} [description]
     */
    function watchInput(){
        var reg = /^\+?[1-9]\d*$/,
            val = $(this).val();
        if(reg.test(val) && val>=1){
            $html.find('.btn_opt>.transToGame').addClass('active').off().bind('click', doTrans);
        }else{
            $html.find('.btn_opt>.transToGame').removeClass('active').unbind('click');
        }
    }

    /**
     * 转账并进入游戏
     * @return {[type]} [description]
     */
    function doTrans(){
        $html.find('.btn_opt>.transToGame').removeClass('active').unbind('click').text('操作中...');
        var amount = $html.find('.money_input input').val();
        var url = resolveClientUrl + '.gameapi';
        var _gameId = data.gameId;
        if (_gameId == 15) {
            $('body').Dialog({
                type: 'Ask',
                big: false,
                message: 'PT厅即将升级至<b>PT亚洲厅</b>，将于<b>6/25-7/20</b>升级维护，期间不能转入额度。',
                // closeHandler: function () { closeDialog(0); },
                buttons: [{
                    name: "确定",
                    callback: function () { closeDialog(0); }
                }]
            })
            return;
        }
        if (_gameId == 17) {
            $('body').Dialog({
                type: 'Ask',
                big: false,
                message: 'MG国际厅即将升级至<b>MG亚洲厅</b>，<b>10月16起</b>，不能转入额度。',
                buttons: [{
                    name: "确定",
                    callback: function () { closeDialog(0); }
                }]
            })
            return;
        }
        if (_gameId == 15 || _gameId == 26) {
            url = resolveClientUrl + '.ptgameapi';
        }
        // handle = openGame1(0, 0, 0, 0, data.isTrial);
        $.invoke_api({ UserGameTran: { amount: amount, gameid_0: _gameId } }, {
            invokeApi: true,
            url:url,
            success:function(data){
                $html.find('.btn_opt>.transToGame').addClass('active').text('转账并进入游戏').bind('click',doTrans);
                if(data.Status==1){
                    $html.find('.my_account').text(data.row.Balance);
                    $html.find('.my_balance').text(data.row.GameBalance);
                    refreshBalance();
                    Hide();
                    setTimeout(function(){
                        fn && fn();
                    },500);
                    $html.find('.errText').hide().text('');
                } else if (data.Status == 724 && _gameId == 20) {
                    $('body').Dialog({
                    type: "Ask",
                    title: "温馨提示",
                    messageTitle: "取消失败",
                    message: '2018年11月26日GG捕鱼平台将维护升级，原GG子账户也被重置为新的子账户，原平台余额将会在2018年11月27日14点前自动转回主账户。',
                    buttons: [{
                    name: "确定",
                    callback: function () { closeDialog(0); }
                }],
                    closeHandler: function () { closeDialog(0); }
                });
                } else if (data.Status == 315) {
                    $('body').Dialog({
                        type: "Ask",
                        title: "温馨提示",
                        messageTitle: "操作失败",
                        message: '普通会员无法转账和提款，请联系客服！',
                        buttons: [{
                            name: "确定",
                            callback: function () { closeDialog(0); }
                        }],
                        closeHandler: function () { closeDialog(0); }
                    });
                } else {
                    var errMsg = data.Status === -3 ? '余额不足' : getMsg(data.Status);
                    if (data.Status == 718) {
                        errMsg = '您的存送活动订单已锁定，请稍后再试<i id="cancelOrderNow" style="display:inline-block;margin-left:20px;color:#06f;font-style: normal;cursor: pointer;">取消参与</i>';
                    }
                    $html.find('.errText').show().html(errMsg || '转账出现错误，请稍后重试！');
                    if ($html.find('.errText #cancelOrderNow').size()>0) {
                        $html.find('.errText #cancelOrderNow').off().on('click', cancelOrderNow);
                    }
                    // handle && handle.close();
                }
            }
        })
    }

    /**
     * 直接进入游戏
     * @return {[type]} [description]
     */
    function goTogame(){
        Hide();
        // handle = openGame1(0, 0, 0, 0, data.isTrial);
        // setTimeout(function(){
            fn && fn();
        // },100);
    }

    /**
     * 取消参与笔笔存送活动
     * @return {[type]} [description]
     */
    function cancelOrderNow() {
        $.invoke_api({ CancelPromo: { GameID: data['gameId'] } }, {
            async: false,
            success: function (data) {
                if (data.Status == 1) {
                    if (data.row) {
                        $html.find('.errText').html('存送订单取消成功！').show();
                        // 由于弹窗会被拦截，不自动转
                        // doTrans();
                    } else {
                        $('body').Dialog({
                            type: "Ask",
                            title: "温馨提示",
                            messageTitle: "取消失败",
                            message: "存送订单取消失败，请稍后重试！",
                            buttons: [{
                                name: "确定",
                                callback: function () { closeDialog(0); }
                            }],
                            closeHandler: function () { closeDialog(0); }
                        });
                    }
                } else {
                    $('body').Dialog({
                        type: "Ask",
                        title: "温馨提示",
                        messageTitle: "取消失败",
                        message: getMsg(data.Status),
                        buttons: [{
                            name: "确定",
                            callback: function () { closeDialog(0); }
                        }],
                        closeHandler: function () { closeDialog(0); }
                    });
                }
            }
        })
    }

    return {
        Show: Show,
        Hide: Hide
    }
}


/**
 * 手机号获取验证码
 * @param  {[number]}   type [1为登录，2为注册]
 * @param  {[string]}   phone [手机号码]
 * @param  {Function} fn   [获取到验证码后的回调函数]
 * @return {[type]}        [description]
 */
function getMobileCode(phone, type, fn) {
    if (!phone) return;
    type = type || 1;
    var SendType = type == 1 ? 'login' : 'register',
        data = {
            Tel: phone,
            SendType: SendType
        },
        repMsg = {
            301: '提交的手机号码不合法！',
            317: '该手机号未认证！',
            986: '该手机号已注册或绑定！',
            976: '1分钟内请勿重复发送短信！',
            968: '您发送短信的次数超过当天最大次数！',
            8002: '您发送短信太频繁，请稍后再试！'
        };
    if($.cookie('memberACNT')){
        $.removeCookie("memberACNT", { path: '/' });
    }
    $.invoke_api({ SendTelCodeCommand: data }, {
        invokeApi: true,
        url: resolveClientUrl + '.gameapi',
        success: function (data) {

            if (data.Status == 964) {
                // fn&&fn(data);
            } else {
                repMsg[data.Status] = repMsg[data.Status] || '';
                data.RepMsg = repMsg[data.Status];
            }
            fn && fn(data);
        }
    })
}

function isAudited(){
    var hostUrl = location.origin,
        isAudited = false,
        AuditedHost = ['tengbo201', 'tengbo20111', 'tengbo20111', '101tbh8', '102tbh8', '103tbh8'];
    for(var i=0;i<AuditedHost.length;i++){
        if(hostUrl.indexOf(AuditedHost[i])>-1){
            isAudited = true;
        }
    }
    return isAudited;
}

// 查询余额回调函数
function getUserBalance(fn) {
    $.invoke_api({ UserBalance: {} }, {
        success: function (data, textStatus, jqXHR) {
            if (data.Status == 1) {
                bVal = data.row;
                refBalance(data.row);
                fn && fn(data.row);
            } else if (data.Status == 16) {
                loginConponent.Show()
            } else {
                bVal = '0';
            }
        }
    });
}

//MG擂台赛获取URL 有效期 2018-12-25 至 2018-12-31
function GetMGLeitaiUrl() {
    var w = window.open('');
    $.invoke_api({ mgTournament_GetAlias: {} }, {
        success: function (data) {
            if (data.Status == 1 && data.row) {
                var url = data.row.Url;
                w.location.href = url;
            } else {
                w.close();
            }
        }
    });
}

//2019年侧边栏对齐骚操作
function wathchRightSize() {
    var $rightChildren = $('#tb-topcontrol .tb-nreturn').children(),
        $leftChildren = $("#tb-left-topcontrol .tb-nreturn").children(),
        r_num = $rightChildren.size() - 1,
        l_num = $leftChildren.size()-1;

    $rightChildren.each(function (i, v) {
        if (v.style.display == "none" && v.id != "tb-returntop") {
            r_num--;
        }
    })
    if (l_num < r_num) {
        var denum = r_num - l_num;
        for (var k = 0; k < denum; k++) {
            var $child = $('<a href="https://web.cq9promo.com/newyear/#/home" target="_blank" class="newyear-link"><p>CQ9龙虎榜</p></a>');
            $("#tb-left-topcontrol .tb-nreturn .moreActive").before($child);
        }
    } else if (l_num > r_num) {
        var denum = l_num - r_num;
        for (var k = 0; k < denum; k++) {
            $("#tb-left-topcontrol .tb-nreturn .moreActive").prev('.newyear-link').remove();
        }
    }
}

//新春波音红包
function BBINHongBao() {
    var win = window.open('');
    $.invoke_api({ GetBBINEventUrl2019: { "evenName": "CasinoEventUrl" } }, {
        success: function (res) {
            if (res.Status === 1) {
                win.document.open();
                win.document.write(res.row);
                win.document.close();
            } else {
                win.close();
            }
        },
        error: function () {
            win.close();
        }
    })
}

//小屏幕设置缩小
function shrinkScale(scale1, scale2) {
    scale1 = scale1 || 1;
    scale2 = scale2 || 1;
    var scale = scale1;
    if (screen.availWidth < 1300 || document.body.clientWidth<1300) {
        scale = scale2;
    }
    return scale;
}

function GetBBINEventUrl2019Party(eventCode) {
    eventCode = eventCode || 'bb-20190301';
    var w = window.open('');
    $.invoke_api({ GetBBINEventUrl2019Party: { "evenName": "PromotionEventUrl", "eventCode": eventCode } }, {
        success: function (data) {
            if (data.Status == 1 && data.row) {
                var url = data.row;
                w.location.href = url;
            } else {
                w.close();
            }
        }
    });
}

/**
 * 获取banner图列表
 *
*/
function GetBannelList(fn) {
    $.invoke_api({ GetBannelList: {} }, {
        success: function (data) {
            if (data.Status == 1) {
                fn && typeof fn == 'function' && fn(data);
            }
        }
    });
}